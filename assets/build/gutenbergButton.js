/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./node_modules/@wordpress/icons/build-module/library/calendar.js":
/*!************************************************************************!*\
  !*** ./node_modules/@wordpress/icons/build-module/library/calendar.js ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _wordpress_primitives__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @wordpress/primitives */ "@wordpress/primitives");
/* harmony import */ var _wordpress_primitives__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_wordpress_primitives__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react/jsx-runtime */ "react/jsx-runtime");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__);
/**
 * WordPress dependencies
 */


const calendar = /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_wordpress_primitives__WEBPACK_IMPORTED_MODULE_0__.SVG, {
  viewBox: "0 0 24 24",
  xmlns: "http://www.w3.org/2000/svg",
  children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_wordpress_primitives__WEBPACK_IMPORTED_MODULE_0__.Path, {
    d: "M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm.5 16c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5V7h15v12zM9 10H7v2h2v-2zm0 4H7v2h2v-2zm4-4h-2v2h2v-2zm4 0h-2v2h2v-2zm-4 4h-2v2h2v-2zm4 0h-2v2h2v-2z"
  })
});
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (calendar);
//# sourceMappingURL=calendar.js.map

/***/ }),

/***/ "./node_modules/@wordpress/icons/build-module/library/trash.js":
/*!*********************************************************************!*\
  !*** ./node_modules/@wordpress/icons/build-module/library/trash.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _wordpress_primitives__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @wordpress/primitives */ "@wordpress/primitives");
/* harmony import */ var _wordpress_primitives__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_wordpress_primitives__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react/jsx-runtime */ "react/jsx-runtime");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__);
/**
 * WordPress dependencies
 */


const trash = /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_wordpress_primitives__WEBPACK_IMPORTED_MODULE_0__.SVG, {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 24 24",
  children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_wordpress_primitives__WEBPACK_IMPORTED_MODULE_0__.Path, {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"
  })
});
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (trash);
//# sourceMappingURL=trash.js.map

/***/ }),

/***/ "./src/components/CustomMetaSection.js":
/*!*********************************************!*\
  !*** ./src/components/CustomMetaSection.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @wordpress/components */ "@wordpress/components");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @wordpress/i18n */ "@wordpress/i18n");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _wordpress_icons__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @wordpress/icons */ "./node_modules/@wordpress/icons/build-module/library/trash.js");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! react/jsx-runtime */ "react/jsx-runtime");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__);





const CustomMetaSection = ({
  customMeta,
  onChange,
  enabled,
  onToggle
}) => {
  const [isExpanded, setIsExpanded] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [metaFields, setMetaFields] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)([]);

  // Initialize meta fields from customMeta
  (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (customMeta && customMeta.length > 0) {
      setMetaFields(customMeta.map(meta => ({
        key: meta.key,
        value: meta.value,
        type: meta.type || 'string',
        isSerialized: meta.isSerialized || false,
        originalValue: meta.originalValue || meta.value,
        isDeleted: false
      })));
    } else {
      setMetaFields([]);
    }
  }, [customMeta]);

  // Calculate field count (excluding deleted)
  const fieldCount = metaFields.filter(field => !field.isDeleted).length;
  const handleFieldChange = (index, field, value) => {
    const newFields = [...metaFields];
    newFields[index] = {
      ...newFields[index],
      [field]: value
    };

    // If value changed and it's array/object type, try to detect type
    if (field === 'value' && (newFields[index].type === 'array' || newFields[index].type === 'object')) {
      try {
        const parsed = JSON.parse(value);
        newFields[index].type = Array.isArray(parsed) ? 'array' : 'object';
      } catch (e) {
        // Invalid JSON, keep current type
      }
    }
    setMetaFields(newFields);

    // Notify parent of change with properly formatted data
    if (onChange) {
      const formattedFields = newFields.filter(f => !f.isDeleted).map(f => ({
        key: f.key,
        value: f.value,
        type: f.type,
        isSerialized: f.isSerialized
      }));
      onChange(formattedFields);
    }
  };
  const handleDeleteField = index => {
    const newFields = [...metaFields];
    newFields[index].isDeleted = true;
    setMetaFields(newFields);

    // Notify parent of change with properly formatted data
    if (onChange) {
      const formattedFields = newFields.filter(f => !f.isDeleted).map(f => ({
        key: f.key,
        value: f.value,
        type: f.type,
        isSerialized: f.isSerialized
      }));
      onChange(formattedFields);
    }
  };
  const handleAddField = () => {
    const newField = {
      key: '',
      value: '',
      type: 'string',
      isSerialized: false,
      originalValue: '',
      isDeleted: false
    };
    const newFields = [...metaFields, newField];
    setMetaFields(newFields);
  };
  const handleSectionClick = e => {
    // Don't expand if clicking the toggle
    if (e.target.closest('.components-toggle-control')) {
      return;
    }
    setIsExpanded(!isExpanded);
  };
  const handleValueBlur = (index, value) => {
    const field = metaFields[index];

    // If it's an array or object type, validate JSON
    if (field.type === 'array' || field.type === 'object') {
      try {
        JSON.parse(value);
        // Valid JSON, keep it
      } catch (error) {
        // Invalid JSON, revert to previous value
        handleFieldChange(index, 'value', field.value);
      }
    }
  };
  if (!customMeta || customMeta.length === 0) {
    return null;
  }
  return /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div", {
    className: "duplicate-post-modal__custom-meta-section",
    style: {
      opacity: enabled ? 1 : 0.5
    },
    children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div", {
      className: "duplicate-post-modal__section-header",
      onClick: handleSectionClick,
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '12px',
        padding: '12px',
        cursor: 'pointer',
        borderBottom: isExpanded ? '1px solid rgba(0, 0, 0, 0.1)' : 'none'
      },
      children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.ToggleControl, {
        checked: enabled,
        onChange: onToggle,
        __nextHasNoMarginBottom: true
      }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div", {
        style: {
          flex: 1
        },
        children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("span", {
          className: "duplicate-post-modal__section-label",
          children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Custom Meta', 'post-duplicator')
        }), enabled && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("span", {
          className: "duplicate-post-modal__section-count",
          children: [' ', "(", fieldCount, " ", (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('fields', 'post-duplicator'), ")"]
        })]
      })]
    }), isExpanded && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div", {
      className: "duplicate-post-modal__section-content",
      style: {
        padding: '16px'
      },
      children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalVStack, {
        spacing: "16px",
        children: [metaFields.map((field, index) => !field.isDeleted && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div", {
          style: {
            padding: '12px',
            border: '1px solid rgba(0, 0, 0, 0.1)',
            borderRadius: '4px'
          },
          children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalHStack, {
            spacing: "8px",
            alignment: "top",
            children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div", {
              style: {
                flex: 1
              },
              children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.TextControl, {
                label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Key', 'post-duplicator'),
                value: field.key,
                onChange: value => handleFieldChange(index, 'key', value),
                __nextHasNoMarginBottom: true,
                __next40pxDefaultSize: true
              })
            }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div", {
              style: {
                flex: 2
              },
              children: field.type === 'array' || field.type === 'object' ? /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.TextareaControl, {
                label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Value (JSON)', 'post-duplicator'),
                value: field.value,
                onChange: value => handleFieldChange(index, 'value', value),
                onBlur: e => handleValueBlur(index, e.target.value),
                rows: 6,
                __nextHasNoMarginBottom: true,
                __next40pxDefaultSize: true
              }) : /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.TextareaControl, {
                label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Value', 'post-duplicator'),
                value: field.value,
                onChange: value => handleFieldChange(index, 'value', value),
                rows: 3,
                __nextHasNoMarginBottom: true,
                __next40pxDefaultSize: true
              })
            }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div", {
              children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
                icon: _wordpress_icons__WEBPACK_IMPORTED_MODULE_3__["default"],
                variant: "tertiary",
                onClick: () => handleDeleteField(index),
                label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Delete field', 'post-duplicator'),
                style: {
                  marginTop: '32px'
                }
              })
            })]
          })
        }, index)), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
          variant: "secondary",
          onClick: handleAddField,
          style: {
            alignSelf: 'flex-start'
          },
          children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Add Field', 'post-duplicator')
        })]
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CustomMetaSection);

/***/ }),

/***/ "./src/components/DuplicateModal.js":
/*!******************************************!*\
  !*** ./src/components/DuplicateModal.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @wordpress/components */ "@wordpress/components");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @wordpress/i18n */ "@wordpress/i18n");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _DuplicateSettingsFields__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./DuplicateSettingsFields */ "./src/components/DuplicateSettingsFields.js");
/* harmony import */ var _TaxonomySection__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./TaxonomySection */ "./src/components/TaxonomySection.js");
/* harmony import */ var _CustomMetaSection__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./CustomMetaSection */ "./src/components/CustomMetaSection.js");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! react/jsx-runtime */ "react/jsx-runtime");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__);







const DuplicateModal = ({
  isOpen,
  onClose,
  onDuplicate,
  originalPost,
  defaultSettings,
  postTypes,
  statusChoices,
  siteUrl,
  currentUser
}) => {
  const [settings, setSettings] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(defaultSettings);
  const [isLoading, setIsLoading] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [includeTaxonomies, setIncludeTaxonomies] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [includeCustomMeta, setIncludeCustomMeta] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [taxonomyData, setTaxonomyData] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)({});
  const [customMetaData, setCustomMetaData] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [featuredImage, setFeaturedImage] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(null);
  const [duplicateStatus, setDuplicateStatus] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)('idle');
  const [duplicatedPostId, setDuplicatedPostId] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(null);
  const [duplicatedPostTitle, setDuplicatedPostTitle] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const prevIsOpenRef = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);

  // Only reset state when modal is first opened (isOpen changes from false to true)
  (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isOpen && !prevIsOpenRef.current) {
      setSettings(defaultSettings);
      setIncludeTaxonomies(true);
      setIncludeCustomMeta(true);
      setDuplicateStatus('idle');
      setDuplicatedPostId(null);
      setDuplicatedPostTitle('');
    }
    prevIsOpenRef.current = isOpen;
  }, [isOpen, defaultSettings]);

  // Update data when originalPost changes, but only if modal is open and in idle state
  (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen || duplicateStatus !== 'idle') {
      return;
    }

    // Initialize taxonomy data from original post
    if (originalPost?.taxonomies) {
      const initialTaxonomyData = {};
      originalPost.taxonomies.forEach(taxonomy => {
        initialTaxonomyData[taxonomy.slug] = taxonomy.terms.map(term => term.id);
      });
      setTaxonomyData(initialTaxonomyData);
    } else {
      setTaxonomyData({});
    }

    // Initialize custom meta data from original post
    if (originalPost?.customMeta) {
      setCustomMetaData(originalPost.customMeta.map(meta => ({
        key: meta.key,
        value: meta.value,
        type: meta.type || 'string',
        isSerialized: meta.isSerialized || false
      })));
    } else {
      setCustomMetaData([]);
    }

    // Initialize featured image from original post
    if (originalPost?.featuredImage) {
      setFeaturedImage(originalPost.featuredImage);
    } else {
      setFeaturedImage(null);
    }
  }, [isOpen, originalPost, duplicateStatus]);
  const getModalTitle = () => {
    if (!originalPost?.title) return '';
    // Use fullTitle if available, otherwise use original + suffix
    if (settings.fullTitle) {
      return settings.fullTitle;
    }
    return `${originalPost.title} ${settings.title}`;
  };
  const getDuplicateButtonLabel = () => {
    const targetType = settings.type === 'same' ? originalPost.type : settings.type;
    const postTypeLabel = postTypes[targetType] || targetType;
    return (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)(`Duplicate ${postTypeLabel}`, 'post-duplicator');
  };
  const handleDuplicate = async () => {
    setIsLoading(true);
    setDuplicateStatus('duplicating');

    // Calculate the final post title
    const finalTitle = settings.fullTitle || `${originalPost.title} ${settings.title}`;
    setDuplicatedPostTitle(finalTitle);
    try {
      const duplicateSettings = {
        ...settings,
        includeTaxonomies,
        includeCustomMeta,
        taxonomyData,
        customMetaData,
        featuredImageId: featuredImage?.id || null
      };

      // Create a promise wrapper to handle the callback-based onDuplicate
      await new Promise((resolve, reject) => {
        onDuplicate(duplicateSettings, {
          onSuccess: result => {
            setDuplicatedPostId(result.duplicate_id);
            setDuplicateStatus('complete');
            setIsLoading(false);
            resolve(result);
          },
          onError: error => {
            console.error('Error duplicating:', error);
            setDuplicateStatus('idle');
            setIsLoading(false);
            reject(error);
          }
        });
      });
    } catch (error) {
      // Error already handled in callback
    }
  };
  const handleTaxonomyChange = selectedTerms => {
    setTaxonomyData(selectedTerms);
  };
  const handleCustomMetaChange = metaFields => {
    setCustomMetaData(metaFields);
  };

  // Set CSS variable on modal frame when featured image changes
  (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (featuredImage && isOpen) {
      // Use setTimeout to ensure modal is rendered
      const timer = setTimeout(() => {
        const modalFrame = document.querySelector('.duplicate-post-modal--has-featured-image.components-modal__frame');
        if (modalFrame) {
          modalFrame.style.setProperty('--featured-image-url', `url(${featuredImage.thumbnail || featuredImage.url})`);
        }
      }, 0);
      return () => clearTimeout(timer);
    }
  }, [featuredImage, isOpen]);
  if (!isOpen) return null;
  const handleClose = () => {
    // Prevent closing while duplicating
    if (duplicateStatus === 'duplicating') {
      return;
    }
    // Reset state when closing from complete state
    if (duplicateStatus === 'complete') {
      setDuplicateStatus('idle');
      setDuplicatedPostId(null);
      setDuplicatedPostTitle('');
    }
    onClose();
  };
  return /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Modal, {
    title: getModalTitle(),
    onRequestClose: handleClose,
    className: `duplicate-post-modal ${featuredImage ? 'duplicate-post-modal--has-featured-image' : ''}`,
    size: "large",
    style: {
      borderRadius: 0
    },
    children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div", {
      className: "duplicate-post-modal__content",
      style: {
        paddingBottom: duplicateStatus === 'idle' ? '77px' : '0'
      },
      children: duplicateStatus === 'idle' ? /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalVStack, {
        className: "duplicate-post-modal__settings",
        children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_DuplicateSettingsFields__WEBPACK_IMPORTED_MODULE_3__["default"], {
          settings: settings,
          onSettingsChange: setSettings,
          postTypes: postTypes,
          statusChoices: statusChoices,
          originalPost: originalPost,
          featuredImage: featuredImage,
          onFeaturedImageChange: setFeaturedImage
        }), originalPost?.taxonomies && originalPost.taxonomies.length > 0 && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_TaxonomySection__WEBPACK_IMPORTED_MODULE_4__["default"], {
          taxonomies: originalPost.taxonomies,
          onChange: handleTaxonomyChange,
          enabled: includeTaxonomies,
          onToggle: setIncludeTaxonomies
        }), originalPost?.customMeta && originalPost.customMeta.length > 0 && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_CustomMetaSection__WEBPACK_IMPORTED_MODULE_5__["default"], {
          customMeta: originalPost.customMeta,
          onChange: handleCustomMetaChange,
          enabled: includeCustomMeta,
          onToggle: setIncludeCustomMeta
        })]
      }) : /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div", {
        className: "duplicate-post-modal__status",
        children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div", {
          className: "duplicate-post-modal__status-item",
          children: [featuredImage && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("img", {
            src: featuredImage.thumbnail || featuredImage.url,
            alt: "",
            className: "duplicate-post-modal__status-thumbnail"
          }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("h3", {
            className: "duplicate-post-modal__status-title",
            children: duplicatedPostTitle
          }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div", {
            className: "duplicate-post-modal__status-actions",
            children: duplicateStatus === 'duplicating' ? /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Spinner, {}) : /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment, {
              children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
                variant: "secondary",
                onClick: () => window.open(`${siteUrl}/?p=${duplicatedPostId}`, '_blank'),
                children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('View Post', 'post-duplicator')
              }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
                variant: "primary",
                onClick: () => window.open(`${siteUrl}/wp-admin/post.php?post=${duplicatedPostId}&action=edit`, '_blank'),
                children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Edit Post', 'post-duplicator')
              })]
            })
          })]
        })
      })
    }), duplicateStatus === 'idle' && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalHStack, {
      alignment: "right",
      className: "duplicate-post-modal__footer",
      style: {
        position: 'absolute',
        bottom: '0px',
        left: '0',
        padding: '20px',
        borderTop: '1px solid rgba(0, 0, 0, 0.1)',
        background: '#FFF'
      },
      children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
        variant: "tertiary",
        onClick: handleClose,
        disabled: isLoading,
        children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Cancel', 'post-duplicator')
      }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
        variant: "primary",
        onClick: handleDuplicate,
        disabled: isLoading,
        isBusy: isLoading,
        children: isLoading ? (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Duplicating...', 'post-duplicator') : getDuplicateButtonLabel()
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DuplicateModal);

/***/ }),

/***/ "./src/components/DuplicateSettingsFields.js":
/*!***************************************************!*\
  !*** ./src/components/DuplicateSettingsFields.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @wordpress/components */ "@wordpress/components");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @wordpress/i18n */ "@wordpress/i18n");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _wordpress_icons__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @wordpress/icons */ "./node_modules/@wordpress/icons/build-module/library/calendar.js");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! react/jsx-runtime */ "react/jsx-runtime");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__);





// Try to import MediaUpload components, but they may not be available on post list screen
// Use a function to check availability at runtime

const getMediaUploadComponents = () => {
  try {
    // Try to dynamically import - this will work if the module is available
    const blockEditor = __webpack_require__(/*! @wordpress/block-editor */ "@wordpress/block-editor");

    // Verify the components are actually functions/components, not just truthy
    if (blockEditor && blockEditor.MediaUpload && blockEditor.MediaUploadCheck && typeof blockEditor.MediaUpload === 'function' && typeof blockEditor.MediaUploadCheck === 'function') {
      return {
        MediaUpload: blockEditor.MediaUpload,
        MediaUploadCheck: blockEditor.MediaUploadCheck
      };
    }
  } catch (e) {
    // MediaUpload not available - will use wp.media fallback
  }
  // Always return an object, even if components are null
  return {
    MediaUpload: null,
    MediaUploadCheck: null
  };
};
const DuplicateSettingsFields = ({
  settings,
  onSettingsChange,
  postTypes,
  statusChoices,
  originalPost,
  featuredImage,
  onFeaturedImageChange
}) => {
  // Initialize settings with proper type and status values
  // If default is "same", use original post's value, otherwise use default
  const getInitialSettings = () => {
    const initial = {
      ...settings
    };

    // Handle type: if "same", use original post type
    if (settings.type === 'same' && originalPost?.type) {
      initial.type = originalPost.type;
    }

    // Handle status: if "same", use original post status
    if (settings.status === 'same' && originalPost?.status) {
      initial.status = originalPost.status;
    }
    return initial;
  };
  const [localSettings, setLocalSettings] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(getInitialSettings());
  const [slugManuallyEdited, setSlugManuallyEdited] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [fullTitle, setFullTitle] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [fullSlug, setFullSlug] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [initialized, setInitialized] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(false);

  // Get users list and current user from localized data
  const usersList = window.postDuplicatorVars?.users || [];
  const currentUser = window.postDuplicatorVars?.currentUser;

  // Initialize selectedAuthorId with a valid default (current user ID or first user in list)
  const defaultAuthorId = currentUser?.id ? String(currentUser.id) : usersList.length > 0 ? usersList[0].value : '';
  const [selectedAuthorId, setSelectedAuthorId] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(defaultAuthorId);
  const [postDate, setPostDate] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(new Date().toISOString());
  const [dateInputValue, setDateInputValue] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)('');

  // Check if MediaUpload is available at runtime
  const {
    MediaUpload,
    MediaUploadCheck
  } = getMediaUploadComponents();

  // Detect if we're on the post list screen (not in block editor)
  // MediaUpload components may not work properly outside the block editor context
  // Check if the editor store is available (only in block editor)
  let isPostListScreen = true;
  try {
    if (typeof window.wp !== 'undefined' && window.wp.data && typeof window.wp.data.select === 'function') {
      const editorStore = window.wp.data.select('core/editor');
      isPostListScreen = !editorStore || typeof editorStore.getCurrentPost !== 'function';
    }
  } catch (e) {
    // If we can't access the editor store, assume we're on post list screen
    isPostListScreen = true;
  }

  // Sanitize slug using WordPress-style sanitization
  const sanitizeSlug = text => {
    return text.toLowerCase().trim().replace(/\s+/g, '-') // Replace spaces with hyphens
    .replace(/[^\w\-]/g, '') // Remove non-word chars except hyphens
    .replace(/\-\-+/g, '-') // Replace multiple hyphens with single hyphen
    .replace(/^-+/, '') // Trim hyphens from start
    .replace(/-+$/, ''); // Trim hyphens from end
  };

  // Generate slug from title
  const generateSlugFromTitle = title => {
    return sanitizeSlug(title);
  };
  const handleChange = (field, value) => {
    const newSettings = {
      ...localSettings,
      [field]: value
    };

    // If changing timestamp to not-custom, clear customDate
    if (field === 'timestamp' && value !== 'custom') {
      newSettings.customDate = null;
    }
    setLocalSettings(newSettings);
    onSettingsChange(newSettings);
  };

  // Initialize full title and slug ONLY on mount or when originalPost changes
  (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!initialized && originalPost?.title && originalPost?.slug) {
      // Set initial full title
      const initialTitle = settings.fullTitle || `${originalPost.title} ${settings.title || ''}`;
      setFullTitle(initialTitle.trim());

      // Set initial full slug
      const initialSlug = settings.fullSlug || `${originalPost.slug}-${settings.slug || 'copy'}`;
      setFullSlug(initialSlug);

      // Set initial author based on default settings
      const initialAuthorId = settings.post_author === 'current_user' ? String(currentUser?.id || '') : String(originalPost.authorId || currentUser?.id || '');
      setSelectedAuthorId(initialAuthorId);

      // Set initial date
      const initialDate = settings.customDate || new Date().toISOString();
      setPostDate(initialDate);
      setDateInputValue(formatDateDisplay(initialDate));
      setInitialized(true);
    }
  }, [originalPost, initialized, settings, currentUser]);

  // Update localSettings when settings prop changes (but not title/slug)
  (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const updated = {
      ...settings
    };

    // Handle type: if "same", use original post type
    if (settings.type === 'same' && originalPost?.type) {
      updated.type = originalPost.type;
    }

    // Handle status: if "same", use original post status
    if (settings.status === 'same' && originalPost?.status) {
      updated.status = originalPost.status;
    }
    setLocalSettings(updated);
  }, [settings, originalPost]);

  // Format date for display
  const formatDateDisplay = dateString => {
    const date = new Date(dateString);
    return date.toLocaleString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  // Handle manual date input and format on blur
  const handleDateBlur = () => {
    try {
      const parsedDate = new Date(dateInputValue);
      if (!isNaN(parsedDate.getTime())) {
        // Valid date - format and save
        const formattedDate = parsedDate.toISOString();
        setPostDate(formattedDate);
        setDateInputValue(formatDateDisplay(formattedDate));
        handleChange('customDate', formattedDate);
      } else {
        // Invalid date - revert to previous valid date display
        setDateInputValue(formatDateDisplay(postDate));
      }
    } catch (error) {
      // Error parsing - revert to previous valid date display
      setDateInputValue(formatDateDisplay(postDate));
    }
  };

  // Handle date input changes (just update display value)
  const handleDateInputChange = value => {
    setDateInputValue(value);
  };

  // Handle date picker changes
  const handleDatePickerChange = value => {
    setPostDate(value);
    setDateInputValue(formatDateDisplay(value));
    handleChange('customDate', value);
  };
  const handleTitleChange = value => {
    setFullTitle(value);

    // Auto-generate slug from title if slug hasn't been manually edited
    if (!slugManuallyEdited && originalPost?.title) {
      const newSlug = generateSlugFromTitle(value);
      setFullSlug(newSlug);
    }

    // Pass full title to parent
    handleChange('fullTitle', value);
  };
  const handleSlugChange = value => {
    setFullSlug(value);
    setSlugManuallyEdited(true);

    // Pass full slug to parent
    handleChange('fullSlug', value);
  };
  const handleSlugBlur = () => {
    // If slug is empty, regenerate from title
    if (!fullSlug || fullSlug.trim() === '') {
      const regeneratedSlug = generateSlugFromTitle(fullTitle);
      setFullSlug(regeneratedSlug);
      handleChange('fullSlug', regeneratedSlug);
      // Reset manual edit flag since we're regenerating
      setSlugManuallyEdited(false);
    } else {
      // Sanitize slug on blur
      const sanitized = sanitizeSlug(fullSlug);
      setFullSlug(sanitized);
      handleChange('fullSlug', sanitized);
    }
  };
  const formatChoices = choices => {
    if (Array.isArray(choices)) {
      return choices;
    }
    return Object.entries(choices).map(([value, label]) => ({
      value,
      label
    }));
  };

  // Open WordPress media library using wp.media API (fallback for post list screen)
  const openWpMediaLibrary = () => {
    // Ensure wp.media is available
    if (typeof window.wp === 'undefined' || !window.wp.media) {
      console.error('WordPress media library is not available. Make sure wp_enqueue_media() is called.');
      alert((0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Media library is not available. Please refresh the page.', 'post-duplicator'));
      return;
    }
    const mediaFrame = window.wp.media({
      title: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Select or Upload Featured Image', 'post-duplicator'),
      button: {
        text: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Use this image', 'post-duplicator')
      },
      multiple: false,
      library: {
        type: 'image'
      }
    });
    mediaFrame.on('select', () => {
      const attachment = mediaFrame.state().get('selection').first().toJSON();
      const imageData = {
        id: attachment.id,
        url: attachment.url,
        thumbnail: attachment.sizes?.thumbnail?.url || attachment.url,
        alt: attachment.alt || ''
      };
      if (onFeaturedImageChange) {
        onFeaturedImageChange(imageData);
      }
    });
    mediaFrame.open();
  };

  // Render the featured image UI (shared between MediaUpload and wp.media)
  const renderFeaturedImageUI = openMediaLibrary => {
    // Generate alt text description
    const altText = featuredImage?.alt || '';
    const fileName = featuredImage?.url?.split('/').pop() || '';
    const describedBy = `editor-post-featured-image-${featuredImage?.id || 'new'}-describedby`;
    const imageDescription = altText ? altText : (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('The current image has no alternative text.', 'post-duplicator') + (fileName ? ` ${(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('The file name is:', 'post-duplicator')} ${fileName}` : '');
    return /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div", {
      className: "editor-post-featured-image__container",
      children: [featuredImage && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div", {
        id: describedBy,
        className: "hidden",
        children: imageDescription
      }), featuredImage ? /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.Fragment, {
        children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
          type: "button",
          className: "components-button editor-post-featured-image__preview is-next-40px-default-size",
          onClick: openMediaLibrary,
          "aria-label": (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Edit or replace the featured image', 'post-duplicator'),
          "aria-describedby": describedBy,
          "aria-haspopup": "dialog",
          children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("img", {
            className: "editor-post-featured-image__preview-image",
            src: featuredImage.url,
            alt: imageDescription
          })
        }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalHStack, {
          className: "editor-post-featured-image__actions",
          children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
            type: "button",
            className: "components-button editor-post-featured-image__action is-next-40px-default-size",
            onClick: openMediaLibrary,
            "aria-haspopup": "dialog",
            children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Replace', 'post-duplicator')
          }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
            type: "button",
            className: "components-button editor-post-featured-image__action is-next-40px-default-size",
            onClick: () => {
              if (onFeaturedImageChange) {
                onFeaturedImageChange(null);
              }
            },
            children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Remove', 'post-duplicator')
          })]
        })]
      }) : /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
        variant: "secondary",
        onClick: openMediaLibrary,
        __next40pxDefaultSize: true,
        children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Set featured image', 'post-duplicator')
      }), _wordpress_components__WEBPACK_IMPORTED_MODULE_1__.DropZone && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.DropZone, {
        onFilesDrop: files => {
          // Handle file drop - open media library
          if (files.length > 0) {
            openMediaLibrary();
          }
        },
        className: "components-drop-zone",
        children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div", {
          className: "components-drop-zone__content",
          children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div", {
            className: "components-drop-zone__content-inner",
            children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("svg", {
              xmlns: "http://www.w3.org/2000/svg",
              viewBox: "0 0 24 24",
              width: "24",
              height: "24",
              className: "components-drop-zone__content-icon",
              "aria-hidden": "true",
              focusable: "false",
              children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("path", {
                d: "M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"
              })
            }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("span", {
              className: "components-drop-zone__content-text",
              children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Drop files to upload', 'post-duplicator')
            })]
          })
        })
      })]
    });
  };
  return /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalVStack, {
    className: "duplicate-settings-fields",
    spacing: "20px",
    children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalHStack, {
      spacing: "16px",
      alignment: "stretch",
      className: "duplicate-settings-fields__top",
      children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalVStack, {
        className: "duplicate-settings-fields__title",
        children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.TextControl, {
          label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Title', 'post-duplicator'),
          value: fullTitle,
          onChange: handleTitleChange,
          __nextHasNoMarginBottom: true,
          __next40pxDefaultSize: true,
          style: {
            flex: 1
          }
        }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.TextControl, {
          label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Slug', 'post-duplicator'),
          value: fullSlug,
          onChange: handleSlugChange,
          onBlur: handleSlugBlur,
          __nextHasNoMarginBottom: true,
          __next40pxDefaultSize: true
        })]
      }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div", {
        className: "duplicate-settings-fields__featured-image",
        style: {
          minWidth: '200px',
          width: '35%',
          flex: '0 0 auto'
        },
        children: (() => {
          // On post list screen, always use wp.media fallback since MediaUploadCheck may block rendering
          // In block editor, use MediaUpload if available
          const shouldUseMediaUpload = !isPostListScreen && MediaUpload && MediaUploadCheck;
          if (shouldUseMediaUpload) {
            return /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(MediaUploadCheck, {
              children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(MediaUpload, {
                onSelect: media => {
                  const imageData = {
                    id: media.id,
                    url: media.url,
                    thumbnail: media.sizes?.thumbnail?.url || media.url,
                    alt: media.alt || ''
                  };
                  if (onFeaturedImageChange) {
                    onFeaturedImageChange(imageData);
                  }
                },
                allowedTypes: ['image'],
                value: featuredImage?.id,
                render: ({
                  open
                }) => {
                  return renderFeaturedImageUI(open);
                }
              })
            });
          } else {
            try {
              return renderFeaturedImageUI(() => openWpMediaLibrary());
            } catch (error) {
              console.error('Error rendering featured image UI:', error);
              return /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div", {
                children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("p", {
                  children: ["Error rendering featured image UI: ", error.message]
                }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
                  variant: "secondary",
                  onClick: () => openWpMediaLibrary(),
                  __next40pxDefaultSize: true,
                  children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Set featured image', 'post-duplicator')
                })]
              });
            }
          }
        })()
      })]
    }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalHStack, {
      spacing: "16px",
      alignment: "stretch",
      children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.SelectControl, {
        label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Post Type', 'post-duplicator'),
        value: localSettings.type,
        options: formatChoices(postTypes),
        onChange: value => handleChange('type', value),
        __nextHasNoMarginBottom: true,
        __next40pxDefaultSize: true
      }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.SelectControl, {
        label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Post Status', 'post-duplicator'),
        value: localSettings.status,
        options: formatChoices(statusChoices),
        onChange: value => handleChange('status', value),
        __nextHasNoMarginBottom: true,
        __next40pxDefaultSize: true
      })]
    }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalHStack, {
      spacing: "16px",
      alignment: "stretch",
      children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.SelectControl, {
        label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Post Author', 'post-duplicator'),
        value: selectedAuthorId || '',
        options: usersList,
        onChange: value => {
          setSelectedAuthorId(value);
          handleChange('selectedAuthorId', parseInt(value));
        },
        __nextHasNoMarginBottom: true,
        __next40pxDefaultSize: true
      }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div", {
        style: {
          flex: 1,
          position: 'relative'
        },
        children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.TextControl, {
          label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Post Date', 'post-duplicator'),
          value: dateInputValue,
          onChange: handleDateInputChange,
          onBlur: handleDateBlur,
          __nextHasNoMarginBottom: true,
          __next40pxDefaultSize: true
        }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Dropdown, {
          popoverProps: {
            placement: 'bottom-end',
            offset: 8
          },
          renderToggle: ({
            isOpen,
            onToggle
          }) => /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
            onClick: onToggle,
            "aria-expanded": isOpen,
            icon: _wordpress_icons__WEBPACK_IMPORTED_MODULE_3__["default"],
            style: {
              position: 'absolute',
              right: '2px',
              top: '26px',
              minWidth: '36px',
              height: '36px',
              padding: '0'
            },
            variant: "tertiary"
          }),
          renderContent: ({
            onClose
          }) => /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div", {
            style: {
              padding: '16px'
            },
            children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.DateTimePicker, {
              currentDate: postDate,
              onChange: handleDatePickerChange,
              is12Hour: false
            })
          })
        })]
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DuplicateSettingsFields);

/***/ }),

/***/ "./src/components/TaxonomySection.js":
/*!*******************************************!*\
  !*** ./src/components/TaxonomySection.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @wordpress/components */ "@wordpress/components");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @wordpress/i18n */ "@wordpress/i18n");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! react/jsx-runtime */ "react/jsx-runtime");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__);




const TaxonomySection = ({
  taxonomies,
  onChange,
  enabled,
  onToggle
}) => {
  const [isExpanded, setIsExpanded] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [selectedTerms, setSelectedTerms] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)({});

  // Initialize selected terms from taxonomies
  (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (taxonomies && taxonomies.length > 0) {
      const initialTerms = {};
      taxonomies.forEach(taxonomy => {
        // Use assignedTermIds if available (terms currently on the post)
        initialTerms[taxonomy.slug] = taxonomy.assignedTermIds || [];
      });
      setSelectedTerms(initialTerms);
    }
  }, [taxonomies]);

  // Calculate counts
  const taxonomyCount = taxonomies ? taxonomies.length : 0;
  const totalTermsCount = taxonomies ? taxonomies.reduce((sum, taxonomy) => sum + taxonomy.terms.length, 0) : 0;
  const selectedTermsCount = Object.values(selectedTerms).reduce((sum, termIds) => sum + termIds.length, 0);
  const handleTermChange = (taxonomySlug, termIds) => {
    const newSelectedTerms = {
      ...selectedTerms,
      [taxonomySlug]: termIds
    };
    setSelectedTerms(newSelectedTerms);

    // Notify parent of change
    if (onChange) {
      onChange(newSelectedTerms);
    }
  };
  const handleSectionClick = e => {
    // Don't expand if clicking the toggle
    if (e.target.closest('.components-toggle-control')) {
      return;
    }
    setIsExpanded(!isExpanded);
  };
  if (!taxonomies || taxonomies.length === 0) {
    return null;
  }
  return /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div", {
    className: "duplicate-post-modal__taxonomy-section",
    style: {
      opacity: enabled ? 1 : 0.5
    },
    children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div", {
      className: "duplicate-post-modal__section-header",
      onClick: handleSectionClick,
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '12px',
        padding: '12px',
        cursor: 'pointer',
        borderBottom: isExpanded ? '1px solid rgba(0, 0, 0, 0.1)' : 'none'
      },
      children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.ToggleControl, {
        checked: enabled,
        onChange: onToggle,
        __nextHasNoMarginBottom: true
      }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div", {
        style: {
          flex: 1
        },
        children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span", {
          className: "duplicate-post-modal__section-label",
          children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('Taxonomies', 'post-duplicator')
        }), enabled && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("span", {
          className: "duplicate-post-modal__section-count",
          children: [' ', "(", taxonomyCount, ' ', (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('taxonomies', 'post-duplicator'), ",", ' ', selectedTermsCount || totalTermsCount, ' ', (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)('terms', 'post-duplicator'), ")"]
        })]
      })]
    }), isExpanded && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div", {
      className: "duplicate-post-modal__section-content",
      style: {
        padding: '16px'
      },
      children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.__experimentalVStack, {
        spacing: "20px",
        children: taxonomies.map(taxonomy => {
          const currentTermIds = selectedTerms[taxonomy.slug] || [];

          // Get ALL term names for suggestions
          const termSuggestions = taxonomy.terms.map(term => term.name);

          // Get selected term names
          const selectedTermNames = taxonomy.terms.filter(term => currentTermIds.includes(term.id)).map(term => term.name);
          return /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div", {
            children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("label", {
              style: {
                display: 'block',
                marginBottom: '8px',
                fontWeight: 500
              },
              children: taxonomy.label
            }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.FormTokenField, {
              value: selectedTermNames,
              suggestions: termSuggestions,
              onChange: tokens => {
                // Convert term names back to IDs
                const newTermIds = tokens.map(tokenName => {
                  const term = taxonomy.terms.find(t => t.name === tokenName);
                  return term ? term.id : null;
                }).filter(id => id !== null);
                handleTermChange(taxonomy.slug, newTermIds);
              },
              __experimentalExpandOnFocus: true,
              __experimentalShowHowTo: false,
              __nextHasNoMarginBottom: true,
              __next40pxDefaultSize: true
            })]
          }, taxonomy.slug);
        })
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (TaxonomySection);

/***/ }),

/***/ "./src/css/gutenberg-button.scss":
/*!***************************************!*\
  !*** ./src/css/gutenberg-button.scss ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/utils/duplicatePost.js":
/*!************************************!*\
  !*** ./src/utils/duplicatePost.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   duplicatePost: () => (/* binding */ duplicatePost)
/* harmony export */ });
/**
 * Shared utility function to duplicate a post
 *
 * @param {number} postId - The ID of the post to duplicate
 * @param {Object} settings - The duplication settings
 * @param {Object} callbacks - Callback functions for different scenarios
 * @param {Function} callbacks.onSuccess - Called when duplication succeeds, receives { duplicate_id }
 * @param {Function} callbacks.onError - Called when duplication fails, receives error object
 * @returns {Promise} Promise that resolves when the duplication is complete
 */
const duplicatePost = async (postId, settings, callbacks = {}) => {
  const {
    onSuccess,
    onError
  } = callbacks;
  try {
    const response = await fetch(`${postDuplicatorVars.restUrl}duplicate-post`, {
      method: 'POST',
      headers: {
        'X-WP-Nonce': postDuplicatorVars.nonce,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        original_id: postId,
        ...settings
      })
    });
    if (!response.ok) {
      const errorData = await response.json();
      const error = new Error(errorData.message || 'Failed to duplicate post');
      error.data = errorData;
      throw error;
    }
    const result = await response.json();
    if (result.duplicate_id && onSuccess) {
      onSuccess(result);
    }
    return result;
  } catch (error) {
    console.error('Error duplicating post:', error);
    if (onError) {
      onError(error);
    }
    throw error;
  }
};

/***/ }),

/***/ "@wordpress/block-editor":
/*!*************************************!*\
  !*** external ["wp","blockEditor"] ***!
  \*************************************/
/***/ ((module) => {

module.exports = window["wp"]["blockEditor"];

/***/ }),

/***/ "@wordpress/components":
/*!************************************!*\
  !*** external ["wp","components"] ***!
  \************************************/
/***/ ((module) => {

module.exports = window["wp"]["components"];

/***/ }),

/***/ "@wordpress/data":
/*!******************************!*\
  !*** external ["wp","data"] ***!
  \******************************/
/***/ ((module) => {

module.exports = window["wp"]["data"];

/***/ }),

/***/ "@wordpress/editor":
/*!********************************!*\
  !*** external ["wp","editor"] ***!
  \********************************/
/***/ ((module) => {

module.exports = window["wp"]["editor"];

/***/ }),

/***/ "@wordpress/element":
/*!*********************************!*\
  !*** external ["wp","element"] ***!
  \*********************************/
/***/ ((module) => {

module.exports = window["wp"]["element"];

/***/ }),

/***/ "@wordpress/i18n":
/*!******************************!*\
  !*** external ["wp","i18n"] ***!
  \******************************/
/***/ ((module) => {

module.exports = window["wp"]["i18n"];

/***/ }),

/***/ "@wordpress/plugins":
/*!*********************************!*\
  !*** external ["wp","plugins"] ***!
  \*********************************/
/***/ ((module) => {

module.exports = window["wp"]["plugins"];

/***/ }),

/***/ "@wordpress/primitives":
/*!************************************!*\
  !*** external ["wp","primitives"] ***!
  \************************************/
/***/ ((module) => {

module.exports = window["wp"]["primitives"];

/***/ }),

/***/ "react/jsx-runtime":
/*!**********************************!*\
  !*** external "ReactJSXRuntime" ***!
  \**********************************/
/***/ ((module) => {

module.exports = window["ReactJSXRuntime"];

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry needs to be wrapped in an IIFE because it needs to be isolated against other modules in the chunk.
(() => {
/*!*********************************!*\
  !*** ./src/gutenberg-button.js ***!
  \*********************************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _wordpress_plugins__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @wordpress/plugins */ "@wordpress/plugins");
/* harmony import */ var _wordpress_plugins__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_wordpress_plugins__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _wordpress_editor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @wordpress/editor */ "@wordpress/editor");
/* harmony import */ var _wordpress_editor__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_wordpress_editor__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @wordpress/components */ "@wordpress/components");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _wordpress_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @wordpress/data */ "@wordpress/data");
/* harmony import */ var _wordpress_data__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_wordpress_data__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @wordpress/i18n */ "@wordpress/i18n");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _components_DuplicateModal__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./components/DuplicateModal */ "./src/components/DuplicateModal.js");
/* harmony import */ var _utils_duplicatePost__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./utils/duplicatePost */ "./src/utils/duplicatePost.js");
/* harmony import */ var _css_gutenberg_button_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./css/gutenberg-button.scss */ "./src/css/gutenberg-button.scss");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! react/jsx-runtime */ "react/jsx-runtime");
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__);










const DuplicatePostButton = () => {
  const [isLoading, setIsLoading] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_4__.useState)(false);
  const [error, setError] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_4__.useState)(null);
  const [isModalOpen, setIsModalOpen] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_4__.useState)(false);
  const [taxonomies, setTaxonomies] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_4__.useState)([]);
  const [customMeta, setCustomMeta] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_4__.useState)([]);
  const [featuredImage, setFeaturedImage] = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_4__.useState)(null);
  const {
    postId,
    postType,
    postStatus,
    postTypeLabel,
    postTitle,
    postSlug,
    postDate,
    postAuthor,
    featuredMediaId
  } = (0,_wordpress_data__WEBPACK_IMPORTED_MODULE_3__.useSelect)(select => {
    const editor = select('core/editor');
    const currentPost = editor.getCurrentPost();
    const currentPostType = editor.getCurrentPostType();
    const postTypeObj = select('core').getPostType(currentPostType);
    const authorId = editor.getEditedPostAttribute('author');

    // Get author name
    const author = select('core').getUser(authorId);
    const authorName = author ? author.name : 'Unknown Author';

    // Get featured media ID
    const featuredMediaId = editor.getEditedPostAttribute('featured_media');
    return {
      postId: currentPost.id,
      postType: currentPostType,
      postStatus: editor.getEditedPostAttribute('status'),
      postTypeLabel: postTypeObj ? postTypeObj.labels.singular_name : 'Post',
      postTitle: editor.getEditedPostAttribute('title'),
      postSlug: editor.getEditedPostAttribute('slug'),
      postDate: editor.getEditedPostAttribute('date'),
      postAuthor: authorName,
      featuredMediaId: featuredMediaId
    };
  }, []);

  // Fetch taxonomy, custom meta, and featured image data when modal opens
  (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_4__.useEffect)(() => {
    if (isModalOpen && postId) {
      const fetchPostData = async () => {
        try {
          const response = await fetch(`${postDuplicatorVars.restUrl}post-data/${postId}`, {
            headers: {
              'X-WP-Nonce': postDuplicatorVars.nonce
            }
          });
          if (response.ok) {
            const postData = await response.json();
            setTaxonomies(postData.taxonomies || []);
            setCustomMeta(postData.customMeta || []);
          }

          // Fetch featured image if available
          if (featuredMediaId && featuredMediaId > 0) {
            try {
              const baseUrl = postDuplicatorVars.restUrl.replace('post-duplicator/v1/', 'wp/v2/');
              const mediaResponse = await fetch(`${baseUrl}media/${featuredMediaId}`, {
                headers: {
                  'X-WP-Nonce': postDuplicatorVars.nonce
                }
              });
              if (mediaResponse.ok) {
                const mediaData = await mediaResponse.json();
                setFeaturedImage({
                  id: mediaData.id,
                  url: mediaData.source_url,
                  thumbnail: mediaData.media_details?.sizes?.thumbnail?.source_url || mediaData.source_url,
                  alt: mediaData.alt_text || ''
                });
              } else {
                setFeaturedImage(null);
              }
            } catch (error) {
              console.error('Error fetching featured image:', error);
              setFeaturedImage(null);
            }
          } else {
            setFeaturedImage(null);
          }
        } catch (error) {
          console.error('Error fetching post data:', error);
          // Continue without taxonomy/meta data
        }
      };
      fetchPostData();
    }
  }, [isModalOpen, postId, featuredMediaId]);

  // Only show for published posts
  if (postStatus !== 'publish' || !postId) {
    return null;
  }
  const handleDuplicate = async (settings, callbacks) => {
    setIsLoading(true);
    setError(null);
    await (0,_utils_duplicatePost__WEBPACK_IMPORTED_MODULE_7__.duplicatePost)(postId, settings, {
      onSuccess: result => {
        setIsLoading(false);
        if (callbacks?.onSuccess) {
          callbacks.onSuccess(result);
        }
      },
      onError: error => {
        setError(error.message || error.data?.message || 'Failed to duplicate post');
        setIsLoading(false);
        if (callbacks?.onError) {
          callbacks.onError(error);
        }
      }
    });
  };
  const originalPost = {
    id: postId,
    title: postTitle,
    type: postType,
    status: postStatus,
    slug: postSlug,
    date: postDate,
    author: postAuthor,
    taxonomies: taxonomies,
    customMeta: customMeta,
    featuredImage: featuredImage
  };
  return /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment, {
    children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_wordpress_editor__WEBPACK_IMPORTED_MODULE_1__.PluginPostStatusInfo, {
      className: "m4c-duplicate-post-status-info",
      children: /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div", {
        className: "m4c-duplicate-post-wrapper",
        style: {
          paddingTop: '16px'
        },
        children: [/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_wordpress_components__WEBPACK_IMPORTED_MODULE_2__.Button, {
          variant: "secondary",
          className: "m4c-duplicate-post-gutenberg",
          onClick: () => setIsModalOpen(true),
          disabled: isLoading,
          children: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_5__.__)(`Duplicate ${postTypeLabel}`, 'post-duplicator')
        }), error && /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div", {
          className: "m4c-duplicate-error",
          children: error
        })]
      })
    }), /*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_components_DuplicateModal__WEBPACK_IMPORTED_MODULE_6__["default"], {
      isOpen: isModalOpen,
      onClose: () => setIsModalOpen(false),
      onDuplicate: handleDuplicate,
      originalPost: originalPost,
      defaultSettings: postDuplicatorVars.defaultSettings,
      postTypes: postDuplicatorVars.postTypes,
      statusChoices: postDuplicatorVars.statusChoices,
      siteUrl: postDuplicatorVars.siteUrl,
      currentUser: postDuplicatorVars.currentUser
    })]
  });
};
(0,_wordpress_plugins__WEBPACK_IMPORTED_MODULE_0__.registerPlugin)('post-duplicator-button', {
  render: DuplicatePostButton
});
})();

/******/ })()
;
//# sourceMappingURL=gutenbergButton.js.map