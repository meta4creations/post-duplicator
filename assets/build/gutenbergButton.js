(()=>{"use strict";const t=window.wp.plugins,e=window.wp.editPost,s=window.wp.components,a=window.wp.data,o=window.wp.element,i=window.wp.i18n,l=window.wp.primitives,n=window.ReactJSXRuntime,r=(0,n.jsx)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(l.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})}),p=(0,n.jsx)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(l.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),c=(0,n.jsx)(l.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)(l.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm.5 16c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5V7h15v12zM9 10H7v2h2v-2zm0 4H7v2h2v-2zm4-4h-2v2h2v-2zm4 0h-2v2h2v-2zm-4 4h-2v2h2v-2zm4 0h-2v2h2v-2z"})}),u=({settings:t,onSettingsChange:e,postTypes:a,statusChoices:l,originalPost:r})=>{const[p,u]=(0,o.useState)(t),[d,m]=(0,o.useState)(!1),[_,g]=(0,o.useState)(""),[h,x]=(0,o.useState)(""),[w,S]=(0,o.useState)(!1),v=window.postDuplicatorVars?.users||[],f=window.postDuplicatorVars?.currentUser,j=f?.id?String(f.id):v.length>0?v[0].value:"",[y,D]=(0,o.useState)(j),[b,C]=(0,o.useState)((new Date).toISOString()),[N,P]=(0,o.useState)(""),T=t=>t.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),$=t=>T(t),z=(t,s)=>{const a={...p,[t]:s};"timestamp"===t&&"custom"!==s&&(a.customDate=null),u(a),e(a)};(0,o.useEffect)((()=>{if(!w&&r?.title&&r?.slug){const e=t.fullTitle||`${r.title} ${t.title||""}`;g(e.trim());const s=t.fullSlug||`${r.slug}-${t.slug||"copy"}`;x(s);const a="current_user"===t.post_author?String(f?.id||""):String(r.authorId||f?.id||"");D(a);const o=t.customDate||(new Date).toISOString();C(o),P(B(o)),S(!0)}}),[r,w,t,f]),(0,o.useEffect)((()=>{u(t)}),[t]);const B=t=>new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),H=t=>{C(t),P(B(t)),z("customDate",t)},V=t=>Array.isArray(t)?t:Object.entries(t).map((([t,e])=>({value:t,label:e})));return(0,n.jsxs)(s.__experimentalVStack,{className:"duplicate-settings-fields",spacing:"20px",children:[(0,n.jsxs)(s.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,n.jsx)(s.TextControl,{label:(0,i.__)("Title","post-duplicator"),value:_,onChange:t=>{if(g(t),!d&&r?.title){const e=$(t);x(e)}z("fullTitle",t)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,n.jsx)(s.TextControl,{label:(0,i.__)("Slug","post-duplicator"),value:h,onChange:t=>{x(t),m(!0),z("fullSlug",t)},onBlur:()=>{if(h&&""!==h.trim()){const t=T(h);x(t),z("fullSlug",t)}else{const t=$(_);x(t),z("fullSlug",t),m(!1)}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,n.jsxs)(s.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,n.jsx)(s.SelectControl,{label:(0,i.__)("Post Status","post-duplicator"),value:p.status,options:V(l),onChange:t=>z("status",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,n.jsx)(s.SelectControl,{label:(0,i.__)("Post Type","post-duplicator"),value:p.type,options:V(a),onChange:t=>z("type",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,n.jsxs)(s.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,n.jsx)(s.SelectControl,{label:(0,i.__)("Post Author","post-duplicator"),value:y||"",options:v,onChange:t=>{D(t),z("selectedAuthorId",parseInt(t))},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,n.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,n.jsx)(s.TextControl,{label:(0,i.__)("Post Date","post-duplicator"),value:N,onChange:t=>{P(t)},onBlur:()=>{try{const t=new Date(N);if(isNaN(t.getTime()))P(B(b));else{const e=t.toISOString();C(e),P(B(e)),z("customDate",e)}}catch(t){P(B(b))}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,n.jsx)(s.Dropdown,{position:"bottom right",popoverProps:{placement:"bottom-end",offset:8},renderToggle:({isOpen:t,onToggle:e})=>(0,n.jsx)(s.Button,{onClick:e,"aria-expanded":t,icon:c,style:{position:"absolute",right:"2px",top:"26px",minWidth:"36px",height:"36px",padding:"0"},variant:"tertiary"}),renderContent:({onClose:t})=>(0,n.jsx)("div",{style:{padding:"16px"},children:(0,n.jsx)(s.DateTimePicker,{currentDate:b,onChange:H,is12Hour:!1})})})]})]})]})},d=({isOpen:t,onClose:e,onDuplicate:a,originalPost:l,defaultSettings:c,postTypes:d,statusChoices:m,siteUrl:_,currentUser:g})=>{const[h,x]=(0,o.useState)(c),[w,S]=(0,o.useState)(!1),[v,f]=(0,o.useState)(!1);(0,o.useEffect)((()=>{t&&(x(c),S(!1))}),[t,c]);const j=()=>{const t="same"===h.type?l.type:h.type;return d[t]||t};if(!t)return null;const y=(0,n.jsx)(s.Button,{icon:w?r:p,label:w?(0,i.__)("Done Customizing","post-duplicator"):(0,i.__)("Customize Settings","post-duplicator"),onClick:()=>S(!w),size:"small"});return(0,n.jsxs)(s.Modal,{title:l?.title?h.fullTitle?h.fullTitle:`${l.title} ${h.title}`:"",onRequestClose:e,className:"duplicate-post-modal",size:"large",style:{borderRadius:0},headerActions:y,children:[(0,n.jsxs)("div",{className:"duplicate-post-modal__content",style:{paddingBottom:"77px"},children:[(0,n.jsxs)("div",{className:"duplicate-post-modal__preview",children:[(0,n.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,n.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,i.__)("Post Type:","post-duplicator")}),(0,n.jsx)("span",{className:"duplicate-post-modal__preview-value",children:j()})]}),(0,n.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,n.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,i.__)("Post Status:","post-duplicator")}),(0,n.jsx)("span",{className:"duplicate-post-modal__preview-value",children:(()=>{const t="same"===h.status?l.status:h.status;return m[t]||t})()})]}),(0,n.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,n.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,i.__)("Post Date:","post-duplicator")}),(0,n.jsx)("span",{className:"duplicate-post-modal__preview-value",children:(()=>{let t;if(t=h.customDate?new Date(h.customDate).getTime():"duplicate"===h.timestamp&&l.date?new Date(l.date).getTime():Date.now(),h.time_offset){const e=1e3*(86400*parseInt(h.time_offset_days||0)+3600*parseInt(h.time_offset_hours||0)+60*parseInt(h.time_offset_minutes||0)+parseInt(h.time_offset_seconds||0));"newer"===h.time_offset_direction?t+=e:t-=e}const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`})()})]}),(0,n.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,n.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,i.__)("Post Author:","post-duplicator")}),(0,n.jsx)("span",{className:"duplicate-post-modal__preview-value",children:"current_user"===h.post_author?g?.name||(0,i.__)("Current User","post-duplicator"):l?.author?l.author:(0,i.__)("Original Author","post-duplicator")})]}),(0,n.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,n.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,i.__)("Post URL:","post-duplicator")}),(0,n.jsx)("span",{className:"duplicate-post-modal__preview-value duplicate-post-modal__preview-url",children:(()=>{const t=l?.slug?h.fullSlug?h.fullSlug:`${l.slug}-${h.slug||"copy"}`:"";return t&&_?`${_}/${t}/`:""})()})]})]}),w&&(0,n.jsx)("div",{className:"duplicate-post-modal__settings",children:(0,n.jsx)(u,{settings:h,onSettingsChange:x,postTypes:d,statusChoices:m,originalPost:l})})]}),(0,n.jsxs)(s.__experimentalHStack,{alignment:"right",className:"duplicate-post-modal__footer",style:{position:"absolute",bottom:"0px",left:"0",padding:"20px",borderTop:"1px solid rgba(0, 0, 0, 0.1)",background:"#FFF"},children:[(0,n.jsx)(s.Button,{variant:"tertiary",onClick:e,disabled:v,children:(0,i.__)("Cancel","post-duplicator")}),(0,n.jsx)(s.Button,{variant:"primary",onClick:async()=>{f(!0);try{await a(h)}catch(t){console.error("Error duplicating:",t)}finally{f(!1)}},disabled:v,isBusy:v,children:v?(0,i.__)("Duplicating...","post-duplicator"):(()=>{const t=j();return(0,i.__)(`Duplicate ${t}`,"post-duplicator")})()})]})]})};(0,t.registerPlugin)("post-duplicator-button",{render:()=>{const[t,l]=(0,o.useState)(!1),[r,p]=(0,o.useState)(null),[c,u]=(0,o.useState)(!1),{postId:m,postType:_,postStatus:g,postTypeLabel:h,postTitle:x,postSlug:w,postDate:S,postAuthor:v}=(0,a.useSelect)((t=>{const e=t("core/editor"),s=e.getCurrentPost(),a=e.getCurrentPostType(),o=t("core").getPostType(a),i=e.getEditedPostAttribute("author"),l=t("core").getUser(i),n=l?l.name:"Unknown Author";return{postId:s.id,postType:a,postStatus:e.getEditedPostAttribute("status"),postTypeLabel:o?o.labels.singular_name:"Post",postTitle:e.getEditedPostAttribute("title"),postSlug:e.getEditedPostAttribute("slug"),postDate:e.getEditedPostAttribute("date"),postAuthor:n}}),[]);if("publish"!==g||!m)return null;const f={id:m,title:x,type:_,status:g,slug:w,date:S,author:v};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.PluginPostStatusInfo,{className:"m4c-duplicate-post-status-info",children:(0,n.jsxs)("div",{className:"m4c-duplicate-post-wrapper",style:{paddingTop:"16px"},children:[(0,n.jsx)(s.Button,{variant:"secondary",className:"m4c-duplicate-post-gutenberg",onClick:()=>u(!0),disabled:t,children:(0,i.__)(`Duplicate ${h}`,"post-duplicator")}),r&&(0,n.jsx)("div",{className:"m4c-duplicate-error",children:r})]})}),(0,n.jsx)(d,{isOpen:c,onClose:()=>u(!1),onDuplicate:async t=>{l(!0),p(null);try{const e=await fetch(`${postDuplicatorVars.restUrl}duplicate-post`,{method:"POST",headers:{"X-WP-Nonce":postDuplicatorVars.nonce,"Content-Type":"application/json"},body:JSON.stringify({original_id:m,...t})});if(!e.ok){const t=await e.json();throw new Error(t.message||"Failed to duplicate post")}const s=await e.json();if(s.duplicate_id){const t=`${postDuplicatorVars.siteUrl}/wp-admin/post.php?post=${s.duplicate_id}&action=edit`;window.open(t,"_blank"),l(!1),u(!1)}}catch(t){console.error("Error duplicating post:",t),p(t.message),l(!1)}},originalPost:f,defaultSettings:postDuplicatorVars.defaultSettings,postTypes:postDuplicatorVars.postTypes,statusChoices:postDuplicatorVars.statusChoices,siteUrl:postDuplicatorVars.siteUrl,currentUser:postDuplicatorVars.currentUser})]})}})})();