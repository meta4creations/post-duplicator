(()=>{"use strict";var t={715:t=>{t.exports=window.wp.blockEditor}},e={};function s(a){var o=e[a];if(void 0!==o)return o.exports;var i=e[a]={exports:{}};return t[a](i,i.exports,s),i.exports}const a=window.wp.plugins,o=window.wp.editor,i=window.wp.components,l=window.wp.data,n=window.wp.element,r=window.wp.i18n,c=window.wp.primitives,p=window.ReactJSXRuntime,d=(0,p.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,p.jsx)(c.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5 4.5h11a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V5a.5.5 0 0 1 .5-.5ZM3 5a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5Zm17 3v10.75c0 .69-.56 1.25-1.25 1.25H6v1.5h12.75a2.75 2.75 0 0 0 2.75-2.75V8H20Z"})}),u=(0,p.jsx)(c.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,p.jsx)(c.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm.5 16c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5V7h15v12zM9 10H7v2h2v-2zm0 4H7v2h2v-2zm4-4h-2v2h2v-2zm4 0h-2v2h2v-2zm-4 4h-2v2h2v-2zm4 0h-2v2h2v-2z"})}),m=({settings:t,onSettingsChange:e,postTypes:a,statusChoices:o,originalPost:l,featuredImage:c,onFeaturedImageChange:d})=>{const[m,g]=(0,n.useState)((()=>{const e={...t};return"same"===t.type&&l?.type&&(e.type=l.type),"same"===t.status&&l?.status&&(e.status=l.status),e})()),[_,x]=(0,n.useState)(!1),[h,f]=(0,n.useState)(""),[y,v]=(0,n.useState)(""),[S,j]=(0,n.useState)(!1),w=window.postDuplicatorVars?.users||[],b=window.postDuplicatorVars?.currentUser,P=window.postDuplicatorVars?.postTypesAuthorSupport||{},C=window.postDuplicatorVars?.postTypesHierarchicalSupport||{},D=()=>"same"===m.type?l?.type:m.type,N=()=>{const t=D();return!0===C[t]},[k,T]=(0,n.useState)((()=>{const t=l?.type;return!1!==P[t]?b?.id?String(b.id):w.length>0?w[0].value:"":""})()),[M,I]=(0,n.useState)(""),[E,z]=(0,n.useState)([]),[$,V]=(0,n.useState)((new Date).toISOString()),[B,U]=(0,n.useState)(""),{MediaUpload:H,MediaUploadCheck:A}=(()=>{try{const t=s(715);if(t&&t.MediaUpload&&t.MediaUploadCheck&&"function"==typeof t.MediaUpload&&"function"==typeof t.MediaUploadCheck)return{MediaUpload:t.MediaUpload,MediaUploadCheck:t.MediaUploadCheck}}catch(t){}return{MediaUpload:null,MediaUploadCheck:null}})();let F=!0;try{if(void 0!==window.wp&&window.wp.data&&"function"==typeof window.wp.data.select){const t=window.wp.data.select("core/editor");F=!t||"function"!=typeof t.getCurrentPost}}catch(t){F=!0}const O=t=>t.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),R=t=>O(t),L=(t,s)=>{const a={...m,[t]:s};"timestamp"===t&&"custom"!==s&&(a.customDate=null),g(a),e(a)};(0,n.useEffect)((()=>{if(!S&&l?.title&&l?.slug){const s=t.fullTitle||`${l.title} ${t.title||""}`;f(s.trim());const a=t.fullSlug||`${l.slug}-${t.slug||"copy"}`;v(a);const o={...t,fullTitle:s.trim(),fullSlug:a};g(o),e(o);const i=l?.type;let n="";!1!==P[i]&&(n="current_user"===t.post_author?String(b?.id||""):String(l.authorId||b?.id||"")),T(n);const r=t.customDate||(new Date).toISOString();V(r),U(W(r));const c=l?.parent||0;I(c>0?String(c):""),L("selectedParentId",c>0?c:null),j(!0)}}),[l,S,t,b]),(0,n.useEffect)((()=>{(async()=>{if(!l?.type)return void z([]);const t="same"===m.type?l.type:m.type;try{const e=await fetch(`${window.postDuplicatorVars.restUrl}parent-posts?post_type=${t}&exclude_id=${l.id}`,{headers:{"X-WP-Nonce":window.postDuplicatorVars.nonce}});if(e.ok){const t=await e.json(),s=t=>{const e=t.level||0;return 0===e?t.title:`${"—".repeat(e)+" "}${t.title}`},a=[{label:(0,r.__)("— No Parent —","post-duplicator"),value:""},...t.map((t=>({label:s(t),value:String(t.id),level:t.level||0})))];z(a),l?.parentPost&&l.parent>0&&(t.some((t=>t.id===l.parent))||(a.splice(1,0,{label:l.parentPost.title,value:String(l.parent),level:0}),z(a)))}}catch(t){console.error("Error fetching parent posts:",t),z([{label:(0,r.__)("— No Parent —","post-duplicator"),value:""}])}})()}),[l?.type,m.type,l?.id,l?.parent,l?.parentPost]),(0,n.useEffect)((()=>{const e={...t};"same"===t.type&&l?.type&&(e.type=l.type),"same"===t.status&&l?.status&&(e.status=l.status),g(e)}),[t,l]),(0,n.useEffect)((()=>{if(!S)return;const t=D(),e=!1!==P[t];if(e||""===k){if(e&&""===k&&b?.id){const t=String(b.id);T(t),L("selectedAuthorId",parseInt(t))}}else T(""),L("selectedAuthorId",null)}),[m.type,S]),(0,n.useEffect)((()=>{S&&(N()||""===M||(I(""),L("selectedParentId",null)))}),[m.type,S]);const W=t=>new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Z=t=>{const s=t instanceof Date?t.toISOString():new Date(t).toISOString();V(s),U(W(s));const a={...m,timestamp:"custom",customDate:s};g(a),e(a)},G=t=>Array.isArray(t)?t:Object.entries(t).map((([t,e])=>({value:t,label:e}))),J=()=>{if(void 0===window.wp||!window.wp.media)return console.error("WordPress media library is not available. Make sure wp_enqueue_media() is called."),void alert((0,r.__)("Media library is not available. Please refresh the page.","post-duplicator"));const t=window.wp.media({title:(0,r.__)("Select or Upload Featured Image","post-duplicator"),button:{text:(0,r.__)("Use this image","post-duplicator")},multiple:!1,library:{type:"image"}});t.on("select",(()=>{const e=t.state().get("selection").first().toJSON(),s={id:e.id,url:e.url,thumbnail:e.sizes?.thumbnail?.url||e.url,alt:e.alt||""};d&&d(s)})),t.open()},X=t=>{const e=c?.alt||"",s=c?.url?.split("/").pop()||"",a=`editor-post-featured-image-${c?.id||"new"}-describedby`,o=e||(0,r.__)("The current image has no alternative text.","post-duplicator")+(s?` ${(0,r.__)("The file name is:","post-duplicator")} ${s}`:"");return(0,p.jsxs)("div",{className:"editor-post-featured-image__container",children:[c&&(0,p.jsx)("div",{id:a,className:"hidden",children:o}),c?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.Button,{type:"button",className:"components-button editor-post-featured-image__preview is-next-40px-default-size",onClick:t,"aria-label":(0,r.__)("Edit or replace the featured image","post-duplicator"),"aria-describedby":a,"aria-haspopup":"dialog",children:(0,p.jsx)("img",{className:"editor-post-featured-image__preview-image",src:c.url,alt:o})}),(0,p.jsxs)(i.__experimentalHStack,{className:"editor-post-featured-image__actions",children:[(0,p.jsx)(i.Button,{type:"button",className:"components-button editor-post-featured-image__action is-next-40px-default-size",onClick:t,"aria-haspopup":"dialog",children:(0,r.__)("Replace","post-duplicator")}),(0,p.jsx)(i.Button,{type:"button",className:"components-button editor-post-featured-image__action is-next-40px-default-size",onClick:()=>{d&&d(null)},children:(0,r.__)("Remove","post-duplicator")})]})]}):(0,p.jsx)(i.Button,{variant:"secondary",onClick:t,__next40pxDefaultSize:!0,children:(0,r.__)("Set featured image","post-duplicator")}),i.DropZone&&(0,p.jsx)(i.DropZone,{onFilesDrop:e=>{e.length>0&&t()},className:"components-drop-zone",children:(0,p.jsx)("div",{className:"components-drop-zone__content",children:(0,p.jsxs)("div",{className:"components-drop-zone__content-inner",children:[(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",className:"components-drop-zone__content-icon","aria-hidden":"true",focusable:"false",children:(0,p.jsx)("path",{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})}),(0,p.jsx)("span",{className:"components-drop-zone__content-text",children:(0,r.__)("Drop files to upload","post-duplicator")})]})})})]})};return(0,p.jsxs)(i.__experimentalVStack,{className:"duplicate-settings-fields",spacing:"20px",children:[(0,p.jsxs)(i.__experimentalHStack,{spacing:"16px",alignment:"stretch",className:"duplicate-settings-fields__top",children:[(0,p.jsxs)(i.__experimentalVStack,{className:"duplicate-settings-fields__title",children:[(0,p.jsx)(i.TextControl,{label:(0,r.__)("Title","post-duplicator"),value:h,onChange:t=>{if(f(t),!_&&l?.title){const s=R(t);v(s);const a={...m,fullTitle:t,fullSlug:s};g(a),e(a)}else L("fullTitle",t)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,style:{flex:1}}),(0,p.jsx)(i.TextControl,{label:(0,r.__)("Slug","post-duplicator"),value:y,onChange:t=>{v(t),x(!0),L("fullSlug",t)},onBlur:()=>{if(y&&""!==y.trim()){const t=O(y);v(t),L("fullSlug",t)}else{const t=R(h);v(t),L("fullSlug",t),x(!1)}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,p.jsx)("div",{className:"duplicate-settings-fields__featured-image",style:{minWidth:"200px",width:"35%",flex:"0 0 auto"},children:(()=>{if(!F&&H&&A)return(0,p.jsx)(A,{children:(0,p.jsx)(H,{onSelect:t=>{const e={id:t.id,url:t.url,thumbnail:t.sizes?.thumbnail?.url||t.url,alt:t.alt||""};d&&d(e)},allowedTypes:["image"],value:c?.id,render:({open:t})=>X(t)})});try{return X((()=>J()))}catch(t){return console.error("Error rendering featured image UI:",t),(0,p.jsxs)("div",{children:[(0,p.jsxs)("p",{children:["Error rendering featured image UI: ",t.message]}),(0,p.jsx)(i.Button,{variant:"secondary",onClick:()=>J(),__next40pxDefaultSize:!0,children:(0,r.__)("Set featured image","post-duplicator")})]})}})()})]}),(0,p.jsxs)(i.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,p.jsx)(i.SelectControl,{label:(0,r.__)("Post Type","post-duplicator"),value:m.type,options:G(a),onChange:t=>L("type",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,p.jsx)(i.SelectControl,{label:(0,r.__)("Post Status","post-duplicator"),value:m.status,options:G(o),onChange:t=>L("status",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,p.jsx)(i.SelectControl,{label:(0,r.__)("Post Parent","post-duplicator"),value:M||"",options:E,onChange:t=>{I(t),L("selectedParentId",t?parseInt(t):null)},disabled:!N(),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,p.jsxs)(i.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,p.jsx)(i.SelectControl,{label:(0,r.__)("Post Author","post-duplicator"),value:k||"",options:[{label:(0,r.__)("No Author","post-duplicator"),value:""},...w],onChange:t=>{T(t),L("selectedAuthorId",t?parseInt(t):null)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,p.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,p.jsx)(i.TextControl,{label:(0,r.__)("Post Date","post-duplicator"),value:B,onChange:t=>{U(t)},onBlur:()=>{try{const t=new Date(B);if(isNaN(t.getTime()))U(W($));else{const s=t.toISOString();V(s),U(W(s));const a={...m,timestamp:"custom",customDate:s};g(a),e(a)}}catch(t){U(W($))}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,p.jsx)(i.Dropdown,{popoverProps:{placement:"bottom-end",offset:8},renderToggle:({isOpen:t,onToggle:e})=>(0,p.jsx)(i.Button,{onClick:e,"aria-expanded":t,icon:u,style:{position:"absolute",right:"2px",top:"26px",minWidth:"36px",height:"36px",padding:"0"},variant:"tertiary"}),renderContent:({onClose:t})=>(0,p.jsx)("div",{style:{padding:"16px"},children:(0,p.jsx)(i.DateTimePicker,{currentDate:$,onChange:Z,is12Hour:!1})})})]})]})]})},g=({taxonomies:t,onChange:e,enabled:s,onToggle:a})=>{const[o,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)({});(0,n.useEffect)((()=>{if(t&&t.length>0){const e={};t.forEach((t=>{e[t.slug]=t.assignedTermIds||[]})),d(e)}}),[t]);const u=t?t.length:0,m=t?t.reduce(((t,e)=>t+e.terms.length),0):0,g=Object.values(c).reduce(((t,e)=>t+e.length),0);return t&&0!==t.length?(0,p.jsxs)("div",{className:"duplicate-post-modal__taxonomy-section",style:{opacity:s?1:.5},children:[(0,p.jsxs)("div",{className:"duplicate-post-modal__section-header",onClick:t=>{t.target.closest(".components-toggle-control")||l(!o)},style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",cursor:"pointer",borderBottom:o?"1px solid rgba(0, 0, 0, 0.1)":"none"},children:[(0,p.jsx)(i.ToggleControl,{checked:s,onChange:a,__nextHasNoMarginBottom:!0}),(0,p.jsxs)("div",{style:{flex:1},children:[(0,p.jsx)("span",{className:"duplicate-post-modal__section-label",children:(0,r.__)("Taxonomies","post-duplicator")}),s&&(0,p.jsxs)("span",{className:"duplicate-post-modal__section-count",children:[" ","(",u," ",(0,r.__)("taxonomies","post-duplicator"),","," ",g||m," ",(0,r.__)("terms","post-duplicator"),")"]})]})]}),o&&(0,p.jsx)("div",{className:"duplicate-post-modal__section-content",style:{padding:"16px"},children:(0,p.jsx)(i.__experimentalVStack,{spacing:"20px",children:t.map((t=>{const s=c[t.slug]||[],a=t.terms.map((t=>t.name)),o=t.terms.filter((t=>s.includes(t.id))).map((t=>t.name));return(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:500},children:t.label}),(0,p.jsx)(i.FormTokenField,{value:o,suggestions:a,onChange:s=>{const a=s.map((e=>{const s=t.terms.find((t=>t.name===e));return s?s.id:null})).filter((t=>null!==t));((t,s)=>{const a={...c,[t]:s};d(a),e&&e(a)})(t.slug,a)},__experimentalExpandOnFocus:!0,__experimentalShowHowTo:!1,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]},t.slug)}))})})]}):null},_=(0,p.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,p.jsx)(c.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})}),x=({customMeta:t,onChange:e,enabled:s,onToggle:a})=>{const[o,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)([]);(0,n.useEffect)((()=>{t&&t.length>0?d(t.map((t=>({key:t.key,value:t.value,type:t.type||"string",isSerialized:t.isSerialized||!1,originalValue:t.originalValue||t.value,isDeleted:!1})))):d([])}),[t]);const u=c.filter((t=>!t.isDeleted)).length,m=(t,s,a)=>{const o=[...c];if(o[t]={...o[t],[s]:a},"value"===s&&("array"===o[t].type||"object"===o[t].type))try{const e=JSON.parse(a);o[t].type=Array.isArray(e)?"array":"object"}catch(t){}if(d(o),e){const t=o.filter((t=>!t.isDeleted)).map((t=>({key:t.key,value:t.value,type:t.type,isSerialized:t.isSerialized})));e(t)}};return t&&0!==t.length?(0,p.jsxs)("div",{className:"duplicate-post-modal__custom-meta-section",style:{opacity:s?1:.5},children:[(0,p.jsxs)("div",{className:"duplicate-post-modal__section-header",onClick:t=>{t.target.closest(".components-toggle-control")||l(!o)},style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",cursor:"pointer",borderBottom:o?"1px solid rgba(0, 0, 0, 0.1)":"none"},children:[(0,p.jsx)(i.ToggleControl,{checked:s,onChange:a,__nextHasNoMarginBottom:!0}),(0,p.jsxs)("div",{style:{flex:1},children:[(0,p.jsx)("span",{className:"duplicate-post-modal__section-label",children:(0,r.__)("Custom Meta","post-duplicator")}),s&&(0,p.jsxs)("span",{className:"duplicate-post-modal__section-count",children:[" ","(",u," ",(0,r.__)("fields","post-duplicator"),")"]})]})]}),o&&(0,p.jsx)("div",{className:"duplicate-post-modal__section-content",style:{padding:"16px"},children:(0,p.jsxs)(i.__experimentalVStack,{spacing:"16px",children:[c.map(((t,s)=>!t.isDeleted&&(0,p.jsx)("div",{style:{padding:"12px",border:"1px solid rgba(0, 0, 0, 0.1)",borderRadius:"4px"},children:(0,p.jsxs)(i.__experimentalHStack,{spacing:"8px",alignment:"top",children:[(0,p.jsx)("div",{style:{flex:1},children:(0,p.jsx)(i.TextControl,{label:(0,r.__)("Key","post-duplicator"),value:t.key,onChange:t=>m(s,"key",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,p.jsx)("div",{style:{flex:2},children:"array"===t.type||"object"===t.type?(0,p.jsx)(i.TextareaControl,{label:(0,r.__)("Value (JSON)","post-duplicator"),value:t.value,onChange:t=>m(s,"value",t),onBlur:t=>((t,e)=>{const s=c[t];if("array"===s.type||"object"===s.type)try{JSON.parse(e)}catch(e){m(t,"value",s.value)}})(s,t.target.value),rows:6,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}):(0,p.jsx)(i.TextareaControl,{label:(0,r.__)("Value","post-duplicator"),value:t.value,onChange:t=>m(s,"value",t),rows:3,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,p.jsx)("div",{children:(0,p.jsx)(i.Button,{icon:_,variant:"tertiary",onClick:()=>(t=>{const s=[...c];if(s[t].isDeleted=!0,d(s),e){const t=s.filter((t=>!t.isDeleted)).map((t=>({key:t.key,value:t.value,type:t.type,isSerialized:t.isSerialized})));e(t)}})(s),label:(0,r.__)("Delete field","post-duplicator"),style:{marginTop:"32px"}})})]})},s))),(0,p.jsx)(i.Button,{variant:"secondary",onClick:()=>{const t=[...c,{key:"",value:"",type:"string",isSerialized:!1,originalValue:"",isDeleted:!1}];d(t)},style:{alignSelf:"flex-start"},children:(0,r.__)("Add Field","post-duplicator")})]})})]}):null},h=(0,p.jsx)(c.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,p.jsx)(c.Path,{d:"M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"})}),f=(0,p.jsx)(c.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,p.jsx)(c.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),y=({post:t,index:e,onUpdate:s,onDelete:a,onToggleExpand:o,isExpanded:l,showDelete:c=!0,postTypes:d,statusChoices:u,siteUrl:y,currentUser:v,defaultSettings:S})=>{const[j,w]=(0,n.useState)(t.settings||S),[b,P]=(0,n.useState)(!0),[C,D]=(0,n.useState)(!0),[N,k]=(0,n.useState)({}),[T,M]=(0,n.useState)([]),[I,E]=(0,n.useState)(t.originalPost?.featuredImage||null),[z,$]=(0,n.useState)(!1),V=void 0!==l?l:z;(0,n.useEffect)((()=>{if(t.originalPost?.taxonomies){const e={};t.originalPost.taxonomies.forEach((t=>{e[t.slug]=t.assignedTermIds||[]})),k(e)}else k({})}),[t.originalPost]),(0,n.useEffect)((()=>{t.originalPost?.customMeta?M(t.originalPost.customMeta.map((t=>({key:t.key,value:t.value,type:t.type||"string",isSerialized:t.isSerialized||!1})))):M([])}),[t.originalPost]),(0,n.useEffect)((()=>{t.originalPost?.featuredImage?E(t.originalPost.featuredImage):E(null)}),[t.originalPost]),(0,n.useEffect)((()=>{s&&s({...t,settings:j,taxonomyData:N,customMetaData:T,featuredImage:I,includeTaxonomies:b,includeCustomMeta:C})}),[j,N,T,I,b,C]);const B=()=>{o?o(t.id):$(!z)},U=(()=>{if(j?.fullTitle)return j.fullTitle;const e=j?.title||(0,r.__)("Copy","post-duplicator");return`${t.originalPost?.title||""} ${e}`})(),H=I?.thumbnail||I?.url||null;return(0,p.jsxs)("div",{className:"duplicate-post-modal__post-item "+(V?"duplicate-post-modal__post-item--expanded":"duplicate-post-modal__post-item--collapsed"),children:[(0,p.jsx)("div",{className:"duplicate-post-modal__post-item-header",onClick:t=>{t.target.closest(".duplicate-post-modal__post-item-actions")||B()},children:(0,p.jsxs)(i.__experimentalHStack,{spacing:"12px",alignment:"center",children:[H&&(0,p.jsx)("img",{src:H,alt:"",className:"duplicate-post-modal__post-item-thumbnail"}),(0,p.jsx)("h3",{className:"duplicate-post-modal__post-item-title",children:U}),(0,p.jsxs)("div",{className:"duplicate-post-modal__post-item-actions",onClick:t=>t.stopPropagation(),children:[(0,p.jsx)(i.Button,{icon:V?h:f,variant:"tertiary",onClick:t=>{t.stopPropagation(),B()},label:V?(0,r.__)("Collapse","post-duplicator"):(0,r.__)("Expand","post-duplicator")}),c&&(0,p.jsx)(i.Button,{icon:_,variant:"tertiary",onClick:e=>{e.stopPropagation(),a&&a(t.id)},label:(0,r.__)("Remove","post-duplicator")})]})]})}),V&&(0,p.jsx)("div",{className:"duplicate-post-modal__post-item-content",children:(0,p.jsxs)(i.__experimentalVStack,{spacing:"20px",children:[(0,p.jsx)(m,{settings:j,onSettingsChange:w,postTypes:d,statusChoices:u,originalPost:t.originalPost,featuredImage:I,onFeaturedImageChange:E}),t.originalPost?.taxonomies&&t.originalPost.taxonomies.length>0&&(0,p.jsx)(g,{taxonomies:t.originalPost.taxonomies,onChange:t=>{k(t)},enabled:b,onToggle:P}),t.originalPost?.customMeta&&t.originalPost.customMeta.length>0&&(0,p.jsx)(x,{customMeta:t.originalPost.customMeta,onChange:t=>{M(t)},enabled:C,onToggle:D})]})})]})},v=({posts:t,onPostsChange:e,postTypes:s,statusChoices:a,siteUrl:o,currentUser:l,defaultSettings:r,isMultipleClonesMode:c=!1})=>{const[d,u]=(0,n.useState)(new Set),m=s=>{const a=t.map((t=>t.id===s.id?s:t));e&&e(a)},g=s=>{if(c){const e=t.filter((t=>t.isDuplicate));if(e.length<=1&&e.some((t=>t.id===s)))return}const a=t.filter((t=>t.id!==s));e&&e(a);const o=new Set(d);o.delete(s),u(o)},_=t=>{const e=new Set(d);e.has(t)?e.delete(t):e.add(t),u(e)};if(!t||0===t.length)return null;const x=e=>!c||!!e.isDuplicate&&t.filter((t=>t.isDuplicate)).length>1;return(0,p.jsx)(i.__experimentalVStack,{spacing:"12px",className:"duplicate-post-modal__post-list",children:t.map(((t,e)=>(0,p.jsx)(y,{post:t,index:e,onUpdate:m,onDelete:g,onToggleExpand:_,isExpanded:d.has(t.id),showDelete:x(t),postTypes:s,statusChoices:a,siteUrl:o,currentUser:l,defaultSettings:r},t.id)))})},S=()=>{const t=[{id:"email-customizer",name:"Email Customizer",tagline:(0,r.__)("Transform standard Gravity Forms notifications into stunning, on-brand emails using the familiar WordPress editor to build your templates.","post-duplicator"),cta:(0,r.__)("Learn More →","post-duplicator"),image:"/wp-content/plugins/post-duplicator/assets/img/marketing/email-customizer-bordered.svg",url:"https://www.metaphorcreations.com/wordpress-plugins/email-customizer/?campaign=post-duplicator&ref=266"}],[e]=(0,n.useState)((()=>{const e=Math.floor(Math.random()*t.length);return t[e]}));return(0,p.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"duplicate-post-modal__marketing-banner",children:[(0,p.jsx)("div",{className:"duplicate-post-modal__marketing-banner-image",children:(0,p.jsx)("img",{src:e.image,alt:e.name})}),(0,p.jsxs)("div",{className:"duplicate-post-modal__marketing-banner-content",children:[(0,p.jsx)("div",{className:"duplicate-post-modal__marketing-banner-title",children:e.name}),(0,p.jsx)("div",{className:"duplicate-post-modal__marketing-banner-tagline",children:e.tagline})]}),(0,p.jsx)("div",{className:"duplicate-post-modal__marketing-banner-cta",children:e.cta})]})},j=({isOpen:t,onClose:e,onDuplicate:s,originalPost:a,postsToDuplicate:o,mode:l="single",defaultSettings:c,postTypes:u,statusChoices:_,siteUrl:h,currentUser:f,isLoadingPostData:y=!1})=>{const j=window.postDuplicatorVars?.postTypesPublicSupport||{},w="bulk"===l||o&&o.length>0,[b,P]=(0,n.useState)("multiple-clones"===l),[C,D]=(0,n.useState)(2),N=()=>o&&o.length>0?o:a?[{id:`post-${a.id}`,originalPost:a,settings:{...c},isDuplicate:!1}]:[],[k,T]=(0,n.useState)(N()),[M,I]=(0,n.useState)(c),[E,z]=(0,n.useState)(!1),[$,V]=(0,n.useState)(!0),[B,U]=(0,n.useState)(!0),[H,A]=(0,n.useState)({}),[F,O]=(0,n.useState)([]),[R,L]=(0,n.useState)(null),[W,Z]=(0,n.useState)("idle"),[G,J]=(0,n.useState)(null),[X,q]=(0,n.useState)(""),[K,Q]=(0,n.useState)([]),[Y,tt]=(0,n.useState)(0),et=(0,n.useRef)(!1);(0,n.useEffect)((()=>{if(t&&!et.current){I(c),V(!0),U(!0),Z("idle"),J(null),q(""),Q([]);const t=N();T(t),P("multiple-clones"===l),D(2)}!t&&et.current&&(tt((t=>t+1)),I(c),V(!0),U(!0),A({}),O([]),L(null),Q([])),et.current=t}),[t,c,l]),(0,n.useEffect)((()=>{if(t&&"idle"===W){const t=N();T(t)}}),[a,o,t,W]),k.filter((t=>t.isDuplicate)).length;const st=(0,n.useRef)(C),at=(0,n.useRef)(!1);if((0,n.useEffect)((()=>{st.current=C}),[C]),(0,n.useEffect)((()=>{if(b&&!w&&"idle"===W&&!at.current){const t=k.filter((t=>t.isDuplicate)).length;t<st.current&&t>=1&&(at.current=!0,D(t),setTimeout((()=>{at.current=!1}),0))}}),[k,b,w,W]),(0,n.useEffect)((()=>{if(!at.current)if(b&&!w&&"idle"===W){const t=k.find((t=>!t.isDuplicate));if(!t)return;const e=k.filter((t=>t.isDuplicate)),s=Math.max(1,C);if(e.length!==s){at.current=!0;const a=[];for(let o=0;o<s;o++){const s=e[o];s?a.push(s):a.push({id:`clone-${t.originalPost.id}-${o}`,originalPost:t.originalPost,settings:{...c},isDuplicate:!0})}T([t,...a]),st.current=s,setTimeout((()=>{at.current=!1}),0)}}else if(!b&&!w&&k.length>1&&"idle"===W){const t=k.find((t=>!t.isDuplicate))||k[0];t&&T([{...t,isDuplicate:!1}])}}),[b,w,C,W]),(0,n.useEffect)((()=>{if(!t||"idle"!==W||b||w)return;const e=k[0]?.originalPost||a;if(e){if(e?.taxonomies){const t={};e.taxonomies.forEach((e=>{t[e.slug]=e.assignedTermIds||[]})),A(t)}else A({});O(e?.customMeta?e.customMeta.map((t=>({key:t.key,value:t.value,type:t.type||"string",isSerialized:t.isSerialized||!1}))):[]),L(e?.featuredImage?e.featuredImage:null)}}),[t,a,W,b,w,k]),(0,n.useEffect)((()=>{const e=b||w?k[0]?.featuredImage||null:R;if(t){const t=setTimeout((()=>{const t=document.querySelector(".duplicate-post-modal.components-modal__frame"),s=t?.closest(".components-modal__screen-overlay");s&&s.classList.add("duplicate-post-modal-overlay"),e&&t&&t.style.setProperty("--featured-image-url",`url(${e.thumbnail||e.url})`)}),0);return()=>{clearTimeout(t);const e=document.querySelector(".duplicate-post-modal.components-modal__frame"),s=e?.closest(".components-modal__screen-overlay");s&&s.classList.remove("duplicate-post-modal-overlay")}}}),[R,k,b,w,t]),!t)return null;const ot=()=>{"duplicating"!==W&&("complete"===W&&(Z("idle"),J(null),q("")),e())},it=k[0]?.originalPost||a,lt=b||w?k[0]?.featuredImage||null:R,nt=o&&0!==o.length||!a||"idle"!==W?null:(0,p.jsx)(i.__experimentalHStack,{spacing:"4px",style:{flex:0},children:(0,p.jsx)(i.Button,{icon:d,size:"compact",variant:b?"primary":"secondary",onClick:()=>{const t=!b;P(t),t&&C<2&&D(2)},label:b?(0,r.__)("Multiple Clone","post-duplicator"):(0,r.__)("Single Clone","post-duplicator"),isPressed:b})});return(0,p.jsxs)(i.Modal,{title:(()=>{if(w)return(0,r.__)("Duplicate Posts","post-duplicator");if(b){const t=k[0]?.originalPost||a,e=t?.featuredImage?.thumbnail||t?.featuredImage?.url;return t?.title?e?(0,p.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,p.jsx)("img",{src:e,alt:"",style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px",flexShrink:0}}),(0,p.jsx)("span",{children:(0,r.__)(`Duplicate: ${t.title}`,"post-duplicator")})]}):(0,r.__)(`Duplicate: ${t.title}`,"post-duplicator"):(0,r.__)("Duplicate Post","post-duplicator")}const t=k[0]?.originalPost||a;return t?.title?M.fullTitle?M.fullTitle:`${t.title} ${M.title}`:""})(),onRequestClose:ot,headerActions:nt,className:"duplicate-post-modal "+(lt?"duplicate-post-modal--has-featured-image":""),size:"large",style:{borderRadius:0},children:[(0,p.jsx)("div",{className:"duplicate-post-modal__content",style:{paddingBottom:"idle"===W?"77px":"0"},children:y?(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",minHeight:"200px"},children:[(0,p.jsx)(i.Spinner,{}),(0,p.jsx)("p",{style:{marginTop:"16px",color:"#646970"},children:w||o&&o.length>0?(0,r.__)("Loading posts data...","post-duplicator"):(0,r.__)("Loading post data...","post-duplicator")})]}):"idle"===W?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(i.__experimentalVStack,{className:"duplicate-post-modal__settings",spacing:"20px",children:[b&&!w&&(!o||0===o.length)&&a&&(0,p.jsx)("div",{className:"duplicate-post-modal__clone-count",children:(0,p.jsx)(i.__experimentalNumberControl,{label:(0,r.__)("Number of Clones","post-duplicator"),value:C,onChange:t=>{const e=Math.max(1,Math.min(50,parseInt(t)||1));D(e)},min:1,max:50,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),!b&&!w&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(m,{settings:M,onSettingsChange:I,postTypes:u,statusChoices:_,originalPost:it,featuredImage:R,onFeaturedImageChange:L},`duplicate-settings-${it?.id||0}-${Y}`),it?.taxonomies&&it.taxonomies.length>0&&(0,p.jsx)(g,{taxonomies:it.taxonomies,onChange:t=>{A(t)},enabled:$,onToggle:V}),it?.customMeta&&it.customMeta.length>0&&(0,p.jsx)(x,{customMeta:it.customMeta,onChange:t=>{O(t)},enabled:B,onToggle:U})]}),(b||w)&&(0,p.jsx)(v,{posts:b&&!w?k.filter((t=>t.isDuplicate)):k,onPostsChange:t=>{if(b&&!w){if(t.filter((t=>t.isDuplicate)).length<1)return;const e=k.find((t=>!t.isDuplicate));T(e?[e,...t]:t)}else T(t)},postTypes:u,statusChoices:_,siteUrl:h,currentUser:f,defaultSettings:c,isMultipleClonesMode:b&&!w})]}),(0,p.jsx)(S,{})]}):(0,p.jsxs)("div",{className:"duplicate-post-modal__status",children:[!b&&!w&&(0,p.jsxs)("div",{className:"duplicate-post-modal__status-item",children:[R&&(0,p.jsx)("img",{src:R.thumbnail||R.url,alt:"",className:"duplicate-post-modal__status-thumbnail"}),(0,p.jsx)("h3",{className:"duplicate-post-modal__status-title",children:X}),(0,p.jsx)("div",{className:"duplicate-post-modal__status-actions",children:"duplicating"===W?(0,p.jsx)(i.Spinner,{}):(0,p.jsxs)(p.Fragment,{children:[(()=>{const t="same"===M.type?a?.type:M.type;return!1!==j[t]&&(0,p.jsx)(i.Button,{variant:"secondary",onClick:()=>window.open(`${h}/?p=${G}`,"_blank"),children:(0,r.__)("View Post","post-duplicator")})})(),(0,p.jsx)(i.Button,{variant:"primary",onClick:()=>window.open(`${h}/wp-admin/post.php?post=${G}&action=edit`,"_blank"),children:(0,r.__)("Edit Post","post-duplicator")})]})})]}),(b||w)&&(0,p.jsxs)(i.__experimentalVStack,{spacing:"12px",className:"duplicate-post-modal__success-list",children:["duplicating"===W&&(0,p.jsxs)("div",{style:{textAlign:"center",padding:"20px"},children:[(0,p.jsx)(i.Spinner,{}),(0,p.jsx)("p",{style:{marginTop:"12px"},children:(0,r.__)("Duplicating posts...","post-duplicator")})]}),K.map(((t,e)=>(0,p.jsx)("div",{className:"duplicate-post-modal__success-item "+(t.success?"":"duplicate-post-modal__success-item--error"),children:t.success?(0,p.jsxs)(p.Fragment,{children:[t.featuredImage&&(0,p.jsx)("img",{src:t.featuredImage.thumbnail||t.featuredImage.url,alt:"",className:"duplicate-post-modal__status-thumbnail"}),(0,p.jsx)("h3",{className:"duplicate-post-modal__status-title",children:t.title}),(0,p.jsxs)("div",{className:"duplicate-post-modal__status-actions",children:[(()=>{const e=t.postType||t.originalPost?.type;return!1!==j[e]&&(0,p.jsx)(i.Button,{variant:"secondary",onClick:()=>window.open(`${h}/?p=${t.postId}`,"_blank"),children:(0,r.__)("View Post","post-duplicator")})})(),(0,p.jsx)(i.Button,{variant:"primary",onClick:()=>window.open(`${h}/wp-admin/post.php?post=${t.postId}&action=edit`,"_blank"),children:(0,r.__)("Edit Post","post-duplicator")})]})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h3",{className:"duplicate-post-modal__status-title",children:t.title||t.originalPost?.title||(0,r.__)("Unknown Post","post-duplicator")}),(0,p.jsxs)("div",{className:"duplicate-post-modal__status-error",children:[(0,r.__)("Error:","post-duplicator")," ",t.error]})]})},e)))]})]})}),"idle"===W&&(0,p.jsxs)(i.__experimentalHStack,{alignment:"right",className:"duplicate-post-modal__footer",style:{position:"absolute",bottom:"0px",left:"0",padding:"20px",borderTop:"1px solid rgba(0, 0, 0, 0.1)",background:"#FFF"},children:[(0,p.jsx)(i.Button,{variant:"tertiary",onClick:ot,disabled:E||y,children:(0,r.__)("Cancel","post-duplicator")}),(0,p.jsx)(i.Button,{variant:"primary",onClick:async()=>{if(0===k.length)return;z(!0),Z("duplicating"),Q([]);const t=[];if(b||w){const e=b&&!w?k.filter((t=>t.isDuplicate)):k;for(let a=0;a<e.length;a++){const o=e[a],i=o.settings||c,l=o.taxonomyData||{},n=o.customMetaData||[],p=o.featuredImage||null,d=void 0===o.includeTaxonomies||o.includeTaxonomies,u=void 0===o.includeCustomMeta||o.includeCustomMeta,m=i.fullTitle||`${o.originalPost.title} ${i.title||(0,r.__)("Copy","post-duplicator")}`;try{const e={...i,includeTaxonomies:d,includeCustomMeta:u,...d?{taxonomyData:l}:{},customMetaData:n,featuredImageId:p?.id||null};await new Promise(((a,l)=>{s(o.originalPost.id,e,{onSuccess:e=>{const s="same"===i.type?o.originalPost.type:i.type;t.push({success:!0,postId:e.duplicate_id,title:m,originalPost:o.originalPost,featuredImage:p,postType:s}),Q([...t]),a(e)},onError:e=>{console.error(`Error duplicating post ${o.originalPost.id}:`,e),t.push({success:!1,error:e.message||e.data?.message||"Unknown error",title:m,originalPost:o.originalPost}),Q([...t]),a(null)}})}))}catch(e){t.push({success:!1,error:e.message||"Unknown error",title:m,originalPost:o.originalPost}),Q([...t])}}Z("complete"),z(!1)}else{const e=k[0],a=M.fullTitle||`${e.originalPost.title} ${M.title}`;q(a);try{const o={...M,includeTaxonomies:$,includeCustomMeta:B,...$?{taxonomyData:H}:{},customMetaData:F,featuredImageId:R?.id||null};await new Promise(((i,l)=>{s(e.originalPost.id,o,{onSuccess:s=>{const o="same"===M.type?e.originalPost.type:M.type;t.push({success:!0,postId:s.duplicate_id,title:a,originalPost:e.originalPost,featuredImage:R,postType:o}),Q(t),J(s.duplicate_id),Z("complete"),z(!1),i(s)},onError:s=>{console.error("Error duplicating:",s),t.push({success:!1,error:s.message||s.data?.message||"Unknown error",originalPost:e.originalPost}),Q(t),Z("complete"),z(!1),l(s)}})}))}catch(t){}}},disabled:E||y||0===k.length,isBusy:E,children:E?(0,r.__)("Duplicating...","post-duplicator"):(()=>{if(w||b){const t=b&&!w?C:k.length;return(0,r.__)(`Duplicate ${t} ${1===t?"Post":"Posts"}`,"post-duplicator")}const t=k[0]?.originalPost||a,e="same"===M.type?t?.type:M.type,s=u[e]||e;return(0,r.__)(`Duplicate ${s}`,"post-duplicator")})()})]})]})};(0,a.registerPlugin)("post-duplicator-button",{render:()=>{const[t,e]=(0,n.useState)(!1),[s,a]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)([]),[g,_]=(0,n.useState)([]),[x,h]=(0,n.useState)(null),[f,y]=(0,n.useState)(null),{postId:v,postType:S,postStatus:w,postTypeLabel:b,postTitle:P,postSlug:C,postDate:D,postAuthor:N,postParent:k,featuredMediaId:T}=(0,l.useSelect)((t=>{const e=t("core/editor"),s=e.getCurrentPost(),a=e.getCurrentPostType(),o=t("core").getPostType(a),i=e.getEditedPostAttribute("author"),l=t("core").getUser(i),n=l?l.name:"Unknown Author",r=e.getEditedPostAttribute("parent")||0,c=e.getEditedPostAttribute("featured_media");return{postId:s.id,postType:a,postStatus:e.getEditedPostAttribute("status"),postTypeLabel:o?o.labels.singular_name:"Post",postTitle:e.getEditedPostAttribute("title"),postSlug:e.getEditedPostAttribute("slug"),postDate:e.getEditedPostAttribute("date"),postAuthor:n,postParent:r,featuredMediaId:c}}),[]);if((0,n.useEffect)((()=>{if(c&&v){const t=async()=>{try{const t=await fetch(`${postDuplicatorVars.restUrl}post-data/${v}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(t.ok){const e=await t.json();m(e.taxonomies||[]),_(e.customMeta||[])}const e=await fetch(`${postDuplicatorVars.restUrl}post-full-data/${v}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(e.ok){const t=await e.json();h(t.featuredImage||null),y(t.parentPost||null)}else{if(k&&k>0)try{const t=await fetch(`${postDuplicatorVars.restUrl}post-full-data/${k}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(t.ok){const e=await t.json();y({id:e.id,title:e.title})}else y(null)}catch(t){console.error("Error fetching parent post:",t),y(null)}else y(null);h(null)}}catch(t){console.error("Error fetching post data:",t),h(null),y(null)}};t()}}),[c,v,k,S,T]),"publish"!==w||!v)return null;const M={id:v,title:P,type:S,status:w,slug:C,date:D,author:N,parent:k||0,parentPost:f||null,taxonomies:u,customMeta:g,featuredImage:x};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(o.PluginPostStatusInfo,{className:"m4c-duplicate-post-status-info",children:(0,p.jsxs)("div",{className:"m4c-duplicate-post-wrapper",style:{paddingTop:"16px"},children:[(0,p.jsx)(i.Button,{variant:"secondary",className:"m4c-duplicate-post-gutenberg",onClick:()=>d(!0),disabled:t,children:(0,r.__)(`Duplicate ${b}`,"post-duplicator")}),s&&(0,p.jsx)("div",{className:"m4c-duplicate-error",children:s})]})}),(0,p.jsx)(j,{isOpen:c,onClose:()=>d(!1),onDuplicate:async(t,s,o)=>{e(!0),a(null);const i=t||v;await(async(t,e,s={})=>{const{onSuccess:a,onError:o}=s;try{const s=await fetch(`${postDuplicatorVars.restUrl}duplicate-post`,{method:"POST",headers:{"X-WP-Nonce":postDuplicatorVars.nonce,"Content-Type":"application/json"},body:JSON.stringify({original_id:t,...e})});if(!s.ok){const t=await s.json(),e=new Error(t.message||"Failed to duplicate post");throw e.data=t,e}const o=await s.json();return o.duplicate_id&&a&&a(o),o}catch(t){throw console.error("Error duplicating post:",t),o&&o(t),t}})(i,s,{onSuccess:t=>{e(!1),o?.onSuccess&&o.onSuccess(t)},onError:t=>{a(t.message||t.data?.message||"Failed to duplicate post"),e(!1),o?.onError&&o.onError(t)}})},originalPost:M,defaultSettings:postDuplicatorVars.defaultSettings,postTypes:postDuplicatorVars.postTypes,statusChoices:postDuplicatorVars.statusChoices,siteUrl:postDuplicatorVars.siteUrl,currentUser:postDuplicatorVars.currentUser})]})}})})();