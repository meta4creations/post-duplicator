(()=>{"use strict";var e={715:e=>{e.exports=window.wp.blockEditor}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}const a=window.wp.element,o=window.wp.components,i=window.wp.i18n,n=window.wp.primitives,l=window.ReactJSXRuntime,r=(0,l.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,l.jsx)(n.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5 4.5h11a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V5a.5.5 0 0 1 .5-.5ZM3 5a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5Zm17 3v10.75c0 .69-.56 1.25-1.25 1.25H6v1.5h12.75a2.75 2.75 0 0 0 2.75-2.75V8H20Z"})}),c=(0,l.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)(n.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm.5 16c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5V7h15v12zM9 10H7v2h2v-2zm0 4H7v2h2v-2zm4-4h-2v2h2v-2zm4 0h-2v2h2v-2zm-4 4h-2v2h2v-2zm4 0h-2v2h2v-2z"})}),p=({settings:e,onSettingsChange:t,postTypes:n,statusChoices:r,originalPost:p,featuredImage:d,onFeaturedImageChange:u})=>{const[m,g]=(0,a.useState)((()=>{const t={...e};return"same"===e.type&&p?.type&&(t.type=p.type),"same"===e.status&&p?.status&&(t.status=p.status),t})()),[h,_]=(0,a.useState)(!1),[x,f]=(0,a.useState)(""),[y,v]=(0,a.useState)(""),[w,j]=(0,a.useState)(!1),S=window.postDuplicatorVars?.users||[],b=window.postDuplicatorVars?.currentUser,C=window.postDuplicatorVars?.postTypesAuthorSupport||{},D=window.postDuplicatorVars?.postTypesHierarchicalSupport||{},P=()=>"same"===m.type?p?.type:m.type,k=()=>{const e=P();return!0===D[e]},[N,M]=(0,a.useState)((()=>{const e=p?.type;return!1!==C[e]?b?.id?String(b.id):S.length>0?S[0].value:"":""})()),[T,E]=(0,a.useState)(""),[I,$]=(0,a.useState)([]),[z,V]=(0,a.useState)((new Date).toISOString()),[U,B]=(0,a.useState)(""),{MediaUpload:H,MediaUploadCheck:F}=(()=>{try{const e=s(715);if(e&&e.MediaUpload&&e.MediaUploadCheck&&"function"==typeof e.MediaUpload&&"function"==typeof e.MediaUploadCheck)return{MediaUpload:e.MediaUpload,MediaUploadCheck:e.MediaUploadCheck}}catch(e){}return{MediaUpload:null,MediaUploadCheck:null}})();let L=!0;try{if(void 0!==window.wp&&window.wp.data&&"function"==typeof window.wp.data.select){const e=window.wp.data.select("core/editor");L=!e||"function"!=typeof e.getCurrentPost}}catch(e){L=!0}const A=e=>e.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),O=e=>A(e),R=(e,s)=>{const a={...m,[e]:s};"timestamp"===e&&"custom"!==s&&(a.customDate=null),g(a),t(a)};(0,a.useEffect)((()=>{if(!w&&p?.title&&p?.slug){const s=e.fullTitle||`${p.title} ${e.title||""}`;f(s.trim());const a=e.fullSlug||`${p.slug}-${e.slug||"copy"}`;v(a);const o={...e,fullTitle:s.trim(),fullSlug:a};g(o),t(o);const i=p?.type;let n="";!1!==C[i]&&(n="current_user"===e.post_author?String(b?.id||""):String(p.authorId||b?.id||"")),M(n);const l=e.customDate||(new Date).toISOString();V(l),B(W(l));const r=p?.parent||0;E(r>0?String(r):""),R("selectedParentId",r>0?r:null),j(!0)}}),[p,w,e,b]),(0,a.useEffect)((()=>{(async()=>{if(!p?.type)return void $([]);const e="same"===m.type?p.type:m.type;try{const t=await fetch(`${window.postDuplicatorVars.restUrl}parent-posts?post_type=${e}&exclude_id=${p.id}`,{headers:{"X-WP-Nonce":window.postDuplicatorVars.nonce}});if(t.ok){const e=await t.json(),s=e=>{const t=e.level||0;return 0===t?e.title:`${"—".repeat(t)+" "}${e.title}`},a=[{label:(0,i.__)("— No Parent —","post-duplicator"),value:""},...e.map((e=>({label:s(e),value:String(e.id),level:e.level||0})))];$(a),p?.parentPost&&p.parent>0&&(e.some((e=>e.id===p.parent))||(a.splice(1,0,{label:p.parentPost.title,value:String(p.parent),level:0}),$(a)))}}catch(e){console.error("Error fetching parent posts:",e),$([{label:(0,i.__)("— No Parent —","post-duplicator"),value:""}])}})()}),[p?.type,m.type,p?.id,p?.parent,p?.parentPost]),(0,a.useEffect)((()=>{const t={...e};"same"===e.type&&p?.type&&(t.type=p.type),"same"===e.status&&p?.status&&(t.status=p.status),g(t)}),[e,p]),(0,a.useEffect)((()=>{if(!w)return;const e=P(),t=!1!==C[e];if(t||""===N){if(t&&""===N&&b?.id){const e=String(b.id);M(e),R("selectedAuthorId",parseInt(e))}}else M(""),R("selectedAuthorId",null)}),[m.type,w]),(0,a.useEffect)((()=>{w&&(k()||""===T||(E(""),R("selectedParentId",null)))}),[m.type,w]);const W=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),X=e=>{const s=e instanceof Date?e.toISOString():new Date(e).toISOString();V(s),B(W(s));const a={...m,timestamp:"custom",customDate:s};g(a),t(a)},Z=e=>Array.isArray(e)?e:Object.entries(e).map((([e,t])=>({value:e,label:t}))),G=()=>{if(void 0===window.wp||!window.wp.media)return console.error("WordPress media library is not available. Make sure wp_enqueue_media() is called."),void alert((0,i.__)("Media library is not available. Please refresh the page.","post-duplicator"));const e=window.wp.media({title:(0,i.__)("Select or Upload Featured Image","post-duplicator"),button:{text:(0,i.__)("Use this image","post-duplicator")},multiple:!1,library:{type:"image"}});e.on("select",(()=>{const t=e.state().get("selection").first().toJSON(),s={id:t.id,url:t.url,thumbnail:t.sizes?.thumbnail?.url||t.url,alt:t.alt||""};u&&u(s)})),e.open()},J=e=>{const t=d?.alt||"",s=d?.url?.split("/").pop()||"",a=`editor-post-featured-image-${d?.id||"new"}-describedby`,n=t||(0,i.__)("The current image has no alternative text.","post-duplicator")+(s?` ${(0,i.__)("The file name is:","post-duplicator")} ${s}`:"");return(0,l.jsxs)("div",{className:"editor-post-featured-image__container",children:[d&&(0,l.jsx)("div",{id:a,className:"hidden",children:n}),d?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Button,{type:"button",className:"components-button editor-post-featured-image__preview is-next-40px-default-size",onClick:e,"aria-label":(0,i.__)("Edit or replace the featured image","post-duplicator"),"aria-describedby":a,"aria-haspopup":"dialog",children:(0,l.jsx)("img",{className:"editor-post-featured-image__preview-image",src:d.url,alt:n})}),(0,l.jsxs)(o.__experimentalHStack,{className:"editor-post-featured-image__actions",children:[(0,l.jsx)(o.Button,{type:"button",className:"components-button editor-post-featured-image__action is-next-40px-default-size",onClick:e,"aria-haspopup":"dialog",children:(0,i.__)("Replace","post-duplicator")}),(0,l.jsx)(o.Button,{type:"button",className:"components-button editor-post-featured-image__action is-next-40px-default-size",onClick:()=>{u&&u(null)},children:(0,i.__)("Remove","post-duplicator")})]})]}):(0,l.jsx)(o.Button,{variant:"secondary",onClick:e,__next40pxDefaultSize:!0,children:(0,i.__)("Set featured image","post-duplicator")}),o.DropZone&&(0,l.jsx)(o.DropZone,{onFilesDrop:t=>{t.length>0&&e()},className:"components-drop-zone",children:(0,l.jsx)("div",{className:"components-drop-zone__content",children:(0,l.jsxs)("div",{className:"components-drop-zone__content-inner",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",className:"components-drop-zone__content-icon","aria-hidden":"true",focusable:"false",children:(0,l.jsx)("path",{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})}),(0,l.jsx)("span",{className:"components-drop-zone__content-text",children:(0,i.__)("Drop files to upload","post-duplicator")})]})})})]})};return(0,l.jsxs)(o.__experimentalVStack,{className:"duplicate-settings-fields",spacing:"20px",children:[(0,l.jsxs)(o.__experimentalHStack,{spacing:"16px",alignment:"stretch",className:"duplicate-settings-fields__top",children:[(0,l.jsxs)(o.__experimentalVStack,{className:"duplicate-settings-fields__title",children:[(0,l.jsx)(o.TextControl,{label:(0,i.__)("Title","post-duplicator"),value:x,onChange:e=>{if(f(e),!h&&p?.title){const s=O(e);v(s);const a={...m,fullTitle:e,fullSlug:s};g(a),t(a)}else R("fullTitle",e)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,style:{flex:1}}),(0,l.jsx)(o.TextControl,{label:(0,i.__)("Slug","post-duplicator"),value:y,onChange:e=>{v(e),_(!0),R("fullSlug",e)},onBlur:()=>{if(y&&""!==y.trim()){const e=A(y);v(e),R("fullSlug",e)}else{const e=O(x);v(e),R("fullSlug",e),_(!1)}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,l.jsx)("div",{className:"duplicate-settings-fields__featured-image",style:{minWidth:"200px",width:"35%",flex:"0 0 auto"},children:(()=>{if(!L&&H&&F)return(0,l.jsx)(F,{children:(0,l.jsx)(H,{onSelect:e=>{const t={id:e.id,url:e.url,thumbnail:e.sizes?.thumbnail?.url||e.url,alt:e.alt||""};u&&u(t)},allowedTypes:["image"],value:d?.id,render:({open:e})=>J(e)})});try{return J((()=>G()))}catch(e){return console.error("Error rendering featured image UI:",e),(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{children:["Error rendering featured image UI: ",e.message]}),(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>G(),__next40pxDefaultSize:!0,children:(0,i.__)("Set featured image","post-duplicator")})]})}})()})]}),(0,l.jsxs)(o.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,l.jsx)(o.SelectControl,{label:(0,i.__)("Post Type","post-duplicator"),value:m.type,options:Z(n),onChange:e=>R("type",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsx)(o.SelectControl,{label:(0,i.__)("Post Status","post-duplicator"),value:m.status,options:Z(r),onChange:e=>R("status",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsx)(o.SelectControl,{label:(0,i.__)("Post Parent","post-duplicator"),value:T||"",options:I,onChange:e=>{E(e),R("selectedParentId",e?parseInt(e):null)},disabled:!k(),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,l.jsxs)(o.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,l.jsx)(o.SelectControl,{label:(0,i.__)("Post Author","post-duplicator"),value:N||"",options:[{label:(0,i.__)("No Author","post-duplicator"),value:""},...S],onChange:e=>{M(e),R("selectedAuthorId",e?parseInt(e):null)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,l.jsx)(o.TextControl,{label:(0,i.__)("Post Date","post-duplicator"),value:U,onChange:e=>{B(e)},onBlur:()=>{try{const e=new Date(U);if(isNaN(e.getTime()))B(W(z));else{const s=e.toISOString();V(s),B(W(s));const a={...m,timestamp:"custom",customDate:s};g(a),t(a)}}catch(e){B(W(z))}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsx)(o.Dropdown,{popoverProps:{placement:"bottom-end",offset:8},renderToggle:({isOpen:e,onToggle:t})=>(0,l.jsx)(o.Button,{onClick:t,"aria-expanded":e,icon:c,style:{position:"absolute",right:"2px",top:"26px",minWidth:"36px",height:"36px",padding:"0"},variant:"tertiary"}),renderContent:({onClose:e})=>(0,l.jsx)("div",{style:{padding:"16px"},children:(0,l.jsx)(o.DateTimePicker,{currentDate:z,onChange:X,is12Hour:!1})})})]})]})]})},d=({taxonomies:e,onChange:t,enabled:s,onToggle:n})=>{const[r,c]=(0,a.useState)(!1),[p,d]=(0,a.useState)({});(0,a.useEffect)((()=>{if(e&&e.length>0){const t={};e.forEach((e=>{t[e.slug]=e.assignedTermIds||[]})),d(t)}}),[e]);const u=e?e.length:0,m=e?e.reduce(((e,t)=>e+t.terms.length),0):0,g=Object.values(p).reduce(((e,t)=>e+t.length),0);return e&&0!==e.length?(0,l.jsxs)("div",{className:"duplicate-post-modal__taxonomy-section",style:{opacity:s?1:.5},children:[(0,l.jsxs)("div",{className:"duplicate-post-modal__section-header",onClick:e=>{e.target.closest(".components-toggle-control")||c(!r)},style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",cursor:"pointer",borderBottom:r?"1px solid rgba(0, 0, 0, 0.1)":"none"},children:[(0,l.jsx)(o.ToggleControl,{checked:s,onChange:n,__nextHasNoMarginBottom:!0}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("span",{className:"duplicate-post-modal__section-label",children:(0,i.__)("Taxonomies","post-duplicator")}),s&&(0,l.jsxs)("span",{className:"duplicate-post-modal__section-count",children:[" ","(",u," ",(0,i.__)("taxonomies","post-duplicator"),","," ",g||m," ",(0,i.__)("terms","post-duplicator"),")"]})]})]}),r&&(0,l.jsx)("div",{className:"duplicate-post-modal__section-content",style:{padding:"16px"},children:(0,l.jsx)(o.__experimentalVStack,{spacing:"20px",children:e.map((e=>{const s=p[e.slug]||[],a=e.terms.map((e=>e.name)),i=e.terms.filter((e=>s.includes(e.id))).map((e=>e.name));return(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:500},children:e.label}),(0,l.jsx)(o.FormTokenField,{value:i,suggestions:a,onChange:s=>{const a=s.map((t=>{const s=e.terms.find((e=>e.name===t));return s?s.id:null})).filter((e=>null!==e));((e,s)=>{const a={...p,[e]:s};d(a),t&&t(a)})(e.slug,a)},__experimentalExpandOnFocus:!0,__experimentalShowHowTo:!1,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]},e.slug)}))})})]}):null},u=(0,l.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,l.jsx)(n.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})}),m=({customMeta:e,onChange:t,enabled:s,onToggle:n})=>{const[r,c]=(0,a.useState)(!1),[p,d]=(0,a.useState)([]);(0,a.useEffect)((()=>{e&&e.length>0?d(e.map((e=>({key:e.key,value:e.value,type:e.type||"string",isSerialized:e.isSerialized||!1,originalValue:e.originalValue||e.value,isDeleted:!1})))):d([])}),[e]);const m=p.filter((e=>!e.isDeleted)).length,g=(e,s,a)=>{const o=[...p];if(o[e]={...o[e],[s]:a},"value"===s&&("array"===o[e].type||"object"===o[e].type))try{const t=JSON.parse(a);o[e].type=Array.isArray(t)?"array":"object"}catch(e){}if(d(o),t){const e=o.filter((e=>!e.isDeleted)).map((e=>({key:e.key,value:e.value,type:e.type,isSerialized:e.isSerialized})));t(e)}};return e&&0!==e.length?(0,l.jsxs)("div",{className:"duplicate-post-modal__custom-meta-section",style:{opacity:s?1:.5},children:[(0,l.jsxs)("div",{className:"duplicate-post-modal__section-header",onClick:e=>{e.target.closest(".components-toggle-control")||c(!r)},style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",cursor:"pointer",borderBottom:r?"1px solid rgba(0, 0, 0, 0.1)":"none"},children:[(0,l.jsx)(o.ToggleControl,{checked:s,onChange:n,__nextHasNoMarginBottom:!0}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("span",{className:"duplicate-post-modal__section-label",children:(0,i.__)("Custom Meta","post-duplicator")}),s&&(0,l.jsxs)("span",{className:"duplicate-post-modal__section-count",children:[" ","(",m," ",(0,i.__)("fields","post-duplicator"),")"]})]})]}),r&&(0,l.jsx)("div",{className:"duplicate-post-modal__section-content",style:{padding:"16px"},children:(0,l.jsxs)(o.__experimentalVStack,{spacing:"16px",children:[p.map(((e,s)=>!e.isDeleted&&(0,l.jsx)("div",{style:{padding:"12px",border:"1px solid rgba(0, 0, 0, 0.1)",borderRadius:"4px"},children:(0,l.jsxs)(o.__experimentalHStack,{spacing:"8px",alignment:"top",children:[(0,l.jsx)("div",{style:{flex:1},children:(0,l.jsx)(o.TextControl,{label:(0,i.__)("Key","post-duplicator"),value:e.key,onChange:e=>g(s,"key",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,l.jsx)("div",{style:{flex:2},children:"array"===e.type||"object"===e.type?(0,l.jsx)(o.TextareaControl,{label:(0,i.__)("Value (JSON)","post-duplicator"),value:e.value,onChange:e=>g(s,"value",e),onBlur:e=>((e,t)=>{const s=p[e];if("array"===s.type||"object"===s.type)try{JSON.parse(t)}catch(t){g(e,"value",s.value)}})(s,e.target.value),rows:6,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}):(0,l.jsx)(o.TextareaControl,{label:(0,i.__)("Value","post-duplicator"),value:e.value,onChange:e=>g(s,"value",e),rows:3,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,l.jsx)("div",{children:(0,l.jsx)(o.Button,{icon:u,variant:"tertiary",onClick:()=>(e=>{const s=[...p];if(s[e].isDeleted=!0,d(s),t){const e=s.filter((e=>!e.isDeleted)).map((e=>({key:e.key,value:e.value,type:e.type,isSerialized:e.isSerialized})));t(e)}})(s),label:(0,i.__)("Delete field","post-duplicator"),style:{marginTop:"32px"}})})]})},s))),(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>{const e=[...p,{key:"",value:"",type:"string",isSerialized:!1,originalValue:"",isDeleted:!1}];d(e)},style:{alignSelf:"flex-start"},children:(0,i.__)("Add Field","post-duplicator")})]})})]}):null},g=(0,l.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)(n.Path,{d:"M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"})}),h=(0,l.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)(n.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),_=({post:e,index:t,onUpdate:s,onDelete:n,onToggleExpand:r,isExpanded:c,showDelete:_=!0,postTypes:x,statusChoices:f,siteUrl:y,currentUser:v,defaultSettings:w})=>{const[j,S]=(0,a.useState)(e.settings||w),[b,C]=(0,a.useState)(!0),[D,P]=(0,a.useState)(!0),[k,N]=(0,a.useState)({}),[M,T]=(0,a.useState)([]),[E,I]=(0,a.useState)(e.originalPost?.featuredImage||null),[$,z]=(0,a.useState)(!1),V=void 0!==c?c:$;(0,a.useEffect)((()=>{if(e.originalPost?.taxonomies){const t={};e.originalPost.taxonomies.forEach((e=>{t[e.slug]=e.assignedTermIds||[]})),N(t)}else N({})}),[e.originalPost]),(0,a.useEffect)((()=>{e.originalPost?.customMeta?T(e.originalPost.customMeta.map((e=>({key:e.key,value:e.value,type:e.type||"string",isSerialized:e.isSerialized||!1})))):T([])}),[e.originalPost]),(0,a.useEffect)((()=>{e.originalPost?.featuredImage?I(e.originalPost.featuredImage):I(null)}),[e.originalPost]),(0,a.useEffect)((()=>{s&&s({...e,settings:j,taxonomyData:k,customMetaData:M,featuredImage:E,includeTaxonomies:b,includeCustomMeta:D})}),[j,k,M,E,b,D]);const U=()=>{r?r(e.id):z(!$)},B=(()=>{if(j?.fullTitle)return j.fullTitle;const t=j?.title||(0,i.__)("Copy","post-duplicator");return`${e.originalPost?.title||""} ${t}`})(),H=E?.thumbnail||E?.url||null;return(0,l.jsxs)("div",{className:"duplicate-post-modal__post-item "+(V?"duplicate-post-modal__post-item--expanded":"duplicate-post-modal__post-item--collapsed"),children:[(0,l.jsx)("div",{className:"duplicate-post-modal__post-item-header",onClick:e=>{e.target.closest(".duplicate-post-modal__post-item-actions")||U()},children:(0,l.jsxs)(o.__experimentalHStack,{spacing:"12px",alignment:"center",children:[H&&(0,l.jsx)("img",{src:H,alt:"",className:"duplicate-post-modal__post-item-thumbnail"}),(0,l.jsx)("h3",{className:"duplicate-post-modal__post-item-title",children:B}),(0,l.jsxs)("div",{className:"duplicate-post-modal__post-item-actions",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)(o.Button,{icon:V?g:h,variant:"tertiary",onClick:e=>{e.stopPropagation(),U()},label:V?(0,i.__)("Collapse","post-duplicator"):(0,i.__)("Expand","post-duplicator")}),_&&(0,l.jsx)(o.Button,{icon:u,variant:"tertiary",onClick:t=>{t.stopPropagation(),n&&n(e.id)},label:(0,i.__)("Remove","post-duplicator")})]})]})}),V&&(0,l.jsx)("div",{className:"duplicate-post-modal__post-item-content",children:(0,l.jsxs)(o.__experimentalVStack,{spacing:"20px",children:[(0,l.jsx)(p,{settings:j,onSettingsChange:S,postTypes:x,statusChoices:f,originalPost:e.originalPost,featuredImage:E,onFeaturedImageChange:I}),e.originalPost?.taxonomies&&e.originalPost.taxonomies.length>0&&(0,l.jsx)(d,{taxonomies:e.originalPost.taxonomies,onChange:e=>{N(e)},enabled:b,onToggle:C}),e.originalPost?.customMeta&&e.originalPost.customMeta.length>0&&(0,l.jsx)(m,{customMeta:e.originalPost.customMeta,onChange:e=>{T(e)},enabled:D,onToggle:P})]})})]})},x=({posts:e,onPostsChange:t,postTypes:s,statusChoices:i,siteUrl:n,currentUser:r,defaultSettings:c,isMultipleClonesMode:p=!1})=>{const[d,u]=(0,a.useState)(new Set),m=s=>{const a=e.map((e=>e.id===s.id?s:e));t&&t(a)},g=s=>{if(p){const t=e.filter((e=>e.isDuplicate));if(t.length<=1&&t.some((e=>e.id===s)))return}const a=e.filter((e=>e.id!==s));t&&t(a);const o=new Set(d);o.delete(s),u(o)},h=e=>{const t=new Set(d);t.has(e)?t.delete(e):t.add(e),u(t)};if(!e||0===e.length)return null;const x=t=>!p||!!t.isDuplicate&&e.filter((e=>e.isDuplicate)).length>1;return(0,l.jsx)(o.__experimentalVStack,{spacing:"12px",className:"duplicate-post-modal__post-list",children:e.map(((e,t)=>(0,l.jsx)(_,{post:e,index:t,onUpdate:m,onDelete:g,onToggleExpand:h,isExpanded:d.has(e.id),showDelete:x(e),postTypes:s,statusChoices:i,siteUrl:n,currentUser:r,defaultSettings:c},e.id)))})},f=()=>{const e=[{id:"email-customizer",name:"Email Customizer",tagline:(0,i.__)("Transform standard Gravity Forms notifications into stunning, on-brand emails using the familiar WordPress editor to build your templates.","post-duplicator"),cta:(0,i.__)("Learn More →","post-duplicator"),image:"/wp-content/plugins/post-duplicator/assets/img/marketing/email-customizer-bordered.svg",url:"https://www.metaphorcreations.com/wordpress-plugins/email-customizer/?campaign=post-duplicator&ref=266"}],[t]=(0,a.useState)((()=>{const t=Math.floor(Math.random()*e.length);return e[t]}));return(0,l.jsxs)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"duplicate-post-modal__marketing-banner",children:[(0,l.jsx)("div",{className:"duplicate-post-modal__marketing-banner-image",children:(0,l.jsx)("img",{src:t.image,alt:t.name})}),(0,l.jsxs)("div",{className:"duplicate-post-modal__marketing-banner-content",children:[(0,l.jsx)("div",{className:"duplicate-post-modal__marketing-banner-title",children:t.name}),(0,l.jsx)("div",{className:"duplicate-post-modal__marketing-banner-tagline",children:t.tagline})]}),(0,l.jsx)("div",{className:"duplicate-post-modal__marketing-banner-cta",children:t.cta})]})},y=({isOpen:e,onClose:t,onDuplicate:s,originalPost:n,postsToDuplicate:c,mode:u="single",defaultSettings:g,postTypes:h,statusChoices:_,siteUrl:y,currentUser:v,isLoadingPostData:w=!1})=>{const j="bulk"===u||c&&c.length>0,[S,b]=(0,a.useState)("multiple-clones"===u),[C,D]=(0,a.useState)(2),P=()=>c&&c.length>0?c:n?[{id:`post-${n.id}`,originalPost:n,settings:{...g},isDuplicate:!1}]:[],[k,N]=(0,a.useState)(P()),[M,T]=(0,a.useState)(g),[E,I]=(0,a.useState)(!1),[$,z]=(0,a.useState)(!0),[V,U]=(0,a.useState)(!0),[B,H]=(0,a.useState)({}),[F,L]=(0,a.useState)([]),[A,O]=(0,a.useState)(null),[R,W]=(0,a.useState)("idle"),[X,Z]=(0,a.useState)(null),[G,J]=(0,a.useState)(""),[q,K]=(0,a.useState)([]),[Q,Y]=(0,a.useState)(0),ee=(0,a.useRef)(!1);(0,a.useEffect)((()=>{if(e&&!ee.current){T(g),z(!0),U(!0),W("idle"),Z(null),J(""),K([]);const e=P();N(e),b("multiple-clones"===u),D(2)}!e&&ee.current&&(Y((e=>e+1)),T(g),z(!0),U(!0),H({}),L([]),O(null),K([])),ee.current=e}),[e,g,u]),(0,a.useEffect)((()=>{if(e&&"idle"===R){const e=P();N(e)}}),[n,c,e,R]),k.filter((e=>e.isDuplicate)).length;const te=(0,a.useRef)(C),se=(0,a.useRef)(!1);if((0,a.useEffect)((()=>{te.current=C}),[C]),(0,a.useEffect)((()=>{if(S&&!j&&"idle"===R&&!se.current){const e=k.filter((e=>e.isDuplicate)).length;e<te.current&&e>=1&&(se.current=!0,D(e),setTimeout((()=>{se.current=!1}),0))}}),[k,S,j,R]),(0,a.useEffect)((()=>{if(!se.current)if(S&&!j&&"idle"===R){const e=k.find((e=>!e.isDuplicate));if(!e)return;const t=k.filter((e=>e.isDuplicate)),s=Math.max(1,C);if(t.length!==s){se.current=!0;const a=[];for(let o=0;o<s;o++){const s=t[o];s?a.push(s):a.push({id:`clone-${e.originalPost.id}-${o}`,originalPost:e.originalPost,settings:{...g},isDuplicate:!0})}N([e,...a]),te.current=s,setTimeout((()=>{se.current=!1}),0)}}else if(!S&&!j&&k.length>1&&"idle"===R){const e=k.find((e=>!e.isDuplicate))||k[0];e&&N([{...e,isDuplicate:!1}])}}),[S,j,C,R]),(0,a.useEffect)((()=>{if(!e||"idle"!==R||S||j)return;const t=k[0]?.originalPost||n;if(t){if(t?.taxonomies){const e={};t.taxonomies.forEach((t=>{e[t.slug]=t.assignedTermIds||[]})),H(e)}else H({});L(t?.customMeta?t.customMeta.map((e=>({key:e.key,value:e.value,type:e.type||"string",isSerialized:e.isSerialized||!1}))):[]),O(t?.featuredImage?t.featuredImage:null)}}),[e,n,R,S,j,k]),(0,a.useEffect)((()=>{const t=S||j?k[0]?.featuredImage||null:A;if(t&&e){const e=setTimeout((()=>{const e=document.querySelector(".duplicate-post-modal--has-featured-image.components-modal__frame");e&&e.style.setProperty("--featured-image-url",`url(${t.thumbnail||t.url})`)}),0);return()=>clearTimeout(e)}}),[A,k,S,j,e]),!e)return null;const ae=()=>{"duplicating"!==R&&("complete"===R&&(W("idle"),Z(null),J("")),t())},oe=k[0]?.originalPost||n,ie=S||j?k[0]?.featuredImage||null:A,ne=c&&0!==c.length||!n?null:(0,l.jsx)(o.__experimentalHStack,{spacing:"4px",style:{flex:0},children:(0,l.jsx)(o.Button,{icon:r,size:"compact",variant:S?"primary":"secondary",onClick:()=>{const e=!S;b(e),e&&C<2&&D(2)},label:S?(0,i.__)("Multiple Clone","post-duplicator"):(0,i.__)("Single Clone","post-duplicator"),isPressed:S})});return(0,l.jsxs)(o.Modal,{title:(()=>{if(j)return(0,i.__)("Duplicate Posts","post-duplicator");if(S){const e=k[0]?.originalPost||n,t=e?.featuredImage?.thumbnail||e?.featuredImage?.url;return e?.title?t?(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,l.jsx)("img",{src:t,alt:"",style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px",flexShrink:0}}),(0,l.jsx)("span",{children:(0,i.__)(`Duplicate: ${e.title}`,"post-duplicator")})]}):(0,i.__)(`Duplicate: ${e.title}`,"post-duplicator"):(0,i.__)("Duplicate Post","post-duplicator")}const e=k[0]?.originalPost||n;return e?.title?M.fullTitle?M.fullTitle:`${e.title} ${M.title}`:""})(),onRequestClose:ae,headerActions:ne,className:"duplicate-post-modal "+(ie?"duplicate-post-modal--has-featured-image":""),size:"large",style:{borderRadius:0},children:[(0,l.jsx)("div",{className:"duplicate-post-modal__content",style:{paddingBottom:"idle"===R?"77px":"0"},children:w?(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",minHeight:"200px"},children:[(0,l.jsx)(o.Spinner,{}),(0,l.jsx)("p",{style:{marginTop:"16px",color:"#646970"},children:(0,i.__)("Loading post data...","post-duplicator")})]}):"idle"===R?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(o.__experimentalVStack,{className:"duplicate-post-modal__settings",spacing:"20px",children:[S&&!j&&(!c||0===c.length)&&n&&(0,l.jsx)("div",{className:"duplicate-post-modal__clone-count",children:(0,l.jsx)(o.__experimentalNumberControl,{label:(0,i.__)("Number of Clones","post-duplicator"),value:C,onChange:e=>{const t=Math.max(1,Math.min(50,parseInt(e)||1));D(t)},min:1,max:50,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),!S&&!j&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p,{settings:M,onSettingsChange:T,postTypes:h,statusChoices:_,originalPost:oe,featuredImage:A,onFeaturedImageChange:O},`duplicate-settings-${oe?.id||0}-${Q}`),oe?.taxonomies&&oe.taxonomies.length>0&&(0,l.jsx)(d,{taxonomies:oe.taxonomies,onChange:e=>{H(e)},enabled:$,onToggle:z}),oe?.customMeta&&oe.customMeta.length>0&&(0,l.jsx)(m,{customMeta:oe.customMeta,onChange:e=>{L(e)},enabled:V,onToggle:U})]}),(S||j)&&(0,l.jsx)(x,{posts:S&&!j?k.filter((e=>e.isDuplicate)):k,onPostsChange:e=>{if(S&&!j){if(e.filter((e=>e.isDuplicate)).length<1)return;const t=k.find((e=>!e.isDuplicate));N(t?[t,...e]:e)}else N(e)},postTypes:h,statusChoices:_,siteUrl:y,currentUser:v,defaultSettings:g,isMultipleClonesMode:S&&!j})]}),(0,l.jsx)(f,{})]}):(0,l.jsxs)("div",{className:"duplicate-post-modal__status",children:[!S&&!j&&(0,l.jsxs)("div",{className:"duplicate-post-modal__status-item",children:[A&&(0,l.jsx)("img",{src:A.thumbnail||A.url,alt:"",className:"duplicate-post-modal__status-thumbnail"}),(0,l.jsx)("h3",{className:"duplicate-post-modal__status-title",children:G}),(0,l.jsx)("div",{className:"duplicate-post-modal__status-actions",children:"duplicating"===R?(0,l.jsx)(o.Spinner,{}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>window.open(`${y}/?p=${X}`,"_blank"),children:(0,i.__)("View Post","post-duplicator")}),(0,l.jsx)(o.Button,{variant:"primary",onClick:()=>window.open(`${y}/wp-admin/post.php?post=${X}&action=edit`,"_blank"),children:(0,i.__)("Edit Post","post-duplicator")})]})})]}),(S||j)&&(0,l.jsxs)(o.__experimentalVStack,{spacing:"12px",className:"duplicate-post-modal__success-list",children:["duplicating"===R&&(0,l.jsxs)("div",{style:{textAlign:"center",padding:"20px"},children:[(0,l.jsx)(o.Spinner,{}),(0,l.jsx)("p",{style:{marginTop:"12px"},children:(0,i.__)("Duplicating posts...","post-duplicator")})]}),q.map(((e,t)=>(0,l.jsx)("div",{className:"duplicate-post-modal__success-item "+(e.success?"":"duplicate-post-modal__success-item--error"),children:e.success?(0,l.jsxs)(l.Fragment,{children:[e.featuredImage&&(0,l.jsx)("img",{src:e.featuredImage.thumbnail||e.featuredImage.url,alt:"",className:"duplicate-post-modal__status-thumbnail"}),(0,l.jsx)("h3",{className:"duplicate-post-modal__status-title",children:e.title}),(0,l.jsxs)("div",{className:"duplicate-post-modal__status-actions",children:[(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>window.open(`${y}/?p=${e.postId}`,"_blank"),children:(0,i.__)("View Post","post-duplicator")}),(0,l.jsx)(o.Button,{variant:"primary",onClick:()=>window.open(`${y}/wp-admin/post.php?post=${e.postId}&action=edit`,"_blank"),children:(0,i.__)("Edit Post","post-duplicator")})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("h3",{className:"duplicate-post-modal__status-title",children:e.title||e.originalPost?.title||(0,i.__)("Unknown Post","post-duplicator")}),(0,l.jsxs)("div",{className:"duplicate-post-modal__status-error",children:[(0,i.__)("Error:","post-duplicator")," ",e.error]})]})},t)))]})]})}),"idle"===R&&(0,l.jsxs)(o.__experimentalHStack,{alignment:"right",className:"duplicate-post-modal__footer",style:{position:"absolute",bottom:"0px",left:"0",padding:"20px",borderTop:"1px solid rgba(0, 0, 0, 0.1)",background:"#FFF"},children:[(0,l.jsx)(o.Button,{variant:"tertiary",onClick:ae,disabled:E||w,children:(0,i.__)("Cancel","post-duplicator")}),(0,l.jsx)(o.Button,{variant:"primary",onClick:async()=>{if(0===k.length)return;I(!0),W("duplicating"),K([]);const e=[];if(S||j){const t=S&&!j?k.filter((e=>e.isDuplicate)):k;for(let a=0;a<t.length;a++){const o=t[a],n=o.settings||g,l=o.taxonomyData||{},r=o.customMetaData||[],c=o.featuredImage||null,p=void 0===o.includeTaxonomies||o.includeTaxonomies,d=void 0===o.includeCustomMeta||o.includeCustomMeta,u=n.fullTitle||`${o.originalPost.title} ${n.title||(0,i.__)("Copy","post-duplicator")}`;try{const t={...n,includeTaxonomies:p,includeCustomMeta:d,...p?{taxonomyData:l}:{},customMetaData:r,featuredImageId:c?.id||null};await new Promise(((a,i)=>{s(o.originalPost.id,t,{onSuccess:t=>{e.push({success:!0,postId:t.duplicate_id,title:u,originalPost:o.originalPost,featuredImage:c}),K([...e]),a(t)},onError:t=>{console.error(`Error duplicating post ${o.originalPost.id}:`,t),e.push({success:!1,error:t.message||t.data?.message||"Unknown error",title:u,originalPost:o.originalPost}),K([...e]),a(null)}})}))}catch(t){e.push({success:!1,error:t.message||"Unknown error",title:u,originalPost:o.originalPost}),K([...e])}}W("complete"),I(!1)}else{const t=k[0],a=M.fullTitle||`${t.originalPost.title} ${M.title}`;J(a);try{const o={...M,includeTaxonomies:$,includeCustomMeta:V,...$?{taxonomyData:B}:{},customMetaData:F,featuredImageId:A?.id||null};await new Promise(((i,n)=>{s(t.originalPost.id,o,{onSuccess:s=>{e.push({success:!0,postId:s.duplicate_id,title:a,originalPost:t.originalPost,featuredImage:A}),K(e),Z(s.duplicate_id),W("complete"),I(!1),i(s)},onError:s=>{console.error("Error duplicating:",s),e.push({success:!1,error:s.message||s.data?.message||"Unknown error",originalPost:t.originalPost}),K(e),W("complete"),I(!1),n(s)}})}))}catch(e){}}},disabled:E||w||0===k.length,isBusy:E,children:E?(0,i.__)("Duplicating...","post-duplicator"):(()=>{if(j||S){const e=S&&!j?C:k.length;return(0,i.__)(`Duplicate ${e} ${1===e?"Post":"Posts"}`,"post-duplicator")}const e=k[0]?.originalPost||n,t="same"===M.type?e?.type:M.type,s=h[t]||t;return(0,i.__)(`Duplicate ${s}`,"post-duplicator")})()})]})]})};function v(e,t="error"){const s=document.createElement("div");s.classList.add("my-snackbar",`my-snackbar--${t}`),s.textContent=e,document.body.appendChild(s),setTimeout((()=>{s.classList.add("my-snackbar--hide"),s.addEventListener("transitionend",(()=>s.remove()))}),3e3)}const w=async(e,t="post")=>{const s=postDuplicatorVars.restUrl.replace("post-duplicator/v1/","wp/v2/"),a=`${s}${"page"===t?"pages":"post"===t?"posts":t}/${e}`,o=await fetch(a,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(!o.ok)throw new Error("Failed to fetch post data");const i=await o.json();let n="Unknown Author";if(i.author&&i.author>0)try{const e=await fetch(`${postDuplicatorVars.restUrl.replace("post-duplicator/v1/","wp/v2/")}users/${i.author}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});e.ok&&(n=(await e.json()).name)}catch(e){console.error("Error fetching author:",e)}let l=null;if(i.featured_media&&i.featured_media>0)try{const e=await fetch(`${postDuplicatorVars.restUrl.replace("post-duplicator/v1/","wp/v2/")}media/${i.featured_media}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(e.ok){const t=await e.json();l={id:t.id,url:t.source_url,thumbnail:t.media_details?.sizes?.thumbnail?.source_url||t.source_url,alt:t.alt_text||""}}}catch(e){console.error("Error fetching featured image:",e)}let r=null;if(i.parent&&i.parent>0)try{const e="page"===t?"pages":"post"===t?"posts":t,a=await fetch(`${s}${e}/${i.parent}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(a.ok){const e=await a.json();r={id:e.id,title:e.title.rendered}}}catch(e){console.error("Error fetching parent post:",e)}let c=[],p=[];try{const t=await fetch(`${postDuplicatorVars.restUrl}post-data/${e}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(t.ok){const e=await t.json();c=e.taxonomies||[],p=e.customMeta||[]}}catch(e){console.error("Error fetching post data:",e)}return{id:i.id,title:i.title.rendered,type:i.type,status:i.status,slug:i.slug,date:i.date,author:n,authorId:i.author,parent:i.parent||0,parentPost:r,taxonomies:c,customMeta:p,featuredImage:l}},j=()=>{const[e,t]=(0,a.useState)(!1),[s,o]=(0,a.useState)(null),[i,n]=(0,a.useState)(null),[r,c]=(0,a.useState)("single"),[p,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{const e=async e=>{if(e.target.classList.contains("m4c-duplicate-post")){e.preventDefault();const s=e.target.getAttribute("data-postid"),a=e.target.getAttribute("data-posttype")||"post";o(null),n(null),c("single"),m(!0),t(!0);try{const e=await w(s,a);o(e),m(!1)}catch(e){console.error("Error fetching post:",e),m(!1),t(!1),v("Error loading post data. Please try again.","error")}}};return document.body.addEventListener("click",e),()=>{document.body.removeEventListener("click",e)}}),[]),(0,a.useEffect)((()=>{const e=async e=>{const{postIds:s,postType:a}=e.detail;if(s&&0!==s.length)try{const e=s.map((e=>w(e,a).catch((t=>(console.error(`Error fetching post ${e}:`,t),null))))),i=(await Promise.all(e)).filter((e=>null!==e));if(0===i.length)return void v("Error loading post data. Please try again.","error");const l=i.map(((e,t)=>({id:`bulk-${e.id}-${t}`,originalPost:e,settings:{...postDuplicatorVars.defaultSettings},isDuplicate:!1})));n(l),o(null),c("bulk"),t(!0)}catch(e){console.error("Error fetching posts:",e),v("Error loading post data. Please try again.","error")}};return document.addEventListener("m4c:bulk-duplicate",e),()=>{document.removeEventListener("m4c:bulk-duplicate",e)}}),[]),(0,l.jsx)(y,{isOpen:e,onClose:()=>{const e=p&&(window.location.href.includes("/wp-admin/edit.php")||!1===window.location.href.includes("/wp-admin/post.php"));t(!1),o(null),n(null),d(!1),m(!1),e&&window.location.reload()},onDuplicate:async(e,t,s)=>{await(async(e,t,s={})=>{const{onSuccess:a,onError:o}=s;try{const s=await fetch(`${postDuplicatorVars.restUrl}duplicate-post`,{method:"POST",headers:{"X-WP-Nonce":postDuplicatorVars.nonce,"Content-Type":"application/json"},body:JSON.stringify({original_id:e,...t})});if(!s.ok){const e=await s.json(),t=new Error(e.message||"Failed to duplicate post");throw t.data=e,t}const o=await s.json();return o.duplicate_id&&a&&a(o),o}catch(e){throw console.error("Error duplicating post:",e),o&&o(e),e}})(e,t,{onSuccess:e=>{d(!0),s?.onSuccess&&s.onSuccess(e)},onError:e=>{v(`Error duplicating post: ${e.message||e.data?.message||"Unknown error"}`,"error"),s?.onError&&s.onError(e)}})},originalPost:s,postsToDuplicate:i,mode:r,defaultSettings:postDuplicatorVars.defaultSettings,postTypes:postDuplicatorVars.postTypes,statusChoices:postDuplicatorVars.statusChoices,siteUrl:postDuplicatorVars.siteUrl,currentUser:postDuplicatorVars.currentUser,isLoadingPostData:u})};document.addEventListener("DOMContentLoaded",(function(){const e=document.createElement("div");e.id="duplicate-post-modal-root",document.body.appendChild(e),(0,a.createRoot)(e).render((0,l.jsx)(j,{}))}))})();