(()=>{"use strict";var t={715:t=>{t.exports=window.wp.blockEditor}},e={};function s(a){var o=e[a];if(void 0!==o)return o.exports;var i=e[a]={exports:{}};return t[a](i,i.exports,s),i.exports}const a=window.wp.element,o=window.wp.components,i=window.wp.i18n,n=window.wp.primitives,l=window.ReactJSXRuntime,r=(0,l.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,l.jsx)(n.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5 4.5h11a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V5a.5.5 0 0 1 .5-.5ZM3 5a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5Zm17 3v10.75c0 .69-.56 1.25-1.25 1.25H6v1.5h12.75a2.75 2.75 0 0 0 2.75-2.75V8H20Z"})}),c=(0,l.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)(n.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm.5 16c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5V7h15v12zM9 10H7v2h2v-2zm0 4H7v2h2v-2zm4-4h-2v2h2v-2zm4 0h-2v2h2v-2zm-4 4h-2v2h2v-2zm4 0h-2v2h2v-2z"})}),p=({settings:t,onSettingsChange:e,postTypes:n,statusChoices:r,originalPost:p,featuredImage:d,onFeaturedImageChange:u})=>{const[m,g]=(0,a.useState)((()=>{const e={...t};return"same"===t.type&&p?.type&&(e.type=p.type),"same"===t.status&&p?.status&&(e.status=p.status),e})()),[_,h]=(0,a.useState)(!1),[f,x]=(0,a.useState)(""),[y,w]=(0,a.useState)(""),[v,S]=(0,a.useState)(!1),[j,D]=(0,a.useState)([]),[b,P]=(0,a.useState)(!1),k=window.postDuplicatorVars?.currentUser,C=window.postDuplicatorVars?.postTypesAuthorSupport||{},T=window.postDuplicatorVars?.postTypesHierarchicalSupport||{},I=()=>"same"===m.type?p?.type:m.type,N=()=>{const t=I();return!0===T[t]},[E,M]=(0,a.useState)((()=>{const t=p?.type;return!1!==C[t]?k?.id?String(k.id):j.length>0?j[0].value:"":""})()),[$,V]=(0,a.useState)(""),[z,U]=(0,a.useState)([]),[B,H]=(0,a.useState)((new Date).toISOString()),[A,L]=(0,a.useState)(""),[R,F]=(0,a.useState)(!1),O=(0,a.useRef)(null),W=(0,a.useRef)(null);(0,a.useEffect)((()=>{(async()=>{if(0===j.length&&!b){P(!0);try{const t=window.postDuplicatorVars?.restUrl||"",e=window.postDuplicatorVars?.nonce||"";if(!t||!e)return console.error("Missing REST URL or nonce for users fetch"),void P(!1);const s=`${t}users`,a=await fetch(s,{method:"GET",headers:{"X-WP-Nonce":e,"Content-Type":"application/json"}});if(a.ok){const t=await a.json();Array.isArray(t)?D(t):console.error("Invalid users response format:",t)}else{const t=await a.text();console.error("Error fetching users:",a.status,a.statusText,t)}}catch(t){console.error("Error fetching users:",t)}finally{P(!1)}}})()}),[]);const{MediaUpload:Z,MediaUploadCheck:G}=(()=>{try{const t=s(715);if(t&&t.MediaUpload&&t.MediaUploadCheck&&"function"==typeof t.MediaUpload&&"function"==typeof t.MediaUploadCheck)return{MediaUpload:t.MediaUpload,MediaUploadCheck:t.MediaUploadCheck}}catch(t){}return{MediaUpload:null,MediaUploadCheck:null}})();let X=!0;try{if(void 0!==window.wp&&window.wp.data&&"function"==typeof window.wp.data.select){const t=window.wp.data.select("core/editor");X=!t||"function"!=typeof t.getCurrentPost}}catch(t){X=!0}const J=t=>t.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),q=t=>J(t),K=(t,s)=>{const a={...m,[t]:s};"timestamp"===t&&"custom"!==s&&(a.customDate=null),g(a),e(a)};(0,a.useEffect)((()=>{if(!v&&p?.title&&p?.slug){const s=t.fullTitle||`${p.title} ${t.title||""}`;x(s.trim());const a=t.fullSlug||`${p.slug}-${t.slug||"copy"}`;w(a);const o={...t,fullTitle:s.trim(),fullSlug:a};g(o),e(o);const i=p?.type;let n,l="";!1!==C[i]&&(l="current_user"===t.post_author?String(k?.id||""):String(p.authorId||k?.id||"")),M(l);let r=!1;if(t.customDate?(n=t.customDate,r=!1):"duplicate"===t.timestamp&&p?.date?(n=p.date,r=!0):(n=(new Date).toISOString(),r=!0),t.time_offset&&r){const e=new Date(n),s=864e5*(t.time_offset_days||0)+36e5*(t.time_offset_hours||0)+6e4*(t.time_offset_minutes||0)+1e3*(t.time_offset_seconds||0);"newer"===t.time_offset_direction?e.setTime(e.getTime()+s):e.setTime(e.getTime()-s),n=e.toISOString()}H(n),L(Q(n));const c=p?.parent||0;V(c>0?String(c):""),K("selectedParentId",c>0?c:null),S(!0)}}),[p,v,t,k]),(0,a.useEffect)((()=>{(async()=>{if(!p?.type)return void U([]);const t="same"===m.type?p.type:m.type;try{const e=await fetch(`${window.postDuplicatorVars.restUrl}parent-posts?post_type=${t}&exclude_id=${p.id}`,{headers:{"X-WP-Nonce":window.postDuplicatorVars.nonce}});if(e.ok){const t=await e.json(),s=t=>{const e=t.level||0;return 0===e?t.title:`${"—".repeat(e)+" "}${t.title}`},a=[{label:(0,i.__)("— No Parent —","post-duplicator"),value:""},...t.map((t=>({label:s(t),value:String(t.id),level:t.level||0})))];U(a),p?.parentPost&&p.parent>0&&(t.some((t=>t.id===p.parent))||(a.splice(1,0,{label:p.parentPost.title,value:String(p.parent),level:0}),U(a)))}}catch(t){console.error("Error fetching parent posts:",t),U([{label:(0,i.__)("— No Parent —","post-duplicator"),value:""}])}})()}),[p?.type,m.type,p?.id,p?.parent,p?.parentPost]),(0,a.useEffect)((()=>{const e={...t};"same"===t.type&&p?.type&&(e.type=p.type),"same"===t.status&&p?.status&&(e.status=p.status),g(e)}),[t,p]),(0,a.useEffect)((()=>{if(!v)return;const t=I(),e=!1!==C[t];if(e||""===E){if(e&&""===E&&k?.id){const t=String(k.id);M(t),K("selectedAuthorId",parseInt(t))}}else M(""),K("selectedAuthorId",null)}),[m.type,v]),(0,a.useEffect)((()=>{v&&(N()||""===$||(V(""),K("selectedParentId",null)))}),[m.type,v]);const Q=t=>new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Y=t=>Array.isArray(t)?t:Object.entries(t).map((([t,e])=>({value:t,label:e}))),tt=()=>{if(void 0===window.wp||!window.wp.media)return console.error("WordPress media library is not available. Make sure wp_enqueue_media() is called."),void alert((0,i.__)("Media library is not available. Please refresh the page.","post-duplicator"));const t=window.wp.media({title:(0,i.__)("Select or Upload Featured Image","post-duplicator"),button:{text:(0,i.__)("Use this image","post-duplicator")},multiple:!1,library:{type:"image"}});t.on("select",(()=>{const e=t.state().get("selection").first().toJSON(),s={id:e.id,url:e.url,thumbnail:e.sizes?.thumbnail?.url||e.url,alt:e.alt||""};u&&u(s)})),t.open()},et=t=>{const e=d?.alt||"",s=d?.url?.split("/").pop()||"",a=`editor-post-featured-image-${d?.id||"new"}-describedby`,n=e||(0,i.__)("The current image has no alternative text.","post-duplicator")+(s?` ${(0,i.__)("The file name is:","post-duplicator")} ${s}`:"");return(0,l.jsxs)("div",{className:"editor-post-featured-image__container",children:[d&&(0,l.jsx)("div",{id:a,className:"hidden",children:n}),d?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Button,{type:"button",className:"components-button editor-post-featured-image__preview is-next-40px-default-size",onClick:t,"aria-label":(0,i.__)("Edit or replace the featured image","post-duplicator"),"aria-describedby":a,"aria-haspopup":"dialog",children:(0,l.jsx)("img",{className:"editor-post-featured-image__preview-image",src:d.url,alt:n})}),(0,l.jsxs)(o.__experimentalHStack,{className:"editor-post-featured-image__actions",children:[(0,l.jsx)(o.Button,{type:"button",className:"components-button editor-post-featured-image__action is-next-40px-default-size",onClick:t,"aria-haspopup":"dialog",children:(0,i.__)("Replace","post-duplicator")}),(0,l.jsx)(o.Button,{type:"button",className:"components-button editor-post-featured-image__action is-next-40px-default-size",onClick:()=>{u&&u(null)},children:(0,i.__)("Remove","post-duplicator")})]})]}):(0,l.jsx)(o.Button,{variant:"secondary",onClick:t,__next40pxDefaultSize:!0,children:(0,i.__)("Set featured image","post-duplicator")}),o.DropZone&&(0,l.jsx)(o.DropZone,{onFilesDrop:e=>{e.length>0&&t()},className:"components-drop-zone",children:(0,l.jsx)("div",{className:"components-drop-zone__content",children:(0,l.jsxs)("div",{className:"components-drop-zone__content-inner",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",className:"components-drop-zone__content-icon","aria-hidden":"true",focusable:"false",children:(0,l.jsx)("path",{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})}),(0,l.jsx)("span",{className:"components-drop-zone__content-text",children:(0,i.__)("Drop files to upload","post-duplicator")})]})})})]})};return(0,l.jsxs)(o.__experimentalVStack,{className:"duplicate-settings-fields",spacing:"20px",children:[(0,l.jsxs)(o.__experimentalHStack,{spacing:"16px",alignment:"stretch",className:"duplicate-settings-fields__top",children:[(0,l.jsxs)(o.__experimentalVStack,{className:"duplicate-settings-fields__title",children:[(0,l.jsx)(o.TextControl,{label:(0,i.__)("Title","post-duplicator"),value:f,onChange:t=>{if(x(t),!_&&p?.title){const s=q(t);w(s);const a={...m,fullTitle:t,fullSlug:s};g(a),e(a)}else K("fullTitle",t)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,style:{flex:1}}),(0,l.jsx)(o.TextControl,{label:(0,i.__)("Slug","post-duplicator"),value:y,onChange:t=>{w(t),h(!0),K("fullSlug",t)},onBlur:()=>{if(y&&""!==y.trim()){const t=J(y);w(t),K("fullSlug",t)}else{const t=q(f);w(t),K("fullSlug",t),h(!1)}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,l.jsx)("div",{className:"duplicate-settings-fields__featured-image",style:{minWidth:"200px",width:"35%",flex:"0 0 auto"},children:(()=>{if(!X&&Z&&G)return(0,l.jsx)(G,{children:(0,l.jsx)(Z,{onSelect:t=>{const e={id:t.id,url:t.url,thumbnail:t.sizes?.thumbnail?.url||t.url,alt:t.alt||""};u&&u(e)},allowedTypes:["image"],value:d?.id,render:({open:t})=>et(t)})});try{return et((()=>tt()))}catch(t){return console.error("Error rendering featured image UI:",t),(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{children:["Error rendering featured image UI: ",t.message]}),(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>tt(),__next40pxDefaultSize:!0,children:(0,i.__)("Set featured image","post-duplicator")})]})}})()})]}),(0,l.jsxs)(o.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,l.jsx)(o.SelectControl,{label:(0,i.__)("Post Type","post-duplicator"),value:m.type,options:Y((()=>{const t={...n};if(p?.type&&!t[p.type]){const e=(window.postDuplicatorVars?.allPostTypes||[]).find((t=>t.id===p.type));if(e)t[p.type]=e.label;else{const e=p.type.split("_").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join(" ");t[p.type]=e}}const e={};return t.same&&(e.same=t.same,delete t.same),Object.entries(t).sort(((t,e)=>t[1].localeCompare(e[1],void 0,{sensitivity:"base"}))).forEach((([t,s])=>{e[t]=s})),e})()),onChange:t=>K("type",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsx)(o.SelectControl,{label:(0,i.__)("Post Status","post-duplicator"),value:m.status,options:Y(r),onChange:t=>K("status",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsx)(o.SelectControl,{label:(0,i.__)("Post Parent","post-duplicator"),value:$||"",options:z,onChange:t=>{V(t),K("selectedParentId",t?parseInt(t):null)},disabled:!N(),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,l.jsxs)(o.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,l.jsx)(o.SelectControl,{label:(0,i.__)("Post Author","post-duplicator"),value:E||"",options:[{label:(0,i.__)("No Author","post-duplicator"),value:""},...j],onChange:t=>{M(t),K("selectedAuthorId",t?parseInt(t):null)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsxs)("div",{ref:O,style:{flex:1,position:"relative"},children:[(0,l.jsx)(o.TextControl,{label:(0,i.__)("Post Date","post-duplicator"),value:A,onChange:t=>{L(t)},onBlur:()=>{try{const t=new Date(A);if(isNaN(t.getTime()))L(Q(B));else{const s=t.toISOString();H(s),L(Q(s));const a={...m,timestamp:"custom",customDate:s};g(a),e(a)}}catch(t){L(Q(B))}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsx)(o.Button,{ref:W,onClick:()=>F(!R),"aria-expanded":R,icon:c,style:{position:"absolute",right:"2px",top:"26px",minWidth:"36px",height:"36px",padding:"0"},variant:"tertiary"}),R&&(0,l.jsx)(o.Popover,{anchorRef:O,placement:"bottom-start",offset:8,onClose:()=>F(!1),children:(0,l.jsx)("div",{style:{padding:"16px"},children:(0,l.jsx)(o.DateTimePicker,{currentDate:B,onChange:t=>{(t=>{const s=t instanceof Date?t.toISOString():new Date(t).toISOString();H(s),L(Q(s));const a={...m,timestamp:"custom",customDate:s};g(a),e(a)})(t),F(!1)},is12Hour:!1})})})]})]})]})},d=({taxonomies:t,onChange:e,enabled:s,onToggle:n})=>{const[r,c]=(0,a.useState)(!1),[p,d]=(0,a.useState)({});(0,a.useEffect)((()=>{if(t&&t.length>0){const e={};t.forEach((t=>{e[t.slug]=t.assignedTermIds||[]})),d(e)}}),[t]);const u=t?t.length:0,m=t?t.reduce(((t,e)=>t+e.terms.length),0):0,g=Object.values(p).reduce(((t,e)=>t+e.length),0);return t&&0!==t.length?(0,l.jsxs)("div",{className:"duplicate-post-modal__taxonomy-section",style:{opacity:s?1:.5},children:[(0,l.jsxs)("div",{className:"duplicate-post-modal__section-header",onClick:t=>{t.target.closest(".components-toggle-control")||c(!r)},style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",cursor:"pointer",borderBottom:r?"1px solid rgba(0, 0, 0, 0.1)":"none"},children:[(0,l.jsx)(o.ToggleControl,{checked:s,onChange:n,__nextHasNoMarginBottom:!0}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("span",{className:"duplicate-post-modal__section-label",children:(0,i.__)("Taxonomies","post-duplicator")}),s&&(0,l.jsxs)("span",{className:"duplicate-post-modal__section-count",children:[" ","(",u," ",(0,i.__)("taxonomies","post-duplicator"),","," ",g||m," ",(0,i.__)("terms","post-duplicator"),")"]})]})]}),r&&(0,l.jsx)("div",{className:"duplicate-post-modal__section-content",style:{padding:"16px"},children:(0,l.jsx)(o.__experimentalVStack,{spacing:"20px",children:t.map((t=>{const s=p[t.slug]||[],a=t.terms.map((t=>t.name)),i=t.terms.filter((t=>s.includes(t.id))).map((t=>t.name));return(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:500},children:t.label}),(0,l.jsx)(o.FormTokenField,{value:i,suggestions:a,onChange:s=>{const a=s.map((e=>{const s=t.terms.find((t=>t.name===e));return s?s.id:null})).filter((t=>null!==t));((t,s)=>{const a={...p,[t]:s};d(a),e&&e(a)})(t.slug,a)},__experimentalExpandOnFocus:!0,__experimentalShowHowTo:!1,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]},t.slug)}))})})]}):null},u=(0,l.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,l.jsx)(n.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})}),m=({customMeta:t,onChange:e,enabled:s,onToggle:n})=>{const[r,c]=(0,a.useState)(!1),[p,d]=(0,a.useState)([]);(0,a.useEffect)((()=>{t&&t.length>0?d(t.map((t=>({key:t.key,value:t.value,type:t.type||"string",isSerialized:t.isSerialized||!1,originalValue:t.originalValue||t.value,isDeleted:!1})))):d([])}),[t]);const m=p.filter((t=>!t.isDeleted)).length,g=(t,s,a)=>{const o=[...p];if(o[t]={...o[t],[s]:a},"value"===s&&("array"===o[t].type||"object"===o[t].type))try{const e=JSON.parse(a);o[t].type=Array.isArray(e)?"array":"object"}catch(t){}if(d(o),e){const t=o.filter((t=>!t.isDeleted)).map((t=>({key:t.key,value:t.value,type:t.type,isSerialized:t.isSerialized})));e(t)}};return t&&0!==t.length?(0,l.jsxs)("div",{className:"duplicate-post-modal__custom-meta-section",style:{opacity:s?1:.5},children:[(0,l.jsxs)("div",{className:"duplicate-post-modal__section-header",onClick:t=>{t.target.closest(".components-toggle-control")||c(!r)},style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",cursor:"pointer",borderBottom:r?"1px solid rgba(0, 0, 0, 0.1)":"none"},children:[(0,l.jsx)(o.ToggleControl,{checked:s,onChange:n,__nextHasNoMarginBottom:!0}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("span",{className:"duplicate-post-modal__section-label",children:(0,i.__)("Custom Meta","post-duplicator")}),s&&(0,l.jsxs)("span",{className:"duplicate-post-modal__section-count",children:[" ","(",m," ",(0,i.__)("fields","post-duplicator"),")"]})]})]}),r&&(0,l.jsx)("div",{className:"duplicate-post-modal__section-content",style:{padding:"16px"},children:(0,l.jsxs)(o.__experimentalVStack,{spacing:"16px",children:[p.map(((t,s)=>!t.isDeleted&&(0,l.jsx)("div",{style:{padding:"12px",border:"1px solid rgba(0, 0, 0, 0.1)",borderRadius:"4px"},children:(0,l.jsxs)(o.__experimentalHStack,{spacing:"8px",alignment:"top",children:[(0,l.jsx)("div",{style:{flex:1},children:(0,l.jsx)(o.TextControl,{label:(0,i.__)("Key","post-duplicator"),value:t.key,onChange:t=>g(s,"key",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,l.jsx)("div",{style:{flex:2},children:"array"===t.type||"object"===t.type?(0,l.jsx)(o.TextareaControl,{label:(0,i.__)("Value (JSON)","post-duplicator"),value:t.value,onChange:t=>g(s,"value",t),onBlur:t=>((t,e)=>{const s=p[t];if("array"===s.type||"object"===s.type)try{JSON.parse(e)}catch(e){g(t,"value",s.value)}})(s,t.target.value),rows:6,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}):(0,l.jsx)(o.TextareaControl,{label:(0,i.__)("Value","post-duplicator"),value:t.value,onChange:t=>g(s,"value",t),rows:3,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,l.jsx)("div",{children:(0,l.jsx)(o.Button,{icon:u,variant:"tertiary",onClick:()=>(t=>{const s=[...p];if(s[t].isDeleted=!0,d(s),e){const t=s.filter((t=>!t.isDeleted)).map((t=>({key:t.key,value:t.value,type:t.type,isSerialized:t.isSerialized})));e(t)}})(s),label:(0,i.__)("Delete field","post-duplicator"),style:{marginTop:"32px"}})})]})},s))),(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>{const t=[...p,{key:"",value:"",type:"string",isSerialized:!1,originalValue:"",isDeleted:!1}];d(t)},style:{alignSelf:"flex-start"},children:(0,i.__)("Add Field","post-duplicator")})]})})]}):null},g=(0,l.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)(n.Path,{d:"M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"})}),_=(0,l.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)(n.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),h=({post:t,index:e,onUpdate:s,onDelete:n,onToggleExpand:r,isExpanded:c,showDelete:h=!0,postTypes:f,statusChoices:x,siteUrl:y,currentUser:w,defaultSettings:v})=>{const[S,j]=(0,a.useState)(t.settings||v),[D,b]=(0,a.useState)(!0),[P,k]=(0,a.useState)(!0),[C,T]=(0,a.useState)({}),[I,N]=(0,a.useState)([]),[E,M]=(0,a.useState)(t.originalPost?.featuredImage||null),[$,V]=(0,a.useState)(!1),z=void 0!==c?c:$;(0,a.useEffect)((()=>{if(t.originalPost?.taxonomies){const e={};t.originalPost.taxonomies.forEach((t=>{e[t.slug]=t.assignedTermIds||[]})),T(e)}else T({})}),[t.originalPost]),(0,a.useEffect)((()=>{t.originalPost?.customMeta?N(t.originalPost.customMeta.map((t=>({key:t.key,value:t.value,type:t.type||"string",isSerialized:t.isSerialized||!1})))):N([])}),[t.originalPost]),(0,a.useEffect)((()=>{t.originalPost?.featuredImage?M(t.originalPost.featuredImage):M(null)}),[t.originalPost]),(0,a.useEffect)((()=>{s&&s({...t,settings:S,taxonomyData:C,customMetaData:I,featuredImage:E,includeTaxonomies:D,includeCustomMeta:P})}),[S,C,I,E,D,P]);const U=()=>{r?r(t.id):V(!$)},B=(()=>{if(S?.fullTitle)return S.fullTitle;const e=S?.title||(0,i.__)("Copy","post-duplicator");return`${t.originalPost?.title||""} ${e}`})(),H=E?.thumbnail||E?.url||null;return(0,l.jsxs)("div",{className:"duplicate-post-modal__post-item "+(z?"duplicate-post-modal__post-item--expanded":"duplicate-post-modal__post-item--collapsed"),children:[(0,l.jsx)("div",{className:"duplicate-post-modal__post-item-header",onClick:t=>{t.target.closest(".duplicate-post-modal__post-item-actions")||U()},children:(0,l.jsxs)(o.__experimentalHStack,{spacing:"12px",alignment:"center",children:[H&&(0,l.jsx)("img",{src:H,alt:"",className:"duplicate-post-modal__post-item-thumbnail"}),(0,l.jsx)("h3",{className:"duplicate-post-modal__post-item-title",children:B}),(0,l.jsxs)("div",{className:"duplicate-post-modal__post-item-actions",onClick:t=>t.stopPropagation(),children:[(0,l.jsx)(o.Button,{icon:z?g:_,variant:"tertiary",onClick:t=>{t.stopPropagation(),U()},label:z?(0,i.__)("Collapse","post-duplicator"):(0,i.__)("Expand","post-duplicator")}),h&&(0,l.jsx)(o.Button,{icon:u,variant:"tertiary",onClick:e=>{e.stopPropagation(),n&&n(t.id)},label:(0,i.__)("Remove","post-duplicator")})]})]})}),z&&(0,l.jsx)("div",{className:"duplicate-post-modal__post-item-content",children:(0,l.jsxs)(o.__experimentalVStack,{spacing:"20px",children:[(0,l.jsx)(p,{settings:S,onSettingsChange:j,postTypes:f,statusChoices:x,originalPost:t.originalPost,featuredImage:E,onFeaturedImageChange:M}),t.originalPost?.taxonomies&&t.originalPost.taxonomies.length>0&&(0,l.jsx)(d,{taxonomies:t.originalPost.taxonomies,onChange:t=>{T(t)},enabled:D,onToggle:b}),t.originalPost?.customMeta&&t.originalPost.customMeta.length>0&&(0,l.jsx)(m,{customMeta:t.originalPost.customMeta,onChange:t=>{N(t)},enabled:P,onToggle:k})]})})]})},f=({posts:t,onPostsChange:e,postTypes:s,statusChoices:i,siteUrl:n,currentUser:r,defaultSettings:c,isMultipleClonesMode:p=!1})=>{const[d,u]=(0,a.useState)(new Set),m=s=>{const a=t.map((t=>t.id===s.id?s:t));e&&e(a)},g=s=>{if(p){const e=t.filter((t=>t.isDuplicate));if(e.length<=1&&e.some((t=>t.id===s)))return}const a=t.filter((t=>t.id!==s));e&&e(a);const o=new Set(d);o.delete(s),u(o)},_=t=>{const e=new Set(d);e.has(t)?e.delete(t):e.add(t),u(e)};if(!t||0===t.length)return null;const f=e=>!p||!!e.isDuplicate&&t.filter((t=>t.isDuplicate)).length>1;return(0,l.jsx)(o.__experimentalVStack,{spacing:"12px",className:"duplicate-post-modal__post-list",children:t.map(((t,e)=>(0,l.jsx)(h,{post:t,index:e,onUpdate:m,onDelete:g,onToggleExpand:_,isExpanded:d.has(t.id),showDelete:f(t),postTypes:s,statusChoices:i,siteUrl:n,currentUser:r,defaultSettings:c},t.id)))})},x=()=>{const t=[{id:"email-customizer",name:"Email Customizer",tagline:(0,i.__)("Transform standard Gravity Forms notifications into stunning, on-brand emails using the familiar WordPress editor to build your templates.","post-duplicator"),cta:(0,i.__)("Learn More →","post-duplicator"),image:"/wp-content/plugins/post-duplicator/assets/img/marketing/email-customizer-bordered.svg",url:"https://www.metaphorcreations.com/wordpress-plugins/email-customizer/?campaign=post-duplicator&ref=266"}],[e]=(0,a.useState)((()=>{const e=Math.floor(Math.random()*t.length);return t[e]}));return(0,l.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"duplicate-post-modal__marketing-banner",children:[(0,l.jsx)("div",{className:"duplicate-post-modal__marketing-banner-image",children:(0,l.jsx)("img",{src:e.image,alt:e.name})}),(0,l.jsxs)("div",{className:"duplicate-post-modal__marketing-banner-content",children:[(0,l.jsx)("div",{className:"duplicate-post-modal__marketing-banner-title",children:e.name}),(0,l.jsx)("div",{className:"duplicate-post-modal__marketing-banner-tagline",children:e.tagline})]}),(0,l.jsx)("div",{className:"duplicate-post-modal__marketing-banner-cta",children:e.cta})]})},y=({isOpen:t,onClose:e,onDuplicate:s,originalPost:n,postsToDuplicate:c,mode:u="single",defaultSettings:g,postTypes:_,statusChoices:h,siteUrl:y,currentUser:w,isLoadingPostData:v=!1,initialDuplicationResult:S=null})=>{const j=window.postDuplicatorVars?.postTypesPublicSupport||{},D="bulk"===u||c&&c.length>0||S&&Array.isArray(S),[b,P]=(0,a.useState)("multiple-clones"===u),[k,C]=(0,a.useState)(2),T=()=>c&&c.length>0?c:n?[{id:`post-${n.id}`,originalPost:n,settings:{...g},isDuplicate:!1}]:[],[I,N]=(0,a.useState)(T()),[E,M]=(0,a.useState)(g),[$,V]=(0,a.useState)(!1),[z,U]=(0,a.useState)(!0),[B,H]=(0,a.useState)(!0),[A,L]=(0,a.useState)({}),[R,F]=(0,a.useState)([]),[O,W]=(0,a.useState)(null),[Z,G]=(0,a.useState)("idle"),[X,J]=(0,a.useState)(null),[q,K]=(0,a.useState)(""),[Q,Y]=(0,a.useState)([]),[tt,et]=(0,a.useState)(0),st=(0,a.useRef)(!1);(0,a.useEffect)((()=>{if(t&&!st.current)if(S)M(g),Array.isArray(S)?(Y(S),G("complete"),N([])):(S.postId&&J(S.postId),S.title&&K(S.title),W(S.featuredImage||null),S.postType&&M({...g,type:S.postType===n?.type?"same":S.postType}),G("complete"),N([]));else{M(g),U(!0),H(!0),G("idle"),J(null),K(""),Y([]);const t=T();N(t),P("multiple-clones"===u),C(2)}!t&&st.current&&(et((t=>t+1)),M(g),U(!0),H(!0),L({}),F([]),W(null),Y([])),st.current=t}),[t,g,u,S]),(0,a.useEffect)((()=>{S&&(Array.isArray(S)?(Y(S),G("complete")):(S.postId&&J(S.postId),S.title&&K(S.title),W(S.featuredImage||null),S.postType&&M((t=>({...t,type:S.postType===n?.type?"same":S.postType}))),G("complete")))}),[S,n]),(0,a.useEffect)((()=>{if(t&&"idle"===Z){const t=T();N(t)}}),[n,c,t,Z]),I.filter((t=>t.isDuplicate)).length;const at=(0,a.useRef)(k),ot=(0,a.useRef)(!1);(0,a.useEffect)((()=>{at.current=k}),[k]),(0,a.useEffect)((()=>{if(b&&!D&&"idle"===Z&&!ot.current){const t=I.filter((t=>t.isDuplicate)).length;t<at.current&&t>=1&&(ot.current=!0,C(t),setTimeout((()=>{ot.current=!1}),0))}}),[I,b,D,Z]);const it=(t,e,s)=>{if(!e.time_offset)return null;let a;a="duplicate"===e.timestamp&&s?.date?new Date(s.date):new Date;const o=(864e5*(e.time_offset_days||0)+36e5*(e.time_offset_hours||0)+6e4*(e.time_offset_minutes||0)+1e3*(e.time_offset_seconds||0))*(t+1);return"newer"===e.time_offset_direction?a.setTime(a.getTime()+o):a.setTime(a.getTime()-o),a.toISOString()};if((0,a.useEffect)((()=>{if(!b||D||"idle"!==Z)return;const t=I.find((t=>!t.isDuplicate));if(!t)return;if(!g.time_offset)return;const e=I.map(((e,s)=>{if(!e.isDuplicate)return e;const a=I.filter((t=>t.isDuplicate)).findIndex((t=>t.id===e.id));if(-1===a)return e;const o=it(a,g,t.originalPost);return o?{...e,settings:{...e.settings,customDate:o,timestamp:"custom"}}:e}));e.some(((t,e)=>t.settings?.customDate!==I[e]?.settings?.customDate))&&N(e)}),[g.time_offset,g.time_offset_days,g.time_offset_hours,g.time_offset_minutes,g.time_offset_seconds,g.time_offset_direction,g.timestamp,b,D,Z]),(0,a.useEffect)((()=>{if(!ot.current)if(b&&!D&&"idle"===Z){const t=I.find((t=>!t.isDuplicate));if(!t)return;const e=I.filter((t=>t.isDuplicate)),s=Math.max(1,k);if(e.length!==s){ot.current=!0;const a=[];for(let o=0;o<s;o++){const s=e[o];if(s)a.push(s);else{const e=it(o,g,t.originalPost),s={...g};e&&(s.customDate=e,s.timestamp="custom"),a.push({id:`clone-${t.originalPost.id}-${o}`,originalPost:t.originalPost,settings:s,isDuplicate:!0})}}N([t,...a]),at.current=s,setTimeout((()=>{ot.current=!1}),0)}}else if(!b&&!D&&I.length>1&&"idle"===Z){const t=I.find((t=>!t.isDuplicate))||I[0];t&&N([{...t,isDuplicate:!1}])}}),[b,D,k,Z]),(0,a.useEffect)((()=>{if(!t||"idle"!==Z||b||D)return;const e=I[0]?.originalPost||n;if(e){if(e?.taxonomies){const t={};e.taxonomies.forEach((e=>{t[e.slug]=e.assignedTermIds||[]})),L(t)}else L({});F(e?.customMeta?e.customMeta.map((t=>({key:t.key,value:t.value,type:t.type||"string",isSerialized:t.isSerialized||!1}))):[]),W(e?.featuredImage?e.featuredImage:null)}}),[t,n,Z,b,D,I]),(0,a.useEffect)((()=>{const e=b||D?I[0]?.featuredImage||null:O;if(t){const t=setTimeout((()=>{const t=document.querySelector(".duplicate-post-modal.components-modal__frame"),s=t?.closest(".components-modal__screen-overlay");s&&s.classList.add("duplicate-post-modal-overlay"),e&&t&&t.style.setProperty("--featured-image-url",`url(${e.thumbnail||e.url})`)}),0);return()=>{clearTimeout(t);const e=document.querySelector(".duplicate-post-modal.components-modal__frame"),s=e?.closest(".components-modal__screen-overlay");s&&s.classList.remove("duplicate-post-modal-overlay")}}}),[O,I,b,D,t]),!t)return null;const nt=()=>{"duplicating"!==Z&&("complete"===Z&&(G("idle"),J(null),K("")),e())},lt=I[0]?.originalPost||n,rt=b||D?I[0]?.featuredImage||null:O,ct=c&&0!==c.length||!n||"idle"!==Z?null:(0,l.jsx)(o.__experimentalHStack,{spacing:"4px",style:{flex:0},children:(0,l.jsx)(o.Button,{icon:r,size:"compact",variant:b?"primary":"secondary",onClick:()=>{const t=!b;P(t),t&&k<2&&C(2)},label:b?(0,i.__)("Multiple Clone","post-duplicator"):(0,i.__)("Single Clone","post-duplicator"),isPressed:b})});return(0,l.jsxs)(o.Modal,{title:(()=>{if(D)return(0,i.__)("Duplicate Posts","post-duplicator");if(b){const t=I[0]?.originalPost||n,e=t?.featuredImage?.thumbnail||t?.featuredImage?.url;return t?.title?e?(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,l.jsx)("img",{src:e,alt:"",style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px",flexShrink:0}}),(0,l.jsx)("span",{children:(0,i.__)(`Duplicate: ${t.title}`,"post-duplicator")})]}):(0,i.__)(`Duplicate: ${t.title}`,"post-duplicator"):(0,i.__)("Duplicate Post","post-duplicator")}const t=I[0]?.originalPost||n;return t?.title?E.fullTitle?E.fullTitle:`${t.title} ${E.title}`:""})(),onRequestClose:nt,headerActions:ct,className:"duplicate-post-modal "+(rt?"duplicate-post-modal--has-featured-image":""),size:"large",style:{borderRadius:0},children:[(0,l.jsx)("div",{className:"duplicate-post-modal__content",style:{paddingBottom:"idle"===Z?"77px":"0"},children:v?(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",minHeight:"200px"},children:[(0,l.jsx)(o.Spinner,{}),(0,l.jsx)("p",{style:{marginTop:"16px",color:"#646970"},children:D||c&&c.length>0?(0,i.__)("Loading posts data...","post-duplicator"):(0,i.__)("Loading post data...","post-duplicator")})]}):"idle"===Z?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(o.__experimentalVStack,{className:"duplicate-post-modal__settings",spacing:"20px",children:[b&&!D&&(!c||0===c.length)&&n&&(0,l.jsx)("div",{className:"duplicate-post-modal__clone-count",children:(0,l.jsx)(o.__experimentalNumberControl,{label:(0,i.__)("Number of Clones","post-duplicator"),value:k,onChange:t=>{const e=Math.max(1,Math.min(50,parseInt(t)||1));C(e)},min:1,max:50,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),!b&&!D&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p,{settings:E,onSettingsChange:M,postTypes:_,statusChoices:h,originalPost:lt,featuredImage:O,onFeaturedImageChange:W},`duplicate-settings-${lt?.id||0}-${tt}`),lt?.taxonomies&&lt.taxonomies.length>0&&(0,l.jsx)(d,{taxonomies:lt.taxonomies,onChange:t=>{L(t)},enabled:z,onToggle:U}),lt?.customMeta&&lt.customMeta.length>0&&(0,l.jsx)(m,{customMeta:lt.customMeta,onChange:t=>{F(t)},enabled:B,onToggle:H})]}),(b||D)&&(0,l.jsx)(f,{posts:b&&!D?I.filter((t=>t.isDuplicate)):I,onPostsChange:t=>{if(b&&!D){if(t.filter((t=>t.isDuplicate)).length<1)return;const e=I.find((t=>!t.isDuplicate));N(e?[e,...t]:t)}else N(t)},postTypes:_,statusChoices:h,siteUrl:y,currentUser:w,defaultSettings:g,isMultipleClonesMode:b&&!D})]}),(0,l.jsx)(x,{})]}):(0,l.jsxs)("div",{className:"duplicate-post-modal__status",children:[!b&&!D&&(0,l.jsxs)("div",{className:"duplicate-post-modal__status-item",children:[(()=>{const t=O||S&&S.featuredImage;return t&&(t.thumbnail||t.url)?(0,l.jsx)("img",{src:t.thumbnail||t.url,alt:"",className:"duplicate-post-modal__status-thumbnail"}):null})(),(0,l.jsx)("h3",{className:"duplicate-post-modal__status-title",children:q}),(0,l.jsx)("div",{className:"duplicate-post-modal__status-actions",children:"duplicating"===Z?(0,l.jsx)(o.Spinner,{}):(0,l.jsxs)(l.Fragment,{children:[(()=>{const t=X||S&&S.postId;if(!t)return null;let e;e=S&&S.postType?S.postType:"same"===E.type?n?.type:E.type;const s=!1!==j[e],a=S?.permalink||Q[0]?.permalink||`${y}/?p=${t}`;return s&&(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>window.open(a,"_blank"),children:(0,i.__)("View Post","post-duplicator")})})(),(()=>{const t=X||S&&S.postId;if(!t)return null;let e;e=S&&S.postType?S.postType:"same"===E.type?n?.type:E.type;const s=e&&"post"!==e?`${y}/wp-admin/post.php?post=${t}&action=edit&post_type=${e}`:`${y}/wp-admin/post.php?post=${t}&action=edit`;return(0,l.jsx)(o.Button,{variant:"primary",onClick:()=>{window.open(s,"_blank")},children:(0,i.__)("Edit Post","post-duplicator")})})()]})})]}),(b||D)&&(0,l.jsxs)(o.__experimentalVStack,{spacing:"12px",className:"duplicate-post-modal__success-list",children:["duplicating"===Z&&(0,l.jsxs)("div",{style:{textAlign:"center",padding:"20px"},children:[(0,l.jsx)(o.Spinner,{}),(0,l.jsx)("p",{style:{marginTop:"12px"},children:(0,i.__)("Duplicating posts...","post-duplicator")})]}),"complete"===Z&&0===Q.length&&(0,l.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,l.jsx)("p",{children:(0,i.__)("No posts were duplicated.","post-duplicator")})}),Q.length>0&&Q.map(((t,e)=>(0,l.jsx)("div",{className:"duplicate-post-modal__success-item "+(t.success?"":"duplicate-post-modal__success-item--error"),children:t.success?(0,l.jsxs)(l.Fragment,{children:[t.featuredImage&&(0,l.jsx)("img",{src:t.featuredImage.thumbnail||t.featuredImage.url,alt:"",className:"duplicate-post-modal__status-thumbnail"}),(0,l.jsx)("h3",{className:"duplicate-post-modal__status-title",children:t.title}),(0,l.jsxs)("div",{className:"duplicate-post-modal__status-actions",children:[(()=>{const e=t.postType||t.originalPost?.type,s=!1!==j[e],a=t.permalink||`${y}/?p=${t.postId}`;return s&&(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>window.open(a,"_blank"),children:(0,i.__)("View Post","post-duplicator")})})(),(0,l.jsx)(o.Button,{variant:"primary",onClick:()=>{const e=t.postType||t.originalPost?.type,s=e&&"post"!==e?`${y}/wp-admin/post.php?post=${t.postId}&action=edit&post_type=${e}`:`${y}/wp-admin/post.php?post=${t.postId}&action=edit`;window.open(s,"_blank")},children:(0,i.__)("Edit Post","post-duplicator")})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("h3",{className:"duplicate-post-modal__status-title",children:t.title||t.originalPost?.title||(0,i.__)("Unknown Post","post-duplicator")}),(0,l.jsxs)("div",{className:"duplicate-post-modal__status-error",children:[(0,i.__)("Error:","post-duplicator")," ",t.error]})]})},e)))]})]})}),"idle"===Z&&(0,l.jsxs)(o.__experimentalHStack,{alignment:"right",className:"duplicate-post-modal__footer",style:{position:"absolute",bottom:"0px",left:"0",padding:"20px",borderTop:"1px solid rgba(0, 0, 0, 0.1)",background:"#FFF"},children:[(0,l.jsx)(o.Button,{variant:"tertiary",onClick:nt,disabled:$||v,children:(0,i.__)("Cancel","post-duplicator")}),(0,l.jsx)(o.Button,{variant:"primary",onClick:async()=>{if(0===I.length)return;V(!0),G("duplicating"),Y([]);const t=[];if(b||D){const e=b&&!D?I.filter((t=>t.isDuplicate)):I;for(let a=0;a<e.length;a++){const o=e[a],n=o.settings||g,l=o.taxonomyData||{},r=o.customMetaData||[],c=o.featuredImage||null,p=void 0===o.includeTaxonomies||o.includeTaxonomies,d=void 0===o.includeCustomMeta||o.includeCustomMeta,u=n.fullTitle||`${o.originalPost.title} ${n.title||(0,i.__)("Copy","post-duplicator")}`;try{const e={...n,includeTaxonomies:p,includeCustomMeta:d,...p?{taxonomyData:l}:{},customMetaData:r,featuredImageId:c?.id||null};await new Promise(((a,i)=>{s(o.originalPost.id,e,{onSuccess:e=>{const s="same"===n.type?o.originalPost.type:n.type;t.push({success:!0,postId:e.duplicate_id,permalink:e.permalink,title:u,originalPost:o.originalPost,featuredImage:c,postType:s}),Y([...t]),a(e)},onError:e=>{console.error(`Error duplicating post ${o.originalPost.id}:`,e),t.push({success:!1,error:e.message||e.data?.message||"Unknown error",title:u,originalPost:o.originalPost}),Y([...t]),a(null)}})}))}catch(e){t.push({success:!1,error:e.message||"Unknown error",title:u,originalPost:o.originalPost}),Y([...t])}}G("complete"),V(!1)}else{const e=I[0],a=E.fullTitle||`${e.originalPost.title} ${E.title}`;K(a);try{const o={...E,includeTaxonomies:z,includeCustomMeta:B,...z?{taxonomyData:A}:{},customMetaData:R,featuredImageId:O?.id||null};await new Promise(((i,n)=>{s(e.originalPost.id,o,{onSuccess:s=>{const o="same"===E.type?e.originalPost.type:E.type;t.push({success:!0,postId:s.duplicate_id,permalink:s.permalink,title:a,originalPost:e.originalPost,featuredImage:O,postType:o}),Y(t),J(s.duplicate_id),G("complete"),V(!1),i(s)},onError:s=>{console.error("Error duplicating:",s),t.push({success:!1,error:s.message||s.data?.message||"Unknown error",originalPost:e.originalPost}),Y(t),G("complete"),V(!1),n(s)}})}))}catch(t){}}},disabled:$||v||0===I.length,isBusy:$,children:$?(0,i.__)("Duplicating...","post-duplicator"):(()=>{if(D||b){const t=b&&!D?k:I.length;return(0,i.__)(`Duplicate ${t} ${1===t?"Post":"Posts"}`,"post-duplicator")}const t=I[0]?.originalPost||n,e="same"===E.type?t?.type:E.type;let s=_[e];if(!s&&e){const t=(window.postDuplicatorVars?.allPostTypes||[]).find((t=>t.id===e));s=t?.label||e}else s||(s=e);return(0,i.__)(`Duplicate ${s}`,"post-duplicator")})()})]})]})},w=async(t,e,s={})=>{const{onSuccess:a,onError:o}=s;try{const s=await fetch(`${postDuplicatorVars.restUrl}duplicate-post`,{method:"POST",headers:{"X-WP-Nonce":postDuplicatorVars.nonce,"Content-Type":"application/json"},body:JSON.stringify({original_id:t,...e})});if(!s.ok){const t=await s.json(),e=new Error(t.message||"Failed to duplicate post");throw e.data=t,e}const o=await s.json();return o.duplicate_id&&a&&a(o),o}catch(t){throw console.error("Error duplicating post:",t),o&&o(t),t}};function v(t,e="error"){const s=document.createElement("div");s.classList.add("my-snackbar",`my-snackbar--${e}`),s.textContent=t,document.body.appendChild(s),setTimeout((()=>{s.classList.add("my-snackbar--hide"),s.addEventListener("transitionend",(()=>s.remove()))}),3e3)}const S=async(t,e="post")=>{const s=await fetch(`${postDuplicatorVars.restUrl}post-full-data/${t}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(!s.ok)throw new Error("Failed to fetch post data");const a=await s.json();let o=[],i=[];try{const e=await fetch(`${postDuplicatorVars.restUrl}post-data/${t}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(e.ok){const t=await e.json();o=t.taxonomies||[],i=t.customMeta||[]}}catch(t){console.error("Error fetching post data:",t)}return{id:a.id,title:a.title,type:a.type,status:a.status,slug:a.slug,date:a.date,author:a.author,authorId:a.authorId,parent:a.parent||0,parentPost:a.parentPost,taxonomies:o,customMeta:i,featuredImage:a.featuredImage}},j=()=>{const[t,e]=(0,a.useState)(!1),[s,o]=(0,a.useState)(null),[i,n]=(0,a.useState)(null),[r,c]=(0,a.useState)("single"),[p,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),[g,_]=(0,a.useState)(null);return(0,a.useEffect)((()=>{const t=async t=>{if(t.target.classList.contains("m4c-duplicate-post")){t.preventDefault();const s=t.target.getAttribute("data-postid"),a=t.target.getAttribute("data-posttype")||"post";if("basic"===(postDuplicatorVars.mode||"advanced")){m(!0);try{const t=await S(s,a);let i={};t.taxonomies&&t.taxonomies.forEach((t=>{i[t.slug]=t.assignedTermIds||[]}));const n=(t.customMeta||[]).map((t=>({key:t.key,value:t.value,type:t.type||"string",isSerialized:t.isSerialized||!1}))),l={...postDuplicatorVars.defaultSettings,includeTaxonomies:!0,includeCustomMeta:!0,taxonomyData:i,customMetaData:n,featuredImageId:t.featuredImage?.id||null};await w(s,l,{onSuccess:async s=>{m(!1);const i=window.location.href.includes("/wp-admin/post.php")&&window.location.href.includes("action=edit")?postDuplicatorVars.singleAfterDuplicationAction||"notice":postDuplicatorVars.listSingleAfterDuplicationAction||"notice",n="same"===l.type?a:l.type,r=`${t.title} ${postDuplicatorVars.defaultSettings.title}`;let p=null;if("notice"===i)try{const t=await fetch(`${postDuplicatorVars.restUrl}post-full-data/${s.duplicate_id}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});t.ok&&(p=(await t.json()).featuredImage||null)}catch(t){console.error("Error fetching duplicated post featured image:",t)}if("notice"===i)d(!0),o(t),_({postId:s.duplicate_id,permalink:s.permalink,title:r,featuredImage:p||t.featuredImage,postType:n}),c("single"),e(!0);else if("new_tab"===i){const t="post"!==n?`${postDuplicatorVars.siteUrl}/wp-admin/post.php?post=${s.duplicate_id}&action=edit&post_type=${n}`:`${postDuplicatorVars.siteUrl}/wp-admin/post.php?post=${s.duplicate_id}&action=edit`;window.open(t,"_blank")}else if("same_tab"===i){const t="post"!==n?`${postDuplicatorVars.siteUrl}/wp-admin/post.php?post=${s.duplicate_id}&action=edit&post_type=${n}`:`${postDuplicatorVars.siteUrl}/wp-admin/post.php?post=${s.duplicate_id}&action=edit`;window.location.href=t}else"refresh"===i&&(d(!0),window.location.reload())},onError:t=>{m(!1),v(`Error duplicating post: ${t.message||t.data?.message||"Unknown error"}`,"error")}})}catch(t){console.error("Error in basic mode duplication:",t),m(!1),v("Failed to duplicate post. Please try again.","error")}}else{o(null),n(null),c("single"),m(!0),e(!0);try{const t=await S(s,a);o(t),m(!1)}catch(t){console.error("Error fetching post:",t),m(!1),e(!1),v("Error loading post data. Please try again.","error")}}}};return document.body.addEventListener("click",t),()=>{document.body.removeEventListener("click",t)}}),[]),(0,a.useEffect)((()=>{const t=async t=>{const{postIds:s,postType:a}=t.detail;if(s&&0!==s.length)if("basic"===(postDuplicatorVars.mode||"advanced")){m(!0),"notice"===(postDuplicatorVars.listMultipleAfterDuplicationAction||"notice")&&(c("bulk"),e(!0));try{const t=s.map((t=>S(t,a).catch((e=>(console.error(`Error fetching post ${t}:`,e),null))))),o=(await Promise.all(t)).filter((t=>null!==t));if(0===o.length)return m(!1),e(!1),void v("Error loading post data. Please try again.","error");const i=[];for(const t of o)try{let e={};t.taxonomies&&t.taxonomies.forEach((t=>{e[t.slug]=t.assignedTermIds||[]}));const s=(t.customMeta||[]).map((t=>({key:t.key,value:t.value,type:t.type||"string",isSerialized:t.isSerialized||!1}))),a={...postDuplicatorVars.defaultSettings,includeTaxonomies:!0,includeCustomMeta:!0,taxonomyData:e,customMetaData:s,featuredImageId:t.featuredImage?.id||null},o="same"===a.type?t.type:a.type,n=`${t.title} ${postDuplicatorVars.defaultSettings.title}`;await w(t.id,a,{onSuccess:e=>{i.push({success:!0,postId:e.duplicate_id,permalink:e.permalink,title:n,originalPost:t,featuredImage:t.featuredImage,postType:o})},onError:e=>{i.push({success:!1,error:e.message||e.data?.message||"Unknown error",title:n,originalPost:t})}})}catch(e){console.error(`Error duplicating post ${t.id}:`,e),i.push({success:!1,error:e.message||"Unknown error",title:`${t.title} ${postDuplicatorVars.defaultSettings.title}`,originalPost:t})}m(!1);const n=postDuplicatorVars.listMultipleAfterDuplicationAction||"notice";"notice"===n?(d(!0),_(i)):"refresh"===n&&(d(!0),window.location.reload())}catch(t){console.error("Error in bulk duplication:",t),m(!1),e(!1),v("Error duplicating posts. Please try again.","error")}}else{n(null),o(null),c("bulk"),m(!0),e(!0);try{const t=s.map((t=>S(t,a).catch((e=>(console.error(`Error fetching post ${t}:`,e),null))))),o=(await Promise.all(t)).filter((t=>null!==t));if(0===o.length)return m(!1),e(!1),void v("Error loading post data. Please try again.","error");const i=o.map(((t,e)=>({id:`bulk-${t.id}-${e}`,originalPost:t,settings:{...postDuplicatorVars.defaultSettings},isDuplicate:!1})));n(i),m(!1)}catch(t){console.error("Error fetching posts:",t),m(!1),e(!1),v("Error loading post data. Please try again.","error")}}};return document.addEventListener("m4c:bulk-duplicate",t),()=>{document.removeEventListener("m4c:bulk-duplicate",t)}}),[]),(0,l.jsx)(y,{isOpen:t,onClose:()=>{const t=p&&(window.location.href.includes("/wp-admin/edit.php")||!1===window.location.href.includes("/wp-admin/post.php"));e(!1),o(null),n(null),d(!1),m(!1),_(null),t&&window.location.reload()},onDuplicate:async(t,e,s)=>{await w(t,e,{onSuccess:t=>{d(!0),s?.onSuccess&&s.onSuccess(t)},onError:t=>{v(`Error duplicating post: ${t.message||t.data?.message||"Unknown error"}`,"error"),s?.onError&&s.onError(t)}})},originalPost:s,postsToDuplicate:i,mode:r,defaultSettings:postDuplicatorVars.defaultSettings,postTypes:postDuplicatorVars.postTypes,statusChoices:postDuplicatorVars.statusChoices,siteUrl:postDuplicatorVars.siteUrl,currentUser:postDuplicatorVars.currentUser,isLoadingPostData:u,initialDuplicationResult:g})};document.addEventListener("DOMContentLoaded",(function(){const t=document.createElement("div");t.id="duplicate-post-modal-root",document.body.appendChild(t),(0,a.createRoot)(t).render((0,l.jsx)(j,{}))}))})();