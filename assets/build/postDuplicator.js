(()=>{"use strict";var e={715:e=>{e.exports=window.wp.blockEditor}},t={};function a(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,a),n.exports}const s=window.wp.element,o=window.wp.components,n=window.wp.i18n,i=window.wp.primitives,l=window.ReactJSXRuntime,r=(0,l.jsx)(i.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)(i.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm.5 16c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5V7h15v12zM9 10H7v2h2v-2zm0 4H7v2h2v-2zm4-4h-2v2h2v-2zm4 0h-2v2h2v-2zm-4 4h-2v2h2v-2zm4 0h-2v2h2v-2z"})}),c=({settings:e,onSettingsChange:t,postTypes:i,statusChoices:c,originalPost:p,featuredImage:d,onFeaturedImageChange:u})=>{const[m,g]=(0,s.useState)((()=>{const t={...e};return"same"===e.type&&p?.type&&(t.type=p.type),"same"===e.status&&p?.status&&(t.status=p.status),t})()),[h,_]=(0,s.useState)(!1),[x,f]=(0,s.useState)(""),[y,v]=(0,s.useState)(""),[S,w]=(0,s.useState)(!1),j=window.postDuplicatorVars?.users||[],b=window.postDuplicatorVars?.currentUser,C=window.postDuplicatorVars?.postTypesAuthorSupport||{},[D,k]=(0,s.useState)((()=>{const e=p?.type;return!1!==C[e]?b?.id?String(b.id):j.length>0?j[0].value:"":""})()),[N,T]=(0,s.useState)(""),[M,z]=(0,s.useState)([]),[E,$]=(0,s.useState)((new Date).toISOString()),[V,P]=(0,s.useState)(""),{MediaUpload:B,MediaUploadCheck:U}=(()=>{try{const e=a(715);if(e&&e.MediaUpload&&e.MediaUploadCheck&&"function"==typeof e.MediaUpload&&"function"==typeof e.MediaUploadCheck)return{MediaUpload:e.MediaUpload,MediaUploadCheck:e.MediaUploadCheck}}catch(e){}return{MediaUpload:null,MediaUploadCheck:null}})();let I=!0;try{if(void 0!==window.wp&&window.wp.data&&"function"==typeof window.wp.data.select){const e=window.wp.data.select("core/editor");I=!e||"function"!=typeof e.getCurrentPost}}catch(e){I=!0}const H=e=>e.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),O=e=>H(e),A=(e,a)=>{const s={...m,[e]:a};"timestamp"===e&&"custom"!==a&&(s.customDate=null),g(s),t(s)};(0,s.useEffect)((()=>{if(!S&&p?.title&&p?.slug){const a=e.fullTitle||`${p.title} ${e.title||""}`;f(a.trim());const s=e.fullSlug||`${p.slug}-${e.slug||"copy"}`;v(s);const o={...e,fullTitle:a.trim(),fullSlug:s};g(o),t(o);const n=p?.type;let i="";!1!==C[n]&&(i="current_user"===e.post_author?String(b?.id||""):String(p.authorId||b?.id||"")),k(i);const l=e.customDate||(new Date).toISOString();$(l),P(F(l));const r=p?.parent||0;T(r>0?String(r):""),A("selectedParentId",r>0?r:null),w(!0)}}),[p,S,e,b]),(0,s.useEffect)((()=>{(async()=>{if(!p?.type)return void z([]);const e="same"===m.type?p.type:m.type;try{const t=await fetch(`${window.postDuplicatorVars.restUrl}parent-posts?post_type=${e}&exclude_id=${p.id}`,{headers:{"X-WP-Nonce":window.postDuplicatorVars.nonce}});if(t.ok){const e=await t.json(),a=e=>{const t=e.level||0;return 0===t?e.title:`${"—".repeat(t)+" "}${e.title}`},s=[{label:(0,n.__)("— No Parent —","post-duplicator"),value:""},...e.map((e=>({label:a(e),value:String(e.id),level:e.level||0})))];z(s),p?.parentPost&&p.parent>0&&(e.some((e=>e.id===p.parent))||(s.splice(1,0,{label:p.parentPost.title,value:String(p.parent),level:0}),z(s)))}}catch(e){console.error("Error fetching parent posts:",e),z([{label:(0,n.__)("— No Parent —","post-duplicator"),value:""}])}})()}),[p?.type,m.type,p?.id,p?.parent,p?.parentPost]),(0,s.useEffect)((()=>{const t={...e};"same"===e.type&&p?.type&&(t.type=p.type),"same"===e.status&&p?.status&&(t.status=p.status),g(t)}),[e,p]),(0,s.useEffect)((()=>{if(!S)return;const e="same"===m.type?p?.type:m.type,t=!1!==C[e];if(t||""===D){if(t&&""===D&&b?.id){const e=String(b.id);k(e),A("selectedAuthorId",parseInt(e))}}else k(""),A("selectedAuthorId",null)}),[m.type,S]);const F=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),L=e=>{const a=e instanceof Date?e.toISOString():new Date(e).toISOString();$(a),P(F(a));const s={...m,timestamp:"custom",customDate:a};g(s),t(s)},R=e=>Array.isArray(e)?e:Object.entries(e).map((([e,t])=>({value:e,label:t}))),W=()=>{if(void 0===window.wp||!window.wp.media)return console.error("WordPress media library is not available. Make sure wp_enqueue_media() is called."),void alert((0,n.__)("Media library is not available. Please refresh the page.","post-duplicator"));const e=window.wp.media({title:(0,n.__)("Select or Upload Featured Image","post-duplicator"),button:{text:(0,n.__)("Use this image","post-duplicator")},multiple:!1,library:{type:"image"}});e.on("select",(()=>{const t=e.state().get("selection").first().toJSON(),a={id:t.id,url:t.url,thumbnail:t.sizes?.thumbnail?.url||t.url,alt:t.alt||""};u&&u(a)})),e.open()},X=e=>{const t=d?.alt||"",a=d?.url?.split("/").pop()||"",s=`editor-post-featured-image-${d?.id||"new"}-describedby`,i=t||(0,n.__)("The current image has no alternative text.","post-duplicator")+(a?` ${(0,n.__)("The file name is:","post-duplicator")} ${a}`:"");return(0,l.jsxs)("div",{className:"editor-post-featured-image__container",children:[d&&(0,l.jsx)("div",{id:s,className:"hidden",children:i}),d?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Button,{type:"button",className:"components-button editor-post-featured-image__preview is-next-40px-default-size",onClick:e,"aria-label":(0,n.__)("Edit or replace the featured image","post-duplicator"),"aria-describedby":s,"aria-haspopup":"dialog",children:(0,l.jsx)("img",{className:"editor-post-featured-image__preview-image",src:d.url,alt:i})}),(0,l.jsxs)(o.__experimentalHStack,{className:"editor-post-featured-image__actions",children:[(0,l.jsx)(o.Button,{type:"button",className:"components-button editor-post-featured-image__action is-next-40px-default-size",onClick:e,"aria-haspopup":"dialog",children:(0,n.__)("Replace","post-duplicator")}),(0,l.jsx)(o.Button,{type:"button",className:"components-button editor-post-featured-image__action is-next-40px-default-size",onClick:()=>{u&&u(null)},children:(0,n.__)("Remove","post-duplicator")})]})]}):(0,l.jsx)(o.Button,{variant:"secondary",onClick:e,__next40pxDefaultSize:!0,children:(0,n.__)("Set featured image","post-duplicator")}),o.DropZone&&(0,l.jsx)(o.DropZone,{onFilesDrop:t=>{t.length>0&&e()},className:"components-drop-zone",children:(0,l.jsx)("div",{className:"components-drop-zone__content",children:(0,l.jsxs)("div",{className:"components-drop-zone__content-inner",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",className:"components-drop-zone__content-icon","aria-hidden":"true",focusable:"false",children:(0,l.jsx)("path",{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})}),(0,l.jsx)("span",{className:"components-drop-zone__content-text",children:(0,n.__)("Drop files to upload","post-duplicator")})]})})})]})};return(0,l.jsxs)(o.__experimentalVStack,{className:"duplicate-settings-fields",spacing:"20px",children:[(0,l.jsxs)(o.__experimentalHStack,{spacing:"16px",alignment:"stretch",className:"duplicate-settings-fields__top",children:[(0,l.jsxs)(o.__experimentalVStack,{className:"duplicate-settings-fields__title",children:[(0,l.jsx)(o.TextControl,{label:(0,n.__)("Title","post-duplicator"),value:x,onChange:e=>{if(f(e),!h&&p?.title){const a=O(e);v(a);const s={...m,fullTitle:e,fullSlug:a};g(s),t(s)}else A("fullTitle",e)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,style:{flex:1}}),(0,l.jsx)(o.TextControl,{label:(0,n.__)("Slug","post-duplicator"),value:y,onChange:e=>{v(e),_(!0),A("fullSlug",e)},onBlur:()=>{if(y&&""!==y.trim()){const e=H(y);v(e),A("fullSlug",e)}else{const e=O(x);v(e),A("fullSlug",e),_(!1)}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,l.jsx)("div",{className:"duplicate-settings-fields__featured-image",style:{minWidth:"200px",width:"35%",flex:"0 0 auto"},children:(()=>{if(!I&&B&&U)return(0,l.jsx)(U,{children:(0,l.jsx)(B,{onSelect:e=>{const t={id:e.id,url:e.url,thumbnail:e.sizes?.thumbnail?.url||e.url,alt:e.alt||""};u&&u(t)},allowedTypes:["image"],value:d?.id,render:({open:e})=>X(e)})});try{return X((()=>W()))}catch(e){return console.error("Error rendering featured image UI:",e),(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{children:["Error rendering featured image UI: ",e.message]}),(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>W(),__next40pxDefaultSize:!0,children:(0,n.__)("Set featured image","post-duplicator")})]})}})()})]}),(0,l.jsxs)(o.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,l.jsx)(o.SelectControl,{label:(0,n.__)("Post Type","post-duplicator"),value:m.type,options:R(i),onChange:e=>A("type",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsx)(o.SelectControl,{label:(0,n.__)("Post Status","post-duplicator"),value:m.status,options:R(c),onChange:e=>A("status",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsx)(o.SelectControl,{label:(0,n.__)("Post Parent","post-duplicator"),value:N||"",options:M,onChange:e=>{T(e),A("selectedParentId",e?parseInt(e):null)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,l.jsxs)(o.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,l.jsx)(o.SelectControl,{label:(0,n.__)("Post Author","post-duplicator"),value:D||"",options:[{label:(0,n.__)("No Author","post-duplicator"),value:""},...j],onChange:e=>{k(e),A("selectedAuthorId",e?parseInt(e):null)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,l.jsx)(o.TextControl,{label:(0,n.__)("Post Date","post-duplicator"),value:V,onChange:e=>{P(e)},onBlur:()=>{try{const e=new Date(V);if(isNaN(e.getTime()))P(F(E));else{const a=e.toISOString();$(a),P(F(a));const s={...m,timestamp:"custom",customDate:a};g(s),t(s)}}catch(e){P(F(E))}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,l.jsx)(o.Dropdown,{popoverProps:{placement:"bottom-end",offset:8},renderToggle:({isOpen:e,onToggle:t})=>(0,l.jsx)(o.Button,{onClick:t,"aria-expanded":e,icon:r,style:{position:"absolute",right:"2px",top:"26px",minWidth:"36px",height:"36px",padding:"0"},variant:"tertiary"}),renderContent:({onClose:e})=>(0,l.jsx)("div",{style:{padding:"16px"},children:(0,l.jsx)(o.DateTimePicker,{currentDate:E,onChange:L,is12Hour:!1})})})]})]})]})},p=({taxonomies:e,onChange:t,enabled:a,onToggle:i})=>{const[r,c]=(0,s.useState)(!1),[p,d]=(0,s.useState)({});(0,s.useEffect)((()=>{if(e&&e.length>0){const t={};e.forEach((e=>{t[e.slug]=e.assignedTermIds||[]})),d(t)}}),[e]);const u=e?e.length:0,m=e?e.reduce(((e,t)=>e+t.terms.length),0):0,g=Object.values(p).reduce(((e,t)=>e+t.length),0);return e&&0!==e.length?(0,l.jsxs)("div",{className:"duplicate-post-modal__taxonomy-section",style:{opacity:a?1:.5},children:[(0,l.jsxs)("div",{className:"duplicate-post-modal__section-header",onClick:e=>{e.target.closest(".components-toggle-control")||c(!r)},style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",cursor:"pointer",borderBottom:r?"1px solid rgba(0, 0, 0, 0.1)":"none"},children:[(0,l.jsx)(o.ToggleControl,{checked:a,onChange:i,__nextHasNoMarginBottom:!0}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("span",{className:"duplicate-post-modal__section-label",children:(0,n.__)("Taxonomies","post-duplicator")}),a&&(0,l.jsxs)("span",{className:"duplicate-post-modal__section-count",children:[" ","(",u," ",(0,n.__)("taxonomies","post-duplicator"),","," ",g||m," ",(0,n.__)("terms","post-duplicator"),")"]})]})]}),r&&(0,l.jsx)("div",{className:"duplicate-post-modal__section-content",style:{padding:"16px"},children:(0,l.jsx)(o.__experimentalVStack,{spacing:"20px",children:e.map((e=>{const a=p[e.slug]||[],s=e.terms.map((e=>e.name)),n=e.terms.filter((e=>a.includes(e.id))).map((e=>e.name));return(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:500},children:e.label}),(0,l.jsx)(o.FormTokenField,{value:n,suggestions:s,onChange:a=>{const s=a.map((t=>{const a=e.terms.find((e=>e.name===t));return a?a.id:null})).filter((e=>null!==e));((e,a)=>{const s={...p,[e]:a};d(s),t&&t(s)})(e.slug,s)},__experimentalExpandOnFocus:!0,__experimentalShowHowTo:!1,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]},e.slug)}))})})]}):null},d=(0,l.jsx)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,l.jsx)(i.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})}),u=({customMeta:e,onChange:t,enabled:a,onToggle:i})=>{const[r,c]=(0,s.useState)(!1),[p,u]=(0,s.useState)([]);(0,s.useEffect)((()=>{e&&e.length>0?u(e.map((e=>({key:e.key,value:e.value,type:e.type||"string",isSerialized:e.isSerialized||!1,originalValue:e.originalValue||e.value,isDeleted:!1})))):u([])}),[e]);const m=p.filter((e=>!e.isDeleted)).length,g=(e,a,s)=>{const o=[...p];if(o[e]={...o[e],[a]:s},"value"===a&&("array"===o[e].type||"object"===o[e].type))try{const t=JSON.parse(s);o[e].type=Array.isArray(t)?"array":"object"}catch(e){}if(u(o),t){const e=o.filter((e=>!e.isDeleted)).map((e=>({key:e.key,value:e.value,type:e.type,isSerialized:e.isSerialized})));t(e)}};return e&&0!==e.length?(0,l.jsxs)("div",{className:"duplicate-post-modal__custom-meta-section",style:{opacity:a?1:.5},children:[(0,l.jsxs)("div",{className:"duplicate-post-modal__section-header",onClick:e=>{e.target.closest(".components-toggle-control")||c(!r)},style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",cursor:"pointer",borderBottom:r?"1px solid rgba(0, 0, 0, 0.1)":"none"},children:[(0,l.jsx)(o.ToggleControl,{checked:a,onChange:i,__nextHasNoMarginBottom:!0}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("span",{className:"duplicate-post-modal__section-label",children:(0,n.__)("Custom Meta","post-duplicator")}),a&&(0,l.jsxs)("span",{className:"duplicate-post-modal__section-count",children:[" ","(",m," ",(0,n.__)("fields","post-duplicator"),")"]})]})]}),r&&(0,l.jsx)("div",{className:"duplicate-post-modal__section-content",style:{padding:"16px"},children:(0,l.jsxs)(o.__experimentalVStack,{spacing:"16px",children:[p.map(((e,a)=>!e.isDeleted&&(0,l.jsx)("div",{style:{padding:"12px",border:"1px solid rgba(0, 0, 0, 0.1)",borderRadius:"4px"},children:(0,l.jsxs)(o.__experimentalHStack,{spacing:"8px",alignment:"top",children:[(0,l.jsx)("div",{style:{flex:1},children:(0,l.jsx)(o.TextControl,{label:(0,n.__)("Key","post-duplicator"),value:e.key,onChange:e=>g(a,"key",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,l.jsx)("div",{style:{flex:2},children:"array"===e.type||"object"===e.type?(0,l.jsx)(o.TextareaControl,{label:(0,n.__)("Value (JSON)","post-duplicator"),value:e.value,onChange:e=>g(a,"value",e),onBlur:e=>((e,t)=>{const a=p[e];if("array"===a.type||"object"===a.type)try{JSON.parse(t)}catch(t){g(e,"value",a.value)}})(a,e.target.value),rows:6,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}):(0,l.jsx)(o.TextareaControl,{label:(0,n.__)("Value","post-duplicator"),value:e.value,onChange:e=>g(a,"value",e),rows:3,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,l.jsx)("div",{children:(0,l.jsx)(o.Button,{icon:d,variant:"tertiary",onClick:()=>(e=>{const a=[...p];if(a[e].isDeleted=!0,u(a),t){const e=a.filter((e=>!e.isDeleted)).map((e=>({key:e.key,value:e.value,type:e.type,isSerialized:e.isSerialized})));t(e)}})(a),label:(0,n.__)("Delete field","post-duplicator"),style:{marginTop:"32px"}})})]})},a))),(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>{const e=[...p,{key:"",value:"",type:"string",isSerialized:!1,originalValue:"",isDeleted:!1}];u(e)},style:{alignSelf:"flex-start"},children:(0,n.__)("Add Field","post-duplicator")})]})})]}):null},m=({isOpen:e,onClose:t,onDuplicate:a,originalPost:i,defaultSettings:r,postTypes:d,statusChoices:m,siteUrl:g,currentUser:h})=>{const[_,x]=(0,s.useState)(r),[f,y]=(0,s.useState)(!1),[v,S]=(0,s.useState)(!0),[w,j]=(0,s.useState)(!0),[b,C]=(0,s.useState)({}),[D,k]=(0,s.useState)([]),[N,T]=(0,s.useState)(null),[M,z]=(0,s.useState)("idle"),[E,$]=(0,s.useState)(null),[V,P]=(0,s.useState)(""),[B,U]=(0,s.useState)(0),I=(0,s.useRef)(!1);if((0,s.useEffect)((()=>{e&&!I.current&&(x(r),S(!0),j(!0),z("idle"),$(null),P("")),!e&&I.current&&(U((e=>e+1)),x(r),S(!0),j(!0),C({}),k([]),T(null)),I.current=e}),[e,r]),(0,s.useEffect)((()=>{if(e&&"idle"===M){if(i?.taxonomies){const e={};i.taxonomies.forEach((t=>{e[t.slug]=t.assignedTermIds||[]})),C(e)}else C({});k(i?.customMeta?i.customMeta.map((e=>({key:e.key,value:e.value,type:e.type||"string",isSerialized:e.isSerialized||!1}))):[]),T(i?.featuredImage?i.featuredImage:null)}}),[e,i,M]),(0,s.useEffect)((()=>{if(N&&e){const e=setTimeout((()=>{const e=document.querySelector(".duplicate-post-modal--has-featured-image.components-modal__frame");e&&e.style.setProperty("--featured-image-url",`url(${N.thumbnail||N.url})`)}),0);return()=>clearTimeout(e)}}),[N,e]),!e)return null;const H=()=>{"duplicating"!==M&&("complete"===M&&(z("idle"),$(null),P("")),t())};return(0,l.jsxs)(o.Modal,{title:i?.title?_.fullTitle?_.fullTitle:`${i.title} ${_.title}`:"",onRequestClose:H,className:"duplicate-post-modal "+(N?"duplicate-post-modal--has-featured-image":""),size:"large",style:{borderRadius:0},children:[(0,l.jsx)("div",{className:"duplicate-post-modal__content",style:{paddingBottom:"idle"===M?"77px":"0"},children:"idle"===M?(0,l.jsxs)(o.__experimentalVStack,{className:"duplicate-post-modal__settings",children:[(0,l.jsx)(c,{settings:_,onSettingsChange:x,postTypes:d,statusChoices:m,originalPost:i,featuredImage:N,onFeaturedImageChange:T},`duplicate-settings-${i?.id||0}-${B}`),i?.taxonomies&&i.taxonomies.length>0&&(0,l.jsx)(p,{taxonomies:i.taxonomies,onChange:e=>{C(e)},enabled:v,onToggle:S}),i?.customMeta&&i.customMeta.length>0&&(0,l.jsx)(u,{customMeta:i.customMeta,onChange:e=>{k(e)},enabled:w,onToggle:j})]}):(0,l.jsx)("div",{className:"duplicate-post-modal__status",children:(0,l.jsxs)("div",{className:"duplicate-post-modal__status-item",children:[N&&(0,l.jsx)("img",{src:N.thumbnail||N.url,alt:"",className:"duplicate-post-modal__status-thumbnail"}),(0,l.jsx)("h3",{className:"duplicate-post-modal__status-title",children:V}),(0,l.jsx)("div",{className:"duplicate-post-modal__status-actions",children:"duplicating"===M?(0,l.jsx)(o.Spinner,{}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Button,{variant:"secondary",onClick:()=>window.open(`${g}/?p=${E}`,"_blank"),children:(0,n.__)("View Post","post-duplicator")}),(0,l.jsx)(o.Button,{variant:"primary",onClick:()=>window.open(`${g}/wp-admin/post.php?post=${E}&action=edit`,"_blank"),children:(0,n.__)("Edit Post","post-duplicator")})]})})]})})}),"idle"===M&&(0,l.jsxs)(o.__experimentalHStack,{alignment:"right",className:"duplicate-post-modal__footer",style:{position:"absolute",bottom:"0px",left:"0",padding:"20px",borderTop:"1px solid rgba(0, 0, 0, 0.1)",background:"#FFF"},children:[(0,l.jsx)(o.Button,{variant:"tertiary",onClick:H,disabled:f,children:(0,n.__)("Cancel","post-duplicator")}),(0,l.jsx)(o.Button,{variant:"primary",onClick:async()=>{y(!0),z("duplicating");const e=_.fullTitle||`${i.title} ${_.title}`;P(e);try{const e={..._,includeTaxonomies:v,includeCustomMeta:w,...v?{taxonomyData:b}:{},customMetaData:D,featuredImageId:N?.id||null};await new Promise(((t,s)=>{a(e,{onSuccess:e=>{$(e.duplicate_id),z("complete"),y(!1),t(e)},onError:e=>{console.error("Error duplicating:",e),z("idle"),y(!1),s(e)}})}))}catch(e){}},disabled:f,isBusy:f,children:f?(0,n.__)("Duplicating...","post-duplicator"):(()=>{const e="same"===_.type?i.type:_.type,t=d[e]||e;return(0,n.__)(`Duplicate ${t}`,"post-duplicator")})()})]})]})};function g(e,t="error"){const a=document.createElement("div");a.classList.add("my-snackbar",`my-snackbar--${t}`),a.textContent=e,document.body.appendChild(a),setTimeout((()=>{a.classList.add("my-snackbar--hide"),a.addEventListener("transitionend",(()=>a.remove()))}),3e3)}const h=()=>{const[e,t]=(0,s.useState)(!1),[a,o]=(0,s.useState)(null);return(0,s.useEffect)((()=>{const e=async e=>{if(e.target.classList.contains("m4c-duplicate-post")){e.preventDefault();const a=e.target.getAttribute("data-postid"),s=e.target.getAttribute("data-posttype")||"post";try{const e=postDuplicatorVars.restUrl.replace("post-duplicator/v1/","wp/v2/"),n=`${e}${"page"===s?"pages":"post"===s?"posts":s}/${a}`,i=await fetch(n,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(!i.ok)throw new Error("Failed to fetch post data");const l=await i.json();let r="Unknown Author";if(l.author&&l.author>0)try{const e=await fetch(`${postDuplicatorVars.restUrl.replace("post-duplicator/v1/","wp/v2/")}users/${l.author}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});e.ok&&(r=(await e.json()).name)}catch(e){console.error("Error fetching author:",e)}let c=null;if(l.featured_media&&l.featured_media>0)try{const e=await fetch(`${postDuplicatorVars.restUrl.replace("post-duplicator/v1/","wp/v2/")}media/${l.featured_media}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(e.ok){const t=await e.json();c={id:t.id,url:t.source_url,thumbnail:t.media_details?.sizes?.thumbnail?.source_url||t.source_url,alt:t.alt_text||""}}}catch(e){console.error("Error fetching featured image:",e)}let p=null;if(l.parent&&l.parent>0)try{const t="page"===s?"pages":"post"===s?"posts":s,a=await fetch(`${e}${t}/${l.parent}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(a.ok){const e=await a.json();p={id:e.id,title:e.title.rendered}}}catch(e){console.error("Error fetching parent post:",e)}let d=[],u=[];try{const e=await fetch(`${postDuplicatorVars.restUrl}post-data/${a}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(e.ok){const t=await e.json();d=t.taxonomies||[],u=t.customMeta||[]}}catch(e){console.error("Error fetching post data:",e)}o({id:l.id,title:l.title.rendered,type:l.type,status:l.status,slug:l.slug,date:l.date,author:r,authorId:l.author,parent:l.parent||0,parentPost:p,taxonomies:d,customMeta:u,featuredImage:c}),t(!0)}catch(e){console.error("Error fetching post:",e),g("Error loading post data. Please try again.","error")}}};return document.body.addEventListener("click",e),()=>{document.body.removeEventListener("click",e)}}),[]),(0,l.jsx)(m,{isOpen:e,onClose:()=>t(!1),onDuplicate:async(e,t)=>{a&&await(async(e,t,a={})=>{const{onSuccess:s,onError:o}=a;try{const a=await fetch(`${postDuplicatorVars.restUrl}duplicate-post`,{method:"POST",headers:{"X-WP-Nonce":postDuplicatorVars.nonce,"Content-Type":"application/json"},body:JSON.stringify({original_id:e,...t})});if(!a.ok){const e=await a.json(),t=new Error(e.message||"Failed to duplicate post");throw t.data=e,t}const o=await a.json();return o.duplicate_id&&s&&s(o),o}catch(e){throw console.error("Error duplicating post:",e),o&&o(e),e}})(a.id,e,{onSuccess:e=>{t?.onSuccess&&t.onSuccess(e)},onError:e=>{g(`Error duplicating post: ${e.message||e.data?.message||"Unknown error"}`,"error"),t?.onError&&t.onError(e)}})},originalPost:a,defaultSettings:postDuplicatorVars.defaultSettings,postTypes:postDuplicatorVars.postTypes,statusChoices:postDuplicatorVars.statusChoices,siteUrl:postDuplicatorVars.siteUrl,currentUser:postDuplicatorVars.currentUser})};document.addEventListener("DOMContentLoaded",(function(){const e=document.createElement("div");e.id="duplicate-post-modal-root",document.body.appendChild(e),(0,s.createRoot)(e).render((0,l.jsx)(h,{}))}))})();