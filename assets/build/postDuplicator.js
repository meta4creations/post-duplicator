(()=>{"use strict";const t=window.wp.element,e=window.wp.components,s=window.wp.i18n,a=window.wp.primitives,o=window.ReactJSXRuntime,i=(0,o.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,o.jsx)(a.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),n=(0,o.jsx)(a.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)(a.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm.5 16c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5V7h15v12zM9 10H7v2h2v-2zm0 4H7v2h2v-2zm4-4h-2v2h2v-2zm4 0h-2v2h2v-2zm-4 4h-2v2h2v-2zm4 0h-2v2h2v-2z"})}),l=({settings:a,onSettingsChange:i,postTypes:l,statusChoices:r,originalPost:p})=>{const[c,u]=(0,t.useState)((()=>{const t={...a};return"same"===a.type&&p?.type&&(t.type=p.type),"same"===a.status&&p?.status&&(t.status=p.status),t})()),[d,m]=(0,t.useState)(!1),[_,g]=(0,t.useState)(""),[h,x]=(0,t.useState)(""),[v,w]=(0,t.useState)(!1),f=window.postDuplicatorVars?.users||[],S=window.postDuplicatorVars?.currentUser,y=S?.id?String(S.id):f.length>0?f[0].value:"",[j,D]=(0,t.useState)(y),[C,b]=(0,t.useState)((new Date).toISOString()),[N,$]=(0,t.useState)(""),T=t=>t.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),P=t=>T(t),k=(t,e)=>{const s={...c,[t]:e};"timestamp"===t&&"custom"!==e&&(s.customDate=null),u(s),i(s)};(0,t.useEffect)((()=>{if(!v&&p?.title&&p?.slug){const t=a.fullTitle||`${p.title} ${a.title||""}`;g(t.trim());const e=a.fullSlug||`${p.slug}-${a.slug||"copy"}`;x(e);const s="current_user"===a.post_author?String(S?.id||""):String(p.authorId||S?.id||"");D(s);const o=a.customDate||(new Date).toISOString();b(o),$(V(o)),w(!0)}}),[p,v,a,S]),(0,t.useEffect)((()=>{const t={...a};"same"===a.type&&p?.type&&(t.type=p.type),"same"===a.status&&p?.status&&(t.status=p.status),u(t)}),[a,p]);const V=t=>new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),z=t=>{b(t),$(V(t)),k("customDate",t)},H=t=>Array.isArray(t)?t:Object.entries(t).map((([t,e])=>({value:t,label:e})));return(0,o.jsxs)(e.__experimentalVStack,{className:"duplicate-settings-fields",spacing:"20px",children:[(0,o.jsxs)(e.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,o.jsx)(e.TextControl,{label:(0,s.__)("Title","post-duplicator"),value:_,onChange:t=>{if(g(t),!d&&p?.title){const e=P(t);x(e)}k("fullTitle",t)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,o.jsx)(e.TextControl,{label:(0,s.__)("Slug","post-duplicator"),value:h,onChange:t=>{x(t),m(!0),k("fullSlug",t)},onBlur:()=>{if(h&&""!==h.trim()){const t=T(h);x(t),k("fullSlug",t)}else{const t=P(_);x(t),k("fullSlug",t),m(!1)}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,o.jsxs)(e.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,o.jsx)(e.SelectControl,{label:(0,s.__)("Post Status","post-duplicator"),value:c.status,options:H(r),onChange:t=>k("status",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,o.jsx)(e.SelectControl,{label:(0,s.__)("Post Type","post-duplicator"),value:c.type,options:H(l),onChange:t=>k("type",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,o.jsxs)(e.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,o.jsx)(e.SelectControl,{label:(0,s.__)("Post Author","post-duplicator"),value:j||"",options:f,onChange:t=>{D(t),k("selectedAuthorId",parseInt(t))},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,o.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,o.jsx)(e.TextControl,{label:(0,s.__)("Post Date","post-duplicator"),value:N,onChange:t=>{$(t)},onBlur:()=>{try{const t=new Date(N);if(isNaN(t.getTime()))$(V(C));else{const e=t.toISOString();b(e),$(V(e)),k("customDate",e)}}catch(t){$(V(C))}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,o.jsx)(e.Dropdown,{position:"bottom right",popoverProps:{placement:"bottom-end",offset:8},renderToggle:({isOpen:t,onToggle:s})=>(0,o.jsx)(e.Button,{onClick:s,"aria-expanded":t,icon:n,style:{position:"absolute",right:"2px",top:"26px",minWidth:"36px",height:"36px",padding:"0"},variant:"tertiary"}),renderContent:({onClose:t})=>(0,o.jsx)("div",{style:{padding:"16px"},children:(0,o.jsx)(e.DateTimePicker,{currentDate:C,onChange:z,is12Hour:!1})})})]})]})]})},r=({isOpen:a,onClose:n,onDuplicate:r,originalPost:p,defaultSettings:c,postTypes:u,statusChoices:d,siteUrl:m,currentUser:_})=>{const[g,h]=(0,t.useState)(c),[x,v]=(0,t.useState)(!1),[w,f]=(0,t.useState)(!1);(0,t.useEffect)((()=>{a&&(h(c),v(!1))}),[a,c]);const S=()=>{const t="same"===g.type?p.type:g.type;return u[t]||t};if(!a)return null;const y=(0,o.jsx)(e.Button,{icon:i,variant:x?"primary":"secondary",label:x?(0,s.__)("Done Customizing","post-duplicator"):(0,s.__)("Customize Settings","post-duplicator"),onClick:()=>v(!x),size:"small"});return(0,o.jsxs)(e.Modal,{title:p?.title?g.fullTitle?g.fullTitle:`${p.title} ${g.title}`:"",onRequestClose:n,className:"duplicate-post-modal",size:"large",style:{borderRadius:0},headerActions:y,children:[(0,o.jsxs)("div",{className:"duplicate-post-modal__content",style:{paddingBottom:"77px"},children:[(0,o.jsxs)("div",{className:"duplicate-post-modal__preview",children:[(0,o.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,o.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,s.__)("Post Type:","post-duplicator")}),(0,o.jsx)("span",{className:"duplicate-post-modal__preview-value",children:S()})]}),(0,o.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,o.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,s.__)("Post Status:","post-duplicator")}),(0,o.jsx)("span",{className:"duplicate-post-modal__preview-value",children:(()=>{const t="same"===g.status?p.status:g.status;return d[t]||t})()})]}),(0,o.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,o.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,s.__)("Post Date:","post-duplicator")}),(0,o.jsx)("span",{className:"duplicate-post-modal__preview-value",children:(()=>{let t;if(t=g.customDate?new Date(g.customDate).getTime():"duplicate"===g.timestamp&&p.date?new Date(p.date).getTime():Date.now(),g.time_offset){const e=1e3*(86400*parseInt(g.time_offset_days||0)+3600*parseInt(g.time_offset_hours||0)+60*parseInt(g.time_offset_minutes||0)+parseInt(g.time_offset_seconds||0));"newer"===g.time_offset_direction?t+=e:t-=e}const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`})()})]}),(0,o.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,o.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,s.__)("Post Author:","post-duplicator")}),(0,o.jsx)("span",{className:"duplicate-post-modal__preview-value",children:"current_user"===g.post_author?_?.name||(0,s.__)("Current User","post-duplicator"):p?.author?p.author:(0,s.__)("Original Author","post-duplicator")})]}),(0,o.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,o.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,s.__)("Post URL:","post-duplicator")}),(0,o.jsx)("span",{className:"duplicate-post-modal__preview-value duplicate-post-modal__preview-url",children:(()=>{const t=p?.slug?g.fullSlug?g.fullSlug:`${p.slug}-${g.slug||"copy"}`:"";return t&&m?`${m}/${t}/`:""})()})]})]}),x&&(0,o.jsx)("div",{className:"duplicate-post-modal__settings",children:(0,o.jsx)(l,{settings:g,onSettingsChange:h,postTypes:u,statusChoices:d,originalPost:p})})]}),(0,o.jsxs)(e.__experimentalHStack,{alignment:"right",className:"duplicate-post-modal__footer",style:{position:"absolute",bottom:"0px",left:"0",padding:"20px",borderTop:"1px solid rgba(0, 0, 0, 0.1)",background:"#FFF"},children:[(0,o.jsx)(e.Button,{variant:"tertiary",onClick:n,disabled:w,children:(0,s.__)("Cancel","post-duplicator")}),(0,o.jsx)(e.Button,{variant:"primary",onClick:async()=>{f(!0);try{await r(g)}catch(t){console.error("Error duplicating:",t)}finally{f(!1)}},disabled:w,isBusy:w,children:w?(0,s.__)("Duplicating...","post-duplicator"):(()=>{const t=S();return(0,s.__)(`Duplicate ${t}`,"post-duplicator")})()})]})]})};function p(t,e="error"){const s=document.createElement("div");s.classList.add("my-snackbar",`my-snackbar--${e}`),s.textContent=t,document.body.appendChild(s),setTimeout((()=>{s.classList.add("my-snackbar--hide"),s.addEventListener("transitionend",(()=>s.remove()))}),3e3)}const c=()=>{const[e,s]=(0,t.useState)(!1),[a,i]=(0,t.useState)(null);return(0,t.useEffect)((()=>{const t=async t=>{if(t.target.classList.contains("m4c-duplicate-post")){t.preventDefault();const e=t.target.getAttribute("data-postid"),a=t.target.getAttribute("data-posttype")||"post";try{const t=`${postDuplicatorVars.restUrl.replace("post-duplicator/v1/","wp/v2/")}${"page"===a?"pages":"post"===a?"posts":a}/${e}`,o=await fetch(t,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(!o.ok)throw new Error("Failed to fetch post data");const n=await o.json(),l=await fetch(`${postDuplicatorVars.restUrl.replace("post-duplicator/v1/","wp/v2/")}users/${n.author}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});let r="Unknown Author";l.ok&&(r=(await l.json()).name),i({id:n.id,title:n.title.rendered,type:n.type,status:n.status,slug:n.slug,date:n.date,author:r,authorId:n.author}),s(!0)}catch(t){console.error("Error fetching post:",t),p("Error loading post data. Please try again.","error")}}};return document.body.addEventListener("click",t),()=>{document.body.removeEventListener("click",t)}}),[]),(0,o.jsx)(r,{isOpen:e,onClose:()=>s(!1),onDuplicate:async t=>{if(!a)return;const e={original_id:a.id,...t};try{const t=await fetch(`${postDuplicatorVars.restUrl}duplicate-post`,{method:"POST",headers:{"X-WP-Nonce":postDuplicatorVars.nonce,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw await t.json();const s=await t.json();if(s.duplicate_id){let t=window.location.href;t.includes("?")?t+=`&post-duplicated=${s.duplicate_id}`:t+=`?post-duplicated=${s.duplicate_id}`,window.location.href=t}}catch(t){console.error("Error duplicating post:",t.message),p(`Error duplicating post: ${t.message}`,"error"),s(!1)}},originalPost:a,defaultSettings:postDuplicatorVars.defaultSettings,postTypes:postDuplicatorVars.postTypes,statusChoices:postDuplicatorVars.statusChoices,siteUrl:postDuplicatorVars.siteUrl,currentUser:postDuplicatorVars.currentUser})};document.addEventListener("DOMContentLoaded",(function(){const e=document.createElement("div");e.id="duplicate-post-modal-root",document.body.appendChild(e),(0,t.createRoot)(e).render((0,o.jsx)(c,{}))}))})();