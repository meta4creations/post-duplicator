(()=>{"use strict";const t=window.wp.element,e=window.wp.components,s=window.wp.i18n,a=window.wp.primitives,o=window.ReactJSXRuntime,i=(0,o.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,o.jsx)(a.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})}),l=(0,o.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,o.jsx)(a.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),n=(0,o.jsx)(a.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)(a.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm.5 16c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5V7h15v12zM9 10H7v2h2v-2zm0 4H7v2h2v-2zm4-4h-2v2h2v-2zm4 0h-2v2h2v-2zm-4 4h-2v2h2v-2zm4 0h-2v2h2v-2z"})}),r=({settings:a,onSettingsChange:i,postTypes:l,statusChoices:r,originalPost:c})=>{const[p,d]=(0,t.useState)(a),[u,m]=(0,t.useState)(!1),[_,g]=(0,t.useState)(""),[h,x]=(0,t.useState)(""),[v,w]=(0,t.useState)(!1),f=window.postDuplicatorVars?.users||[],S=window.postDuplicatorVars?.currentUser,j=S?.id?String(S.id):f.length>0?f[0].value:"",[y,D]=(0,t.useState)(j),[C,b]=(0,t.useState)((new Date).toISOString()),[N,$]=(0,t.useState)(""),T=t=>t.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),P=t=>T(t),k=(t,e)=>{const s={...p,[t]:e};"timestamp"===t&&"custom"!==e&&(s.customDate=null),d(s),i(s)};(0,t.useEffect)((()=>{if(!v&&c?.title&&c?.slug){const t=a.fullTitle||`${c.title} ${a.title||""}`;g(t.trim());const e=a.fullSlug||`${c.slug}-${a.slug||"copy"}`;x(e);const s="current_user"===a.post_author?String(S?.id||""):String(c.authorId||S?.id||"");D(s);const o=a.customDate||(new Date).toISOString();b(o),$(V(o)),w(!0)}}),[c,v,a,S]),(0,t.useEffect)((()=>{d(a)}),[a]);const V=t=>new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),z=t=>{b(t),$(V(t)),k("customDate",t)},B=t=>Array.isArray(t)?t:Object.entries(t).map((([t,e])=>({value:t,label:e})));return(0,o.jsxs)(e.__experimentalVStack,{className:"duplicate-settings-fields",spacing:"20px",children:[(0,o.jsxs)(e.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,o.jsx)(e.TextControl,{label:(0,s.__)("Title","post-duplicator"),value:_,onChange:t=>{if(g(t),!u&&c?.title){const e=P(t);x(e)}k("fullTitle",t)},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,o.jsx)(e.TextControl,{label:(0,s.__)("Slug","post-duplicator"),value:h,onChange:t=>{x(t),m(!0),k("fullSlug",t)},onBlur:()=>{if(h&&""!==h.trim()){const t=T(h);x(t),k("fullSlug",t)}else{const t=P(_);x(t),k("fullSlug",t),m(!1)}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,o.jsxs)(e.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,o.jsx)(e.SelectControl,{label:(0,s.__)("Post Status","post-duplicator"),value:p.status,options:B(r),onChange:t=>k("status",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,o.jsx)(e.SelectControl,{label:(0,s.__)("Post Type","post-duplicator"),value:p.type,options:B(l),onChange:t=>k("type",t),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]}),(0,o.jsxs)(e.__experimentalHStack,{spacing:"16px",alignment:"stretch",children:[(0,o.jsx)(e.SelectControl,{label:(0,s.__)("Post Author","post-duplicator"),value:y||"",options:f,onChange:t=>{D(t),k("selectedAuthorId",parseInt(t))},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,o.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,o.jsx)(e.TextControl,{label:(0,s.__)("Post Date","post-duplicator"),value:N,onChange:t=>{$(t)},onBlur:()=>{try{const t=new Date(N);if(isNaN(t.getTime()))$(V(C));else{const e=t.toISOString();b(e),$(V(e)),k("customDate",e)}}catch(t){$(V(C))}},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,o.jsx)(e.Dropdown,{position:"bottom right",popoverProps:{placement:"bottom-end",offset:8},renderToggle:({isOpen:t,onToggle:s})=>(0,o.jsx)(e.Button,{onClick:s,"aria-expanded":t,icon:n,style:{position:"absolute",right:"2px",top:"26px",minWidth:"36px",height:"36px",padding:"0"},variant:"tertiary"}),renderContent:({onClose:t})=>(0,o.jsx)("div",{style:{padding:"16px"},children:(0,o.jsx)(e.DateTimePicker,{currentDate:C,onChange:z,is12Hour:!1})})})]})]})]})},c=({isOpen:a,onClose:n,onDuplicate:c,originalPost:p,defaultSettings:d,postTypes:u,statusChoices:m,siteUrl:_,currentUser:g})=>{const[h,x]=(0,t.useState)(d),[v,w]=(0,t.useState)(!1),[f,S]=(0,t.useState)(!1);(0,t.useEffect)((()=>{a&&(x(d),w(!1))}),[a,d]);const j=()=>{const t="same"===h.type?p.type:h.type;return u[t]||t};if(!a)return null;const y=(0,o.jsx)(e.Button,{icon:v?i:l,label:v?(0,s.__)("Done Customizing","post-duplicator"):(0,s.__)("Customize Settings","post-duplicator"),onClick:()=>w(!v),size:"small"});return(0,o.jsxs)(e.Modal,{title:p?.title?h.fullTitle?h.fullTitle:`${p.title} ${h.title}`:"",onRequestClose:n,className:"duplicate-post-modal",size:"large",style:{borderRadius:0},headerActions:y,children:[(0,o.jsxs)("div",{className:"duplicate-post-modal__content",style:{paddingBottom:"77px"},children:[(0,o.jsxs)("div",{className:"duplicate-post-modal__preview",children:[(0,o.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,o.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,s.__)("Post Type:","post-duplicator")}),(0,o.jsx)("span",{className:"duplicate-post-modal__preview-value",children:j()})]}),(0,o.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,o.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,s.__)("Post Status:","post-duplicator")}),(0,o.jsx)("span",{className:"duplicate-post-modal__preview-value",children:(()=>{const t="same"===h.status?p.status:h.status;return m[t]||t})()})]}),(0,o.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,o.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,s.__)("Post Date:","post-duplicator")}),(0,o.jsx)("span",{className:"duplicate-post-modal__preview-value",children:(()=>{let t;if(t=h.customDate?new Date(h.customDate).getTime():"duplicate"===h.timestamp&&p.date?new Date(p.date).getTime():Date.now(),h.time_offset){const e=1e3*(86400*parseInt(h.time_offset_days||0)+3600*parseInt(h.time_offset_hours||0)+60*parseInt(h.time_offset_minutes||0)+parseInt(h.time_offset_seconds||0));"newer"===h.time_offset_direction?t+=e:t-=e}const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`})()})]}),(0,o.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,o.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,s.__)("Post Author:","post-duplicator")}),(0,o.jsx)("span",{className:"duplicate-post-modal__preview-value",children:"current_user"===h.post_author?g?.name||(0,s.__)("Current User","post-duplicator"):p?.author?p.author:(0,s.__)("Original Author","post-duplicator")})]}),(0,o.jsxs)("div",{className:"duplicate-post-modal__preview-item",children:[(0,o.jsx)("span",{className:"duplicate-post-modal__preview-label",children:(0,s.__)("Post URL:","post-duplicator")}),(0,o.jsx)("span",{className:"duplicate-post-modal__preview-value duplicate-post-modal__preview-url",children:(()=>{const t=p?.slug?h.fullSlug?h.fullSlug:`${p.slug}-${h.slug||"copy"}`:"";return t&&_?`${_}/${t}/`:""})()})]})]}),v&&(0,o.jsx)("div",{className:"duplicate-post-modal__settings",children:(0,o.jsx)(r,{settings:h,onSettingsChange:x,postTypes:u,statusChoices:m,originalPost:p})})]}),(0,o.jsxs)(e.__experimentalHStack,{alignment:"right",className:"duplicate-post-modal__footer",style:{position:"absolute",bottom:"0px",left:"0",padding:"20px",borderTop:"1px solid rgba(0, 0, 0, 0.1)",background:"#FFF"},children:[(0,o.jsx)(e.Button,{variant:"tertiary",onClick:n,disabled:f,children:(0,s.__)("Cancel","post-duplicator")}),(0,o.jsx)(e.Button,{variant:"primary",onClick:async()=>{S(!0);try{await c(h)}catch(t){console.error("Error duplicating:",t)}finally{S(!1)}},disabled:f,isBusy:f,children:f?(0,s.__)("Duplicating...","post-duplicator"):(()=>{const t=j();return(0,s.__)(`Duplicate ${t}`,"post-duplicator")})()})]})]})};function p(t,e="error"){const s=document.createElement("div");s.classList.add("my-snackbar",`my-snackbar--${e}`),s.textContent=t,document.body.appendChild(s),setTimeout((()=>{s.classList.add("my-snackbar--hide"),s.addEventListener("transitionend",(()=>s.remove()))}),3e3)}const d=()=>{const[e,s]=(0,t.useState)(!1),[a,i]=(0,t.useState)(null);return(0,t.useEffect)((()=>{const t=async t=>{if(t.target.classList.contains("m4c-duplicate-post")){t.preventDefault();const e=t.target.getAttribute("data-postid");try{const t=await fetch(`${postDuplicatorVars.restUrl.replace("post-duplicator/v1/","wp/v2/")}posts/${e}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});if(!t.ok)throw new Error("Failed to fetch post data");const a=await t.json(),o=await fetch(`${postDuplicatorVars.restUrl.replace("post-duplicator/v1/","wp/v2/")}users/${a.author}`,{headers:{"X-WP-Nonce":postDuplicatorVars.nonce}});let l="Unknown Author";o.ok&&(l=(await o.json()).name),i({id:a.id,title:a.title.rendered,type:a.type,status:a.status,slug:a.slug,date:a.date,author:l}),s(!0)}catch(t){console.error("Error fetching post:",t),p("Error loading post data. Please try again.","error")}}};return document.body.addEventListener("click",t),()=>{document.body.removeEventListener("click",t)}}),[]),(0,o.jsx)(c,{isOpen:e,onClose:()=>s(!1),onDuplicate:async t=>{if(!a)return;const e={original_id:a.id,...t};try{const t=await fetch(`${postDuplicatorVars.restUrl}duplicate-post`,{method:"POST",headers:{"X-WP-Nonce":postDuplicatorVars.nonce,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw await t.json();const s=await t.json();if(s.duplicate_id){let t=window.location.href;t.includes("?")?t+=`&post-duplicated=${s.duplicate_id}`:t+=`?post-duplicated=${s.duplicate_id}`,window.location.href=t}}catch(t){console.error("Error duplicating post:",t.message),p(`Error duplicating post: ${t.message}`,"error"),s(!1)}},originalPost:a,defaultSettings:postDuplicatorVars.defaultSettings,postTypes:postDuplicatorVars.postTypes,statusChoices:postDuplicatorVars.statusChoices,siteUrl:postDuplicatorVars.siteUrl,currentUser:postDuplicatorVars.currentUser})};document.addEventListener("DOMContentLoaded",(function(){const e=document.createElement("div");e.id="duplicate-post-modal-root",document.body.appendChild(e),(0,t.createRoot)(e).render((0,o.jsx)(d,{}))}))})();